(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(b,a){var d=this.length>>>0,e=Number(a)||0,e=0>e?Math.ceil(e):Math.floor(e);for(0>e&&(e+=d);eb.right||a.rightb.bottom||a.bottom=f.length)){for(var a=void 0!==b?b*b:1,e=f[0],g=[e],h,k=1,l=f.length;ka&&(g.push(h),e=h)}e!==h&&g.push(h);h=g;var f=h.length,e=new ("undefined"!==typeof Uint8Array?Uint8Array:Array)(f),g=0,k=f-1,l=[],n=[],p,q,t;for(e[g]=e[k]=1;k;){p=0;for(m=g+1;mp&&(t=m,p=q)}p>a&&(e[t]=1,l.push(g,t,t,k));k=l.pop();g=l.pop()}for(m=0;ml.length-1?l.length-1:0>a?0:a;if((a>=l.length||0>a)&&n==b)return!1;n=b;m=g(n);return!0};this.getScale=function(){return h*m};this.putScale=function(a){this.putMapLevel(e(a/h))};this.getScaleX=function(){return h*m};this.getScaleY=function(){return k*m};this.getLevelScale=function(a){return h* g(a)}}; function CachedLevelTransformation(d){function b(a){for(var b=0,b=0;bg.length-1?g.length-1:0>b?0:b;if((b>=g.length||0>b)&&k==d)return!1;k=d;l=a(k);return!0};this.getScale=function(){return f*l};this.putScale=function(a){this.putMapLevel(b(a/f))};this.getScaleX=function(){return f*l};this.getScaleY=function(){return e* l};this.getLevelScale=function(b){return f*a(b)}} function MapCachedLayer(d,b,a,f,e,g,h){function k(a,d){function e(a,m,p,k){for(var s=0;sl&&(f.x-=l=-l);0>h&&(f.y-=h=-h);d[e].ReloadStatus(f.x,f.y,l,h)}};this.getTiles=function(a,e,f,g,m){a=n.ToMapDistX(1);n.ToMapDistY(1);m=0;if(0f&&(f=h), lm&&(m=l));if(h===l||0>h&&h===-l||0q[F].zIndex&&(z[q[F].zIndex]=q[F]));for(v.sort(f);0>v[t];)if(u=z[v[t++]],A.push(u.apply(b,h)),g)return g=d,A;for(F=0;Fe;e+=2){var g=[{x:+a[e-2],y:+a[e-1]},{x:+a[e],y:+a[e+1]},{x:+a[e+2],y:+a[e+3]},{x:+a[e+4],y:+a[e+5]}];b?e?f-4==e?g[3]={x:+a[0],y:+a[1]}:f-2==e&&(g[2]={x:+a[0],y:+a[1]},g[3]={x:+a[2],y:+a[3]}):g[0]={x:+a[f-2],y:+a[f-1]}:f-4==e?g[3]=g[2]:e||(g[0]={x:+a[e],y:+a[e+1]});d.push(["C",(-g[0].x+6*g[1].x+g[2].x)/6,(-g[0].y+6*g[1].y+g[2].y)/6,(g[1].x+6*g[2].x-g[3].x)/6,(g[1].y+6*g[2].y-g[3].y)/6,g[2].x,g[2].y])}return d} function k(a,b,d,e,f,g,m,h,l){null==l&&(l=1);l=(1l?0:l)/2;for(var k=[-0.1252,0.1252,-0.3678,0.3678,-0.5873,0.5873,-0.7699,0.7699,-0.9041,0.9041,-0.9816,0.9816],p=[0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],s=0,w=0;12>w;w++)var n=l*k[w]+l,q=n*(n*(-3*a+9*d-9*f+3*m)+6*a-12*d+6*f)-3*a+3*d,n=n*(n*(-3*b+9*e-9*g+3*h)+6*b-12*e+6*g)-3*b+3*e,s=s+p[w]*M.sqrt(q*q+n*n);return l*s}function l(a,b,d,e,f,g,m,h,l){if(!(0>l||k(a,b,d,e,f,g,m,h)Q(Z.x-I.x)?"y":"x",ga=0.001>Q(H.x-D.x)?"y":"x",K;K=I.x;var M=I.y,ea=Z.x,ia= Z.y,pa=D.x,U=D.y,ma=H.x,ka=H.y;if(N(K,ea)N(pa,ma)||N(M,ia)N(U,ka))K=void 0;else{var X=(K*ia-M*ea)*(pa-ma)-(K-ea)*(pa*ka-U*ma),V=(K*ia-M*ea)*(U-ka)-(M-ia)*(pa*ka-U*ma),ta=(K-ea)*(U-ka)-(M-ia)*(pa-ma);if(ta){var X=X/ta,V=V/ta,ta=+X.toFixed(2),Ba=+V.toFixed(2);K=ta<+S(K,ea).toFixed(2)||ta>+N(K,ea).toFixed(2)||ta<+S(pa,ma).toFixed(2)||ta>+N(pa,ma).toFixed(2)||Ba<+S(M,ia).toFixed(2)||Ba>+N(M,ia).toFixed(2)||Ba<+S(U,ka).toFixed(2)||Ba>+N(U,ka).toFixed(2)?void 0:{x:X, y:V}}else K=void 0}K&&G[K.x.toFixed(4)]!=K.y.toFixed(4)&&(G[K.x.toFixed(4)]=K.y.toFixed(4),I=I.t+Q((K[P]-I[P])/(Z[P]-I[P]))*(Z.t-I.t),D=D.t+Q((K[ga]-D[ga])/(H[ga]-D[ga]))*(H.t-D.t),0<=I&&1.001>=I&&0<=D&&1.001>=D&&(v?z++:z.push({x:K.x,y:K.y,t1:S(I,1),t2:S(D,1)})))}v=z}else v=v?0:[];if(e)C+=v;else{L=0;for(F=v.length;Le;e++){g=((k*f+l)*f+h)*f-a;if(Q(g)Q(d))break;f-=g/d}d=0;e=1;f=a;if(fe)return e;for(;dg?d=f:e=f;f=(e-d)/2+d}return f}var h=3*b,l=3*(e-b)-h,k=1-h-l,p=3*d,s=3*(f-d)-p,w=1-p-s;return function(a,b){var d=m(a,b);return((w*d+s)* d+p)*d}(a,1/(200*g))}function t(a,b){var d=[],e={};this.ms=b;this.times=1;if(a){for(var f in a)a[H](f)&&(e[Y(f)]=a[f],d.push(Y(f)));d.sort(ea)}this.anim=e;this.top=d[d.length-1];this.percents=d}function u(d,e,f,g,h,l){f=Y(f);var k,p,s,n,C,u,E=d.ms,t={},v={},D={};if(g)for(u=0,F=$.length;ug*d.top){f=d.percents[u]; C=d.percents[u-1]||0;E=E/d.top*(f-C);n=d.percents[u+1];k=d.anim[f];break}else g&&e.attr(d.anim[d.percents[u]]);if(k){if(p)p.initstatus=g,p.start=new Date-p.ms*g;else{for(var B in k)if(k[H](B)&&(sa[H](B)||e.paper.customAttributes[H](B)))switch(t[B]=e.attr(B),null==t[B]&&(t[B]=da[B]),v[B]=k[B],sa[B]){case X:D[B]=(v[B]-t[B])/E;break;case "colour":t[B]=a.getRGB(t[B]);u=a.getRGB(v[B]);D[B]={r:(u.r-t[B].r)/E,g:(u.g-t[B].g)/E,b:(u.b-t[B].b)/E};break;case "path":u=Ba(t[B],v[B]);L=u[1];t[B]=u[0];D[B]=[];u= 0;for(F=t[B].length;u';xa=Ka.firstChild;xa.style.behavior="url(#default#VML)";if(!xa||"object"!=typeof xa.adj)return a.type="";Ka=null}a.svg=!(a.vml="VML"==a.type);a._Paper=K;a.fn=E=K.prototype=a.prototype;a._id=0;a._oid=0;a.is=function(a,b){b=P.call(b);return"finite"==b?!qa[H](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)|| R.call(a).slice(8,-1).toLowerCase()==b};a.angle=function(b,d,e,f,g,m){return null==g?(b-=e,d-=f,b||d?(180*M.atan2(-d,-b)/U+540)%360:0):a.angle(b,d,g,m)-a.angle(e,f,g,m)};a.rad=function(a){return a%360*U/180};a.deg=function(a){return Math.round(1E3*(180*a/U%360))/1E3};a.snapTo=function(b,d,e){e=a.is(e,"finite")?e:10;if(a.is(b,ca))for(var f=b.length;f--;){if(Q(b[f]-d)<=e)return b[f]}else{b=+b;f=d%b;if(fb-e)return d-f+b}return d};a.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a, b).toUpperCase()}}(/[xy]/g,function(a){var b=16*M.random()|0;return("x"==a?b:b&3|8).toString(16)});a.setWindow=function(d){b("raphael.setWindow",a,G.win,d);G.win=d;G.doc=G.win.document;a._engine.initWin&&a._engine.initWin(G.win)};var Aa=function(b){if(a.vml){var d=/^\s+|\s+$/g,f;try{var g=new ActiveXObject("htmlfile");g.write("");g.close();f=g.body}catch(m){f=createPopup().document.body}var h=f.createTextRange();Aa=e(function(a){try{f.style.color=J(a).replace(d,"");var b=h.queryCommandValue("ForeColor"); return"#"+("000000"+((b&255)<<16|b&65280|(b&16711680)>>>16).toString(16)).slice(-6)}catch(e){return"none"}})}else{var l=G.doc.createElement("i");l.title="Rapha\u00ebl Colour Picker";l.style.display="none";G.doc.body.appendChild(l);Aa=e(function(a){l.style.color=a;return G.doc.defaultView.getComputedStyle(l,"").getPropertyValue("color")})}return Aa(b)},Qa=function(){return"hsb("+[this.h,this.s,this.b]+")"},Ra=function(){return"hsl("+[this.h,this.s,this.l]+")"},La=function(){return this.hex},Ha=function(b, d,e){null==d&&a.is(b,"object")&&"r"in b&&"g"in b&&"b"in b&&(e=b.b,d=b.g,b=b.r);null==d&&a.is(b,"string")&&(e=a.getRGB(b),b=e.r,d=e.g,e=e.b);if(1d?d:1-d);b=m*(1-Q(a%2-1));d=f=g=d-m/2;a=~~a;d+=[m,b,0,0,b,m][a];f+=[b,m,m,b,0,0][a];g+=[0,0,b,m,m,b][a];return cb(d,f,g,e)};a.rgb2hsb=function(a,b,d){d=Ha(a,b,d);a=d[0];b=d[1];d=d[2];var e,f;e=N(a,b,d);f=e-S(a,b,d);a=60*(((0==f?0:e==a?(b-d)/f:e==b?(d-a)/f+2:(a-b)/f+4)+360)%6)/360;return{h:a,s:0==f?0:f/e,b:e,toString:Qa}};a.rgb2hsl=function(a, b,d){d=Ha(a,b,d);a=d[0];b=d[1];d=d[2];var e,f,g;e=N(a,b,d);f=S(a,b,d);g=e-f;a=60*(((0==g?0:e==a?(b-d)/g:e==b?(d-a)/g+2:(a-b)/g+4)+360)%6)/360;e=(e+f)/2;return{h:a,s:0==g?0:0.5>e?g/(2*e):g/(2-2*e),l:e,toString:Ra}};a._path2string=function(){return this.join(",").replace(va,"$1")};a._preload=function(a,b){var d=G.doc.createElement("img");d.style.cssText="position:absolute;left:-9999em;top:-9999em";d.onload=function(){b.call(this);this.onload=null;G.doc.body.removeChild(this)};d.onerror=function(){G.doc.body.removeChild(this)}; G.doc.body.appendChild(d);d.src=a};a.getRGB=e(function(b){if(!b||(b=J(b)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==b)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!na[H](b.toLowerCase().substring(0,2))&&"#"!=b.charAt()&&(b=Aa(b));var d,e,f,m,h;if(b=b.match(ja)){b[2]&&(f=aa(b[2].substring(5),16),e=aa(b[2].substring(3,5),16),d=aa(b[2].substring(1,3),16));b[3]&&(f=aa((h=b[3].charAt(3))+h,16),e=aa((h=b[3].charAt(2))+h,16),d=aa((h=b[3].charAt(1))+h,16));b[4]&&(h=b[4][O](fa), d=Y(h[0]),"%"==h[0].slice(-1)&&(d*=2.55),e=Y(h[1]),"%"==h[1].slice(-1)&&(e*=2.55),f=Y(h[2]),"%"==h[2].slice(-1)&&(f*=2.55),"rgba"==b[1].toLowerCase().slice(0,4)&&(m=Y(h[3])),h[3]&&"%"==h[3].slice(-1)&&(m/=100));if(b[5])return h=b[5][O](fa),d=Y(h[0]),"%"==h[0].slice(-1)&&(d*=2.55),e=Y(h[1]),"%"==h[1].slice(-1)&&(e*=2.55),f=Y(h[2]),"%"==h[2].slice(-1)&&(f*=2.55),"deg"!=h[0].slice(-3)&&"\u00b0"!=h[0].slice(-1)||(d/=360),"hsba"==b[1].toLowerCase().slice(0,4)&&(m=Y(h[3])),h[3]&&"%"==h[3].slice(-1)&&(m/= 100),a.hsb2rgb(d,e,f,m);if(b[6])return h=b[6][O](fa),d=Y(h[0]),"%"==h[0].slice(-1)&&(d*=2.55),e=Y(h[1]),"%"==h[1].slice(-1)&&(e*=2.55),f=Y(h[2]),"%"==h[2].slice(-1)&&(f*=2.55),"deg"!=h[0].slice(-3)&&"\u00b0"!=h[0].slice(-1)||(d/=360),"hsla"==b[1].toLowerCase().slice(0,4)&&(m=Y(h[3])),h[3]&&"%"==h[3].slice(-1)&&(m/=100),a.hsl2rgb(d,e,f,m);b={r:d,g:e,b:f,toString:g};b.hex="#"+(16777216|f|e<<8|d<<16).toString(16).slice(1);a.is(m,"finite")&&(b.opacity=m);return b}return{r:-1,g:-1,b:-1,hex:"none",error:1, toString:g}},a);a.hsb=e(function(b,d,e){return a.hsb2rgb(b,d,e).hex});a.hsl=e(function(b,d,e){return a.hsl2rgb(b,d,e).hex});a.rgb=e(function(a,b,d){return"#"+(16777216|d|b<<8|a<<16).toString(16).slice(1)});a.getColor=function(a){a=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||0.75};var b=this.hsb2rgb(a.h,a.s,a.b);a.h+=0.075;1=a.s&&(this.getColor.start={h:0,s:1,b:a.b}));return b.hex};a.getColor.reset=function(){delete this.start};a.parsePathString=function(b){if(!b)return null; var d=ua(b);if(d.arr)return wa(d.arr);var e={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},f=[];a.is(b,ca)&&a.is(b[0],ca)&&(f=wa(b));f.length||J(b).replace(oa,function(a,b,d){var g=[];a=b.toLowerCase();d.replace(Da,function(a,b){b&&g.push(+b)});"m"==a&&2=e[a]&&(f.push([b][w](g.splice(0,e[a]))),e[a]););});f.toString=a._path2string;d.arr=wa(f);return f};a.parseTransformString=e(function(b){if(!b)return null; var d=[];a.is(b,ca)&&a.is(b[0],ca)&&(d=wa(b));d.length||J(b).replace(ia,function(a,b,e){var f=[];P.call(b);e.replace(Da,function(a,b){b&&f.push(+b)});d.push([b][w](f))});d.toString=a._path2string;return d});var ua=function(a){var b=ua.ps=ua.ps||{};b[a]?b[a].sleep=100:b[a]={sleep:100};setTimeout(function(){for(var d in b)b[H](d)&&d!=a&&(b[d].sleep--,!b[d].sleep&&delete b[d])});return b[a]};a.findDotsAtSegment=function(a,b,d,e,f,g,m,h,l){var k=1-l,p=V(k,3),s=V(k,2),w=l*l,n=w*l,q=p*a+3*s*l*d+3*k*l*l* f+n*m,p=p*b+3*s*l*e+3*k*l*l*g+n*h,s=a+2*l*(d-a)+w*(f-2*d+a),n=b+2*l*(e-b)+w*(g-2*e+b),u=d+2*l*(f-d)+w*(m-2*f+d),w=e+2*l*(g-e)+w*(h-2*g+e);a=k*a+l*d;b=k*b+l*e;f=k*f+l*m;g=k*g+l*h;h=90-180*M.atan2(s-u,n-w)/U;(s>u||n=a.x&&b<=a.x2&&d>=a.y&&d<=a.y2};a.isBBoxIntersect=function(b,d){var e=a.isPointInsideBBox;return e(d,b.x,b.y)||e(d,b.x2,b.y)||e(d,b.x,b.y2)||e(d,b.x2,b.y2)||e(b,d.x,d.y)||e(b,d.x2,d.y)||e(b,d.x,d.y2)||e(b,d.x2,d.y2)||(b.xd.x||d.xb.x)&&(b.yd.y||d.yb.y)};a.pathIntersection=function(a,b){return n(a,b)};a.pathIntersectionNumber=function(a,b){return n(a,b,1)};a.isPointInsidePath=function(b,d,e){var f=a.pathBBox(b);return a.isPointInsideBBox(f, d,e)&&1==n(b,[["M",d,e],["H",f.x2+10]],1)%2};a._removedFactory=function(a){return function(){b("raphael.log",null,"Rapha\u00ebl: you are calling to method \u201c"+a+"\u201d of removed object",a)}};var Ea=a.pathBBox=function(a){var b=ua(a);if(b.bbox)return f(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Ba(a);for(var d=0,e=0,g=[],m=[],h,l=0,k=a.length;lv&&(v=2*U+v);0>u&&(u=2*U+u);h&&v>u&&(v-=2*U);!h&&u>v&&(u-=2*U)}if(Q(u-v)>s){var q=u,t=l,B=k;u=v+s*(h&&u>v?1:-1);l=m+d*M.cos(u);k=E+f*M.sin(u);q=Ma(l,k,d,f,g,0,h,t,B,[u,q,m,E])}m=u-v;g=M.cos(v); s=M.sin(v);h=M.cos(u);u=M.sin(u);m=M.tan(m/4);d=4/3*d*m;m*=4/3*f;f=[a,b];a=[a+d*s,b-m*g];b=[l+d*u,k-m*h];l=[l,k];a[0]=2*f[0]-a[0];a[1]=2*f[1]-a[1];if(p)return[a,b,l][w](q);q=[a,b,l][w](q).join()[O](",");p=[];l=0;for(k=q.length;lw&&(w=Fa(a,b,d,e,f,g,m,h,w),u.push(w.x),n.push(w.y));0l&&(w=Fa(a,b,d,e,f,g,m,h,l),u.push(w.x),n.push(w.y));l=g-2*e+b-(h-2*g+e);k=2*(e-b)-2*(g-e);p=b-e;w=(-k+M.sqrt(k*k-4*l*p))/2/l;l=(-k-M.sqrt(k*k-4*l*p))/2/l;"1e12"w&&(w=Fa(a,b,d,e,f,g,m,h,w),u.push(w.x),n.push(w.y));0l&&(w=Fa(a,b,d,e,f,g,m,h,l),u.push(w.x),n.push(w.y)); return{min:{x:S[s](0,u),y:S[s](0,n)},max:{x:N[s](0,u),y:N[s](0,n)}}}),Ba=a._path2curve=e(function(a,b){var d=!b&&ua(a);if(!b&&d.curve)return wa(d.curve);var e=Ja(a),f=b&&Ja(b),g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},m={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=function(a,b,d){if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];a[0]in{T:1,Q:1}||(b.qx=b.qy=null);switch(a[0]){case "M":b.X=a[1];b.Y=a[2];break;case "A":a=["C"][w](Ma[s](0,[b.x,b.y][w](a.slice(1))));break;case "S":"C"==d||"S"==d?(d=2*b.x- b.bx,b=2*b.y-b.by):(d=b.x,b=b.y);a=["C",d,b][w](a.slice(1));break;case "T":"Q"==d||"T"==d?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y);a=["C"][w](Ca(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case "Q":b.qx=a[1];b.qy=a[2];a=["C"][w](Ca(b.x,b.y,a[1],a[2],a[3],a[4]));break;case "L":a=["C"][w]([b.x,b.y,a[1],a[2],a[1],a[2]]);break;case "H":a=["C"][w]([b.x,b.y,a[1],b.y,a[1],b.y]);break;case "V":a=["C"][w]([b.x,b.y,b.x,a[1],b.x,a[1]]);break;case "Z":a=["C"][w]([b.x,b.y,b.X,b.Y,b.X,b.Y])}return a},l=function(a, b){if(7a;a++)for(d=0;3>d;d++){for(e=f=0;3>e;e++)f+=l[a][e]* b[e][d];h[a][d]=f}this.a=h[0][0];this.b=h[1][0];this.c=h[0][1];this.d=h[1][1];this.e=h[0][2];this.f=h[1][2]};b.invert=function(){var a=this.a*this.d-this.b*this.c;return new m(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*this.e)/a,(this.b*this.e-this.a*this.f)/a)};b.clone=function(){return new m(this.a,this.b,this.c,this.d,this.e,this.f)};b.translate=function(a,b){this.add(1,0,0,1,a,b)};b.scale=function(a,b,d,e){null==b&&(b=a);(d||e)&&this.add(1,0,0,1,d,e);this.add(a,0,0,b,0,0);(d|| e)&&this.add(1,0,0,1,-d,-e)};b.rotate=function(b,d,e){b=a.rad(b);d=d||0;e=e||0;var f=+M.cos(b).toFixed(9);b=+M.sin(b).toFixed(9);this.add(f,b,-b,f,d,e);this.add(1,0,0,1,-d,-e)};b.x=function(a,b){return a*this.a+b*this.c+this.e};b.y=function(a,b){return a*this.b+b*this.d+this.f};b.get=function(a){return+this[J.fromCharCode(97+a)].toFixed(4)};b.toString=function(){return a.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1), this.get(3),0,0].join()};b.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};b.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};b.split=function(){var b={};b.dx=this.e;b.dy=this.f;var f=[[this.a,this.c],[this.b,this.d]];b.scalex=M.sqrt(d(f[0]));e(f[0]);b.shear=f[0][0]*f[1][0]+f[0][1]*f[1][1];f[1]=[f[1][0]-f[0][0]* b.shear,f[1][1]-f[0][1]*b.shear];b.scaley=M.sqrt(d(f[1]));e(f[1]);b.shear/=b.scaley;var g=-f[0][1],f=f[1][1];0>f?(b.rotate=a.deg(M.acos(f)),0>g&&(b.rotate=360-b.rotate)):b.rotate=a.deg(M.asin(g));b.isSimple=!+b.shear.toFixed(9)&&(b.scalex.toFixed(9)==b.scaley.toFixed(9)||!b.rotate);b.isSuperSimple=!+b.shear.toFixed(9)&&b.scalex.toFixed(9)==b.scaley.toFixed(9)&&!b.rotate;b.noRotation=!+b.shear.toFixed(9)&&!b.rotate;return b};b.toTransformString=function(a){a=a||this[O]();return a.isSimple?(a.scalex= +a.scalex.toFixed(4),a.scaley=+a.scaley.toFixed(4),a.rotate=+a.rotate.toFixed(4),(a.dx||a.dy?"t"+[a.dx,a.dy]:"")+(1!=a.scalex||1!=a.scaley?"s"+[a.scalex,a.scaley,0,0]:"")+(a.rotate?"r"+[a.rotate,0,0]:"")):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}})(m.prototype);for(var kb=function(){this.returnValue=!1},lb=function(){return this.originalEvent.preventDefault()},mb=function(){this.cancelBubble=!0},nb=function(){return this.originalEvent.stopPropagation()},eb=function(a){return{x:a.clientX+ (G.doc.documentElement.scrollLeft||G.doc.body.scrollLeft),y:a.clientY+(G.doc.documentElement.scrollTop||G.doc.body.scrollTop)}},ob=function(){if(G.doc.addEventListener)return function(a,b,d,e){var f=function(a){var b=eb(a);return d.call(e,a,b.x,b.y)};a.addEventListener(b,f,!1);if(C&&Z[b]){var g=function(b){for(var f=eb(b),g=b,m=0,h=b.targetTouches&&b.targetTouches.length;mf){if(d&&!s.start){m=Wa(m,h,l[1],l[2],l[3],l[4],l[5],l[6],f-w);p+=["C"+m.start.x, m.start.y,m.m.x,m.m.y,m.x,m.y];if(g)return p;s.start=p;p=["M"+m.x,m.y+"C"+m.n.x,m.n.y,m.end.x,m.end.y,l[5],l[6]].join();w+=k;m=+l[5];h=+l[6];continue}if(!b&&!d)return m=Wa(m,h,l[1],l[2],l[3],l[4],l[5],l[6],f-w),{x:m.x,y:m.y,alpha:m.alpha}}w+=k;m=+l[5];h=+l[6]}p+=l.shift()+l}s.end=p;m=b?w:d?s:a.findDotsAtSegment(m,h,l[0],l[1],l[2],l[3],l[4],l[5],1);m.alpha&&(m={x:m.x,y:m.y,alpha:m.alpha});return m}},gb=Xa(1),hb=Xa(),Ya=Xa(0,1);a.getTotalLength=gb;a.getPointAtLength=hb;a.getSubpath=function(a,b,d){if(1E-6> this.getTotalLength(a)-d)return Ya(a,b).end;a=Ya(a,d,1);return b?Ya(a,b).end:a};ba.getTotalLength=function(){var a=this.getPath();if(a)return this.node.getTotalLength?this.node.getTotalLength():gb(a)};ba.getPointAtLength=function(a){var b=this.getPath();if(b)return hb(b,a)};ba.getPath=function(){var b,d=a._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return d&&(b=d(this)),b};ba.getSubpath=function(b,d){var e=this.getPath();if(e)return a.getSubpath(e,b,d)};var ya=a.easing_formulas={linear:function(a){return a}, "<":function(a){return V(a,1.7)},">":function(a){return V(a,0.48)},"<>":function(a){var b=0.48-a/1.04,d=M.sqrt(0.1734+b*b);a=d-b;a=V(Q(a),1/3)*(0>a?-1:1);b=-d-b;b=V(Q(b),1/3)*(0>b?-1:1);a=a+b+0.5;return 3*(1-a)*a*a+a*a*a},backIn:function(a){return a*a*(2.70158*a-1.70158)},backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){return a==!!a?a:V(2,-10*a)*M.sin(2*(a-0.075)*U/0.3)+1},bounce:function(a){a<1/2.75?a*=7.5625*a:a<2/2.75?(a-=1.5/2.75,a=7.5625*a*a+0.75):a<2.5/2.75?(a-= 2.25/2.75,a=7.5625*a*a+0.9375):(a-=2.625/2.75,a=7.5625*a*a+0.984375);return a}};ya.easeIn=ya["ease-in"]=ya["<"];ya.easeOut=ya["ease-out"]=ya[">"];ya.easeInOut=ya["ease-in-out"]=ya["<>"];ya["back-in"]=ya.backIn;ya["back-out"]=ya.backOut;var $=[],bb=d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame||d.msRequestAnimationFrame||function(a){setTimeout(a,16)},Ta=function(){for(var d=+new Date,e=0;e<$.length;e++){var f=$[e];if(!f.el.removed&&!f.paused){var g= d-f.start,m=f.ms,h=f.easing,l=f.from,k=f.diff,p=f.to,s=f.el,n={},q,C={},E;f.initstatus?(g=(f.initstatus*f.anim.top-f.prev)/(f.percent-f.prev)*m,f.status=f.initstatus,delete f.initstatus,f.stop&&$.splice(e--,1)):f.status=(f.prev+(f.percent-f.prev)*(g/m))/f.anim.top;if(!(0>g))if(ga?0:a};ba.animateWith=function(b,d,e,f,g,m){if(this.removed)return m&&m.call(this),this;e=e instanceof t?e:a.animation(e,f,g,m);u(e,this,e.percents[0],null,this.attr());e=0;for(f=$.length;ee&&(e=g);e+="%";!b[e].callback&&(b[e].callback=f)}return new t(b,d)};ba.animate=function(b,d,e,f){if(this.removed)return f&&f.call(this),this;b=b instanceof t?b:a.animation(b,d,e,f);u(b,this,b.percents[0],null,this.attr());return this};ba.setTime=function(a,b){a&&null!=b&&this.status(a,S(b,a.ms)/a.ms);return this};ba.status=function(a,b){var d=[],e=0,f,g;if(null!=b)return u(a,this,-1,S(b,1)),this;for(f=$.length;ea?N(this.length+a,0):a;b=N(0,S(this.length-a,b));var e=[],f=[],g=[],m;for(m=2;mt[2]&&(t[0]=-t[2],t[2]=0);0>t[3]&&(t[1]=-t[3],t[3]=0)}var v=a._parseDots(l);if(!v)return null;p=p.replace(/[\(\)\s,\xb0#]/g,"_");e.gradient&&p!=e.gradient.id&&(u.defs.removeChild(e.gradient),delete e.gradient);if(!e.gradient)for(E=w(k+"Gradient",{id:p}),e.gradient=E,w(E,"radial"==k?{fx:s,fy:n}:{x1:t[0],y1:t[1],x2:t[2],y2:t[3],gradientTransform:e.matrix.invert()}), u.defs.appendChild(E),u=0,t=v.length;ub*d?-1:1);g&&(f=t(g,e,f),e=f.dx,f=f.dy);0>b&&(w+="x");0>d&&(w+=" y")&&(s=-1);p.flip=w;a.coordorigin=e*-n+" "+f*-C;if(k||m.fillsize)e= (e=a.getElementsByTagName("fill"))&&e[0],a.removeChild(e),k&&(f=t(g,l.x(k[0],k[1]),l.y(k[0],k[1])),e.position=f.dx*s+" "+f.dy*s),m.fillsize&&(e.size=m.fillsize[0]*h(b)+" "+m.fillsize[1]*h(d)),a.appendChild(e);p.visibility="visible"}};a.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+this.version};var v=function(a,d,e){d=b(d).toLowerCase().split("-");e=e?"end":"start";for(var f=d.length,g="classic",m="medium",h="medium";f--;)switch(d[f]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":g= d[f];break;case "wide":case "narrow":h=d[f];break;case "long":case "short":m=d[f]}a=a.node.getElementsByTagName("stroke")[0];a[e+"arrow"]=g;a[e+"arrowlength"]=m;a[e+"arrowwidth"]=h},O=function(e,h){e.attrs=e.attrs||{};var k=e.node,p=e.attrs,s=k.style,w=C[e.type]&&(h.x!=p.x||h.y!=p.y||h.width!=p.width||h.height!=p.height||h.cx!=p.cx||h.cy!=p.cy||h.rx!=p.rx||h.ry!=p.ry||h.r!=p.r),n=u[e.type]&&(p.cx!=h.cx||p.cy!=h.cy||p.r!=h.r||p.rx!=h.rx||p.ry!=h.ry),t;for(t in h)h.hasOwnProperty(t)&&(p[t]=h[t]);w&& (p.path=a._getPath[e.type](e),e._.dirty=1);h.href&&(k.href=h.href);h.title&&(k.title=h.title);h.target&&(k.target=h.target);h.cursor&&(s.cursor=h.cursor);"blur"in h&&e.blur(h.blur);if(h.path&&"path"==e.type||w)k.path=q(~b(p.path).toLowerCase().indexOf("r")?a._pathToAbsolute(p.path):p.path),e._.dirty=1,"image"==e.type&&(e._.fillpos=[p.x,p.y],e._.fillsize=[p.width,p.height],E(e,1,1,0,0,0));"transform"in h&&e.transform(h.transform);n&&(s=+p.cx,w=+p.cy,n=+p.rx||+p.r||0,t=+p.ry||+p.r||0,k.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x", f(21600*(s-n)),f(21600*(w-t)),f(21600*(s+n)),f(21600*(w+t)),f(21600*s)),e._.dirty=1);"clip-rect"in h&&(s=b(h["clip-rect"]).split(l),4==s.length&&(s[2]=+s[2]+ +s[0],s[3]=+s[3]+ +s[1],w=k.clipRect||a._g.doc.createElement("div"),n=w.style,n.clip=a.format("rect({1}px {2}px {3}px {0}px)",s),k.clipRect||(n.position="absolute",n.top=0,n.left=0,n.width=e.paper.width+"px",n.height=e.paper.height+"px",k.parentNode.insertBefore(w,k),w.appendChild(k),k.clipRect=w)),h["clip-rect"]||k.clipRect&&(k.clipRect.style.clip= "auto"));e.textpath&&(s=e.textpath.style,h.font&&(s.font=h.font),h["font-family"]&&(s.fontFamily='"'+h["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"'),h["font-size"]&&(s.fontSize=h["font-size"]),h["font-weight"]&&(s.fontWeight=h["font-weight"]),h["font-style"]&&(s.fontStyle=h["font-style"]));"arrow-start"in h&&v(e,h["arrow-start"]);"arrow-end"in h&&v(e,h["arrow-end"],1);if(null!=h.opacity||null!=h["stroke-width"]||null!=h.fill||null!=h.src||null!=h.stroke||null!=h["stroke-width"]|| null!=h["stroke-opacity"]||null!=h["fill-opacity"]||null!=h["stroke-dasharray"]||null!=h["stroke-miterlimit"]||null!=h["stroke-linejoin"]||null!=h["stroke-linecap"]){s=(s=k.getElementsByTagName("fill"))&&s[0];!s&&(s=J("fill"));"image"==e.type&&h.src&&(s.src=h.src);h.fill&&(s.on=!0);if(null==s.on||"none"==h.fill||null===h.fill)s.on=!1;s.on&&h.fill&&((w=b(h.fill).match(a._ISURL))?(s.parentNode==k&&k.removeChild(s),s.rotate=!0,s.src=w[1],s.type="tile",n=e.getBBox(1),s.position=n.x+" "+n.y,e._.fillpos= [n.x,n.y],a._preload(w[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})):(s.color=a.getRGB(h.fill).hex,s.src="",s.type="solid",a.getRGB(h.fill).error&&(e.type in{circle:1,ellipse:1}||"r"!=b(h.fill).charAt())&&B(e,h.fill,s)&&(p.fill="none",p.gradient=h.fill,s.rotate=!1)));if("fill-opacity"in h||"opacity"in h)n=((+p["fill-opacity"]+1||2)-1)*((+p.opacity+1||2)-1)*((+a.getRGB(h.fill).o+1||2)-1),n=m(g(n,0),1),s.opacity=n,s.src&&(s.color="none");k.appendChild(s);s=k.getElementsByTagName("stroke")&& k.getElementsByTagName("stroke")[0];w=!1;!s&&(w=s=J("stroke"));if(h.stroke&&"none"!=h.stroke||h["stroke-width"]||null!=h["stroke-opacity"]||h["stroke-dasharray"]||h["stroke-miterlimit"]||h["stroke-linejoin"]||h["stroke-linecap"])s.on=!0;"none"!=h.stroke&&null!==h.stroke&&null!=s.on&&0!=h.stroke&&0!=h["stroke-width"]||(s.on=!1);n=a.getRGB(h.stroke);s.on&&h.stroke&&(s.color=n.hex);n=((+p["stroke-opacity"]+1||2)-1)*((+p.opacity+1||2)-1)*((+n.o+1||2)-1);t=0.75*(d(h["stroke-width"])||1);n=m(g(n,0),1); null==h["stroke-width"]&&(t=p["stroke-width"]);h["stroke-width"]&&(s.weight=t);t&&1>t&&(n*=t)&&(s.weight=1);s.opacity=n;h["stroke-linejoin"]&&(s.joinstyle=h["stroke-linejoin"]||"miter");s.miterlimit=h["stroke-miterlimit"]||8;h["stroke-linecap"]&&(s.endcap="butt"==h["stroke-linecap"]?"flat":"square"==h["stroke-linecap"]?"square":"round");"stroke-dasharray"in h&&(n={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot", "--..":"longdashdotdot"},s.dashstyle=n.hasOwnProperty(h["stroke-dasharray"])?n[h["stroke-dasharray"]]:"");w&&k.appendChild(s)}if("text"==e.type){e.paper.canvas.style.display="";k=e.paper.span;w=p.font&&p.font.match(/\d+(?:\.\d*)?(?=px)/);s=k.style;p.font&&(s.font=p.font);p["font-family"]&&(s.fontFamily=p["font-family"]);p["font-weight"]&&(s.fontWeight=p["font-weight"]);p["font-style"]&&(s.fontStyle=p["font-style"]);w=d(p["font-size"]||w&&w[0])||10;s.fontSize=100*w+"px";e.textpath.string&&(k.innerHTML= b(e.textpath.string).replace(/"));k=k.getBoundingClientRect();e.W=p.w=(k.right-k.left)/100;e.H=p.h=(k.bottom-k.top)/100;e.X=p.x;e.Y=p.y+e.H/2;("x"in h||"y"in h)&&(e.path.v=a.format("m{0},{1}l{2},{1}",f(21600*p.x),f(21600*p.y),f(21600*p.x)+1));k="x y text font font-family font-weight font-style font-size".split(" ");s=0;for(w=k.length;sb.styleSheets.length?b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):b.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),J=function(a){return b.createElement("')}}catch(d){J=function(a){return b.createElement("<"+ a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}};a._engine.initWin(a._g.win);a._engine.create=function(){var b=a._getContainer.apply(0,arguments),d=b.container,e=b.height,f=b.width,g=b.x,b=b.y;if(!d)throw Error("VML container not found.");var m=new a._Paper,h=m.canvas=a._g.doc.createElement("div"),l=h.style,g=g||0,b=b||0,f=f||512,e=e||342;m.width=f;m.height=e;f==+f&&(f+="px");e==+e&&(e+="px");m.coordsize="21600000 21600000";m.coordorigin="0 0";m.span=a._g.doc.createElement("span");m.span.style.cssText= "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";h.appendChild(m.span);l.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",f,e);1==d?(a._g.doc.body.appendChild(h),l.left=g+"px",l.top=b+"px",l.position="absolute"):d.firstChild?d.insertBefore(h,d.firstChild):d.appendChild(h);m.renderfix=function(){};return m};a.prototype.clear=function(){a.eve("raphael.clear",this);this.canvas.innerHTML=""; this.span=a._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};a.prototype.remove=function(){a.eve("raphael.remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]="function"==typeof this[b]?a._removedFactory(b):null;return!0};var F=a.st,A;for(A in D)D.hasOwnProperty(A)&&!F.hasOwnProperty(A)&&(F[A]=function(a){return function(){var b= arguments;return this.forEach(function(d){d[a].apply(d,b)})}}(A))}})();D?G.win.Raphael=a:Raphael=a;"object"==typeof exports&&(module.exports=a);return a});var TGOS=TGOS||{};TGOS.MVCObject=function(){this.binds_=[];this.events_=[]};TGOS.MVCObject.prototype.addListener=function(d,b){};TGOS.MVCObject.prototype.bindTo=function(d,b,a,f){f={key:d,target:b,targetKey:a?a:d,noNotify:f?!0:!1,eventName:d+"_changed"};this.binds_.push(f);this[d]!==f.target[f.targetKey]&&(f.target[f.targetKey]=this[d],this.notify_(b,a))};TGOS.MVCObject.prototype.changed=function(d){};TGOS.MVCObject.prototype.get=function(d){return this[d]}; TGOS.MVCObject.prototype.notifyAll=function(d){this.notify_(this,d);for(var b=0;ba?2*a*a:-1+(4-2*a)*a},cubicIn:function(a){return a*a*a},cubicOut:function(a){return--a* a*a+1},cubicInOut:function(a){return 0.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},quartIn:function(a){return a*a*a*a},quartOut:function(a){return 1- --a*a*a*a},quartInOut:function(a){return 0.5>a?8*a*a*a*a:1-8*--a*a*a*a},quintIn:function(a){return a*a*a*a*a},quintOut:function(a){return 1+--a*a*a*a*a},quintInOut:function(a){return 0.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a}};d.createAnimation=function(f){var e=f.easing?f.easing:d.easing.linear,g="number"==typeof f.duration?f.duration:350,h="function"==typeof f.onAnimation? f.onAnimation:null,k="function"==typeof f.onEnd?f.onEnd:null,l="function"==typeof f.onStart?f.onStart:null,n=f.type?f.type:"setTimeout",m="boolean"==typeof f.repeat?f.repeat:!1,p=f.rate?f.rate:20,q=f.delay?f.delay:0,t,u=null,v,z=!1,A=function(a){if(!z){null===u&&(l&&l.call(this),u="setTimeout"==n?new Date:a);v="setTimeout"==n?new Date:a;var d="setTimeout"==n?Math.abs(v.getTime()-u.getTime()):Math.abs(a-u);percent=e(d/g);h&&h.call(this,percent);1>percent&&dl;l++)if(!b||2!=l||void 0!==a.z)switch(0==l?(h=f,k="x"):1==l?(h=e,k="y"):(h=g,k="z"),d.axis[l]){case "e":a[k]=h;break;case "w":a[k]=-h;break;case "n":a[k]=h;break;case "s":a[k]=-h;break;case "u":void 0!==a[k]&&(a.z=h);break;case "d":void 0!==a[k]&&(a.z=-h);break;default:return alert("ERROR: unknow axis ("+ d.axis[l]+") - check definition of "+d.projName),null}return a},reportError:function(){},extend:function(d,b){d=d||{};if(b)for(var a in b){var f=b[a];void 0!==f&&(d[a]=f)}return d},Class:function(){for(var d=function(){this.initialize.apply(this,arguments)},b={},a,f=0;f=g;g++)if(f=d*Math.sin(e),f=this.HALF_PI-2*Math.atan(b*Math.pow((1-f)/(1+f),a))-e,e+=f,1E-10>=Math.abs(f))return e;alert("phi2z has NoConvergence");return-9999},qsfnz:function(d,b){var a;return 1E-7d?-1:1},adjust_lon:function(d){return Math.abs(d)this.HALF_PI)return+Number.NaN;if(b==this.HALF_PI)return Number.POSITIVE_INFINITY;if(b==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;a*=d;return Math.log(Math.tan((this.HALF_PI+b)/2))+d*Math.log((1-a)/(1+a))/2},fL:function(d,b){return 2*Math.atan(d*Math.exp(b))-this.HALF_PI},invlatiso:function(d,b){var a=this.fL(1,b),f=0,e=0;do f=a,e=d*Math.sin(f),a=this.fL(Math.exp(d*Math.log((1+e)/(1-e))/2),b);while(1E-12-1.001*Proj4js.common.HALF_PI)a=-Proj4js.common.HALF_PI;else if(a>Proj4js.common.HALF_PI&&a<1.001*Proj4js.common.HALF_PI)a=Proj4js.common.HALF_PI;else if(a<-Proj4js.common.HALF_PI||a>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+a),null;b>Proj4js.common.PI&&(b-=2*Proj4js.common.PI);g=Math.sin(a);h=Math.cos(a);e=this.a/Math.sqrt(1-this.es*g*g);a=(e+f)*h*Math.cos(b); b=(e+f)*h*Math.sin(b);f=(e*(1-this.es)+f)*g;d.x=a;d.y=b;d.z=f;return 0},geocentric_to_geodetic:function(d){var b,a,f,e,g,h,k,l,n,m,p=d.x;f=d.y;var q=d.z?d.z:0;b=Math.sqrt(p*p+f*f);a=Math.sqrt(p*p+f*f+q*q);if(1E-12>b/this.a){if(p=0,1E-12>a/this.a)return}else p=Math.atan2(f,p);f=q/a;e=b/a;g=1/Math.sqrt(1-this.es*(2-this.es)*e*e);k=e*(1-this.es)*g;l=f*g;m=0;do m++,h=this.a/Math.sqrt(1-this.es*l*l),a=b*k+q*l-h*(1-this.es*l*l),h=this.es*h/(h+a),g=1/Math.sqrt(1-h*(2-h)*e*e),h=e*(1-h)*g,g*=f,n=g*k-h*l,k= h,l=g;while(1E-24m);b=Math.atan(g/Math.abs(h));d.x=p;d.y=b;d.z=a;return d},geocentric_to_geodetic_noniter:function(d){var b=d.x,a=d.y,f=d.z?d.z:0,e,g,h,k,l,b=parseFloat(b),a=parseFloat(a),f=parseFloat(f);l=!1;if(0!=b)e=Math.atan2(a,b);else if(0a)e=-Proj4js.common.HALF_PI;else if(l=!0,e=0,0f)g=-Proj4js.common.HALF_PI;else return;h=b*b+a*a;b=Math.sqrt(h);a=f*Proj4js.common.AD_C;h=Math.sqrt(a*a+h);a/=h;h=b/h;a=f+this.b* this.ep2*a*a*a;k=b-this.a*this.es*h*h*h;h=Math.sqrt(a*a+k*k);a/=h;h=k/h;k=this.a/Math.sqrt(1-this.es*a*a);f=h>=Proj4js.common.COS_67P5?b/h-k:h<=-Proj4js.common.COS_67P5?b/-h-k:f/a+k*(this.es-1);!1==l&&(g=Math.atan(a/h));d.x=e;d.y=g;d.z=f;return d},geocentric_to_wgs84:function(d){if(this.datum_type==Proj4js.common.PJD_3PARAM)d.x+=this.datum_params[0],d.y+=this.datum_params[1],d.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var b=this.datum_params[3],a=this.datum_params[4], f=this.datum_params[5],e=this.datum_params[6],g=e*(f*d.x+d.y-b*d.z)+this.datum_params[1],b=e*(-a*d.x+b*d.y+d.z)+this.datum_params[2];d.x=e*(d.x-f*d.y+a*d.z)+this.datum_params[0];d.y=g;d.z=b}},geocentric_from_wgs84:function(d){if(this.datum_type==Proj4js.common.PJD_3PARAM)d.x-=this.datum_params[0],d.y-=this.datum_params[1],d.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var b=this.datum_params[3],a=this.datum_params[4],f=this.datum_params[5],e=this.datum_params[6],g=(d.x- this.datum_params[0])/e,h=(d.y-this.datum_params[1])/e,e=(d.z-this.datum_params[2])/e;d.x=g+f*h-a*e;d.y=-f*g+h+b*e;d.z=a*g-b*h+e}}}); Proj4js.Point=Proj4js.Class({initialize:function(d,b,a){"object"==typeof d?(this.x=d[0],this.y=d[1],this.z=d[2]||0):"string"==typeof d&&"undefined"==typeof b?(d=d.split(","),this.x=parseFloat(d[0]),this.y=parseFloat(d[1]),this.z=parseFloat(d[2])||0):(this.x=d,this.y=b,this.z=a||0)},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}); Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667}; Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"}, andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29, ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"}, fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"}, new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"}, sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}}; Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0", ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}}; Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Mercator_1SP:"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"}; Proj4js.Proj.aea={init:function(){Math.abs(this.lat1+this.lat2)Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/ this.ns0)},forward:function(d){var b=d.x,a=d.y;this.sin_phi=Math.sin(a);this.cos_phi=Math.cos(a);var a=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),a=this.a*Math.sqrt(this.c-this.ns0*a)/this.ns0,f=this.ns0*Proj4js.common.adjust_lon(b-this.long0),b=a*Math.sin(f)+this.x0,a=this.rh-a*Math.cos(f)+this.y0;d.x=b;d.y=a;return d},inverse:function(d){var b,a,f;d.x-=this.x0;d.y=this.rh-d.y+this.y0;0<=this.ns0?(b=Math.sqrt(d.x*d.x+d.y*d.y),a=1):(b=-Math.sqrt(d.x*d.x+d.y*d.y),a=-1);f=0;0!=b&&(f=Math.atan2(a* d.x,a*d.y));a=b*this.ns0/this.a;b=(this.c-a*a)/this.ns0;1E-10<=this.e3?(a=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,a=1E-10=l;l++)if(a=Math.sin(h),f=Math.cos(h), e=d*a,g=1-e*e,a=0.5*g*g/f*(b/(1-k)-a/g+0.5/d*Math.log((1-e)/(1+e))),h+=a,1E-7>=Math.abs(a))return h;Proj4js.reportError("aea:phi1z:Convergence error");return null}}; Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);this.rc?(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative")):Proj4js.reportError("sterea:init:E_ERROR_0")},forward:function(d){var b,a,f,e;d.x=Proj4js.common.adjust_lon(d.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[d]);b=Math.sin(d.y);a=Math.cos(d.y);f=Math.cos(d.x);e=this.k0*this.R2/(1+this.sinc0*b+this.cosc0* a*f);d.x=e*a*Math.sin(d.x);d.y=e*(this.cosc0*b-this.sinc0*a*f);d.x=this.a*d.x+this.x0;d.y=this.a*d.y+this.y0;return d},inverse:function(d){var b,a,f,e;d.x=(d.x-this.x0)/this.a;d.y=(d.y-this.y0)/this.a;d.x/=this.k0;d.y/=this.k0;(e=Math.sqrt(d.x*d.x+d.y*d.y))?(f=2*Math.atan2(e,this.R2),b=Math.sin(f),a=Math.cos(f),f=Math.asin(a*this.sinc0+d.y*b*this.cosc0/e),b=Math.atan2(d.x*b,e*this.cosc0*a-d.y*this.sinc0*b)):(f=this.phic0,b=0);d.x=b;d.y=f;Proj4js.Proj.gauss.inverse.apply(this,[d]);d.x=Proj4js.common.adjust_lon(d.x+ this.long0);return d}};function phi4z(d,b,a,f,e,g,h,k,l){var n,m,p,q,t,u;l=g;for(u=1;15>=u;u++)if(n=Math.sin(l),p=Math.tan(l),k=p*Math.sqrt(1-d*n*n),m=Math.sin(2*l),q=b*l-a*m+f*Math.sin(4*l)-e*Math.sin(6*l),t=b-2*a*Math.cos(2*l)+4*f*Math.cos(4*l)-6*e*Math.cos(6*l),n=2*q+k*(q*q+h)-2*g*(k*q+1),p=d*m*(q*q+h-2*g*q)/(2*k),k=2*(g-q)*(k*t-2/m)-2*t,n/=p+k,l+=n,1E-10>=Math.abs(n))return l;Proj4js.reportError("phi4z: No convergence");return null} function e4fn(d){var b;b=1+d;d=1-d;return Math.sqrt(Math.pow(b,b)*Math.pow(d,d))} Proj4js.Proj.poly={init:function(){0==this.lat0&&(this.lat0=90);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(d){var b,a,f,e,g;f=d.y;a=Proj4js.common.adjust_lon(d.x-this.long0);1E-7>=Math.abs(f)?(g=this.x0+this.a*a,b=this.y0-this.a* this.ml0):(b=Math.sin(f),a=Math.cos(f),f=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,f),e=Proj4js.common.msfnz(this.e,b,a),a=b,g=this.x0+this.a*e*Math.sin(a)/b,b=this.y0+this.a*(f-this.ml0+e*(1-Math.cos(a))/b));d.x=g;d.y=b;return d},inverse:function(d){var b,a;d.x-=this.x0;d.y-=this.y0;b=this.ml0+d.y/this.a;if(1E-7>=Math.abs(b))b=d.x/this.a+this.long0,a=0;else{b=b*b+d.x/this.a*(d.x/this.a);b=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,b,void 0,a);if(1!=b)return b;b=Proj4js.common.adjust_lon(Proj4js.common.asinz(NaN* d.x/this.a)/Math.sin(a)+this.long0)}d.x=b;d.y=a;return d}}; Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0)},forward:function(d){var b=d.y,a=this.x0+this.a*Proj4js.common.adjust_lon(d.x-this.long0)*Math.cos(this.lat0),b=this.y0+this.a*b;this.t1=a;this.t2=Math.cos(this.lat0);d.x=a;d.y=b;return d},inverse:function(d){d.x-=this.x0;d.y-=this.y0;var b=d.y/this.a;Math.abs(b)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var a=Proj4js.common.adjust_lon(this.long0+ d.x/(this.a*Math.cos(this.lat0)));d.x=a;d.y=b}}; Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(d){var b=d.x,a=d.y;if(90a*Proj4js.common.R2D&&180b*Proj4js.common.R2D)return Proj4js.reportError("merc:forward: llInputOutOfRange: "+b+" : "+a),null;if(Math.abs(Math.abs(a)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)return Proj4js.reportError("merc:forward: ll2mAtPoles"),null; if(this.sphere)b=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(b-this.long0),a=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*a));else var f=Math.sin(a),a=Proj4js.common.tsfnz(this.e,a,f),b=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(b-this.long0),a=this.y0-this.a*this.k0*Math.log(a);d.x=b;d.y=a;return d},inverse:function(d){var b=d.x-this.x0,a=d.y-this.y0;if(this.sphere)a=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-a/this.a*this.k0));else if(a=Math.exp(-a/(this.a*this.k0)), a=Proj4js.common.phi2z(this.e,a),-9999==a)return Proj4js.reportError("merc:inverse: lat = -9999"),null;b=Proj4js.common.adjust_lon(this.long0+b/(this.a*this.k0));d.x=b;d.y=a;return d}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){this.zone?(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R,this.x0=5E5,this.y0=this.utmSouth?1E7:0,this.k0=0.9996,Proj4js.Proj.tmerc.init.apply(this),this.forward=Proj4js.Proj.tmerc.forward,this.inverse=Proj4js.Proj.tmerc.inverse):Proj4js.reportError("utm:init: zone must be specified for UTM")}}; Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);0!=this.mode? (Math.abs(this.lat1+this.lat2)=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi):this.ns=this.sinphi;this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0, this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0)},forward:function(d){var b=d.x,a=this.a*(this.g-Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,d.y)),f=this.ns*Proj4js.common.adjust_lon(b-this.long0),b=this.x0+a*Math.sin(f),a=this.y0+this.rh-a*Math.cos(f);d.x=b;d.y=a;return d},inverse:function(d){d.x-=this.x0;d.y=this.rh-d.y+this.y0;var b,a;0<=this.ns?(a=Math.sqrt(d.x*d.x+d.y*d.y),b=1):(a=-Math.sqrt(d.x*d.x+d.y*d.y),b=-1);var f=0;0!=a&&(f=Math.atan2(b*d.x,b*d.y));b=this.phi3z(this.g- a/this.a,this.e0,this.e1,this.e2,this.e3);f=Proj4js.common.adjust_lon(this.long0+f/this.ns);d.x=f;d.y=b;return d},phi3z:function(d,b,a,f,e){var g,h;g=d;for(var k=0;15>k;k++)if(h=(d+a*Math.sin(2*g)-f*Math.sin(4*g)+e*Math.sin(6*g))/b-g,g+=h,1E-10>=Math.abs(h))return g;Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}}; Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(d){var b=d.y,a=Proj4js.common.adjust_lon(d.x-this.long0),f,e;f=Math.sin(b);var g=Math.cos(b);if(this.sphere){var h=g*Math.sin(a);if(1E-10>Math.abs(Math.abs(h)-1))return Proj4js.reportError("tmerc:forward: Point projects into infinity"), 93;e=0.5*this.a*this.k0*Math.log((1+h)/(1-h));f=Math.acos(g*Math.cos(a)/Math.sqrt(1-h*h));0>b&&(f=-f);b=this.a*this.k0*(f-this.lat0)}else{e=g*a;var a=Math.pow(e,2),g=this.ep2*Math.pow(g,2),h=Math.tan(b),k=Math.pow(h,2);f=1-this.es*Math.pow(f,2);f=this.a/Math.sqrt(f);b=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,b);e=this.k0*f*e*(1+a/6*(1-k+g+a/20*(5-18*k+Math.pow(k,2)+72*g-58*this.ep2)))+this.x0;b=this.k0*(b-this.ml0+f*h*a*(0.5+a/24*(5-k+9*g+4*Math.pow(g,2)+a/30*(61-58*k+Math.pow(k, 2)+600*g-330*this.ep2))))+this.y0}d.x=e;d.y=b;return d},inverse:function(d){var b,a,f,e;if(this.sphere){a=Math.exp(d.x/(this.a*this.k0));var g=0.5*(a-1/a);f=this.lat0+d.y/(this.a*this.k0);e=Math.cos(f);b=Math.sqrt((1-e*e)/(1+g*g));a=Proj4js.common.asinz(b);0>f&&(a=-a);b=0==g&&0==e?this.long0:Proj4js.common.adjust_lon(Math.atan2(g,e)+this.long0)}else{var g=d.x-this.x0,h=d.y-this.y0;a=b=(this.ml0+h/this.k0)/this.a;for(e=0;;e++){f=(b+this.e1*Math.sin(2*a)-this.e2*Math.sin(4*a)+this.e3*Math.sin(6*a))/ this.e0-a;a+=f;if(Math.abs(f)<=Proj4js.common.EPSLN)break;if(6<=e)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95}if(Math.abs(a)this.a+1E-7&&Proj4js.reportError("orthoInvDataError");a=Proj4js.common.asinz(b/this.a);f=Math.sin(a);e=Math.cos(a);a=this.long0;Math.abs(b);f=Proj4js.common.asinz(e*this.sin_p14+d.y*f*this.cos_p14/b);b=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(b)<=Proj4js.common.EPSLN&&(a=0<=this.lat0?Proj4js.common.adjust_lon(this.long0+Math.atan2(d.x,-d.y)):Proj4js.common.adjust_lon(this.long0-Math.atan2(-d.x,d.y)));Math.sin(f);d.x=a;d.y=f;return d}}; Proj4js.Proj.krovak={init:function(){this.a=6377397.155;this.es=0.006674372230614;this.e=Math.sqrt(this.es);this.lat0||(this.lat0=0.863937979737193);this.long0||(this.long0=0.4334234309119251);this.k0||(this.k0=0.9999);this.s45=0.785398163397448;this.s90=2*this.s45;this.fi0=this.lat0;this.e2=this.es;this.e=Math.sqrt(this.e2);this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2));this.uq=1.04216856380474;this.u0=Math.asin(Math.sin(this.fi0)/this.alfa);this.g=Math.pow((1+this.e*Math.sin(this.fi0))/ (1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2);this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g;this.k1=this.k0;this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2));this.s0=1.37008346281555;this.n=Math.sin(this.s0);this.ro0=this.k1*this.n0/Math.tan(this.s0);this.ad=this.s90-this.uq},forward:function(d){var b,a,f;a=d.y;f=Proj4js.common.adjust_lon(d.x-this.long0);b=Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.alfa* this.e/2);b=2*(Math.atan(this.k*Math.pow(Math.tan(a/2+this.s45),this.alfa)/b)-this.s45);a=-f*this.alfa;f=Math.asin(Math.cos(this.ad)*Math.sin(b)+Math.sin(this.ad)*Math.cos(b)*Math.cos(a));b=this.n*Math.asin(Math.cos(b)*Math.sin(a)/Math.cos(f));f=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(f/2+this.s45),this.n);d.y=f*Math.cos(b)/1;d.x=f*Math.sin(b)/1;this.czech&&(d.y*=-1,d.x*=-1);return d},inverse:function(d){var b,a,f;b=d.x;d.x=d.y;d.y=b;this.czech&&(d.y*=-1,d.x*=-1); b=Math.sqrt(d.x*d.x+d.y*d.y);a=Math.atan2(d.y,d.x)/Math.sin(this.s0);f=2*(Math.atan(Math.pow(this.ro0/b,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45);b=Math.asin(Math.cos(this.ad)*Math.sin(f)-Math.sin(this.ad)*Math.cos(f)*Math.cos(a));a=Math.asin(Math.cos(f)*Math.sin(a)/Math.cos(b));d.x=this.long0-a/this.alfa;a=b;var e=f=0;do d.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(b/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),1E-10> Math.abs(a-d.y)&&(f=1),a=d.y,e+=1;while(0==f&&15>e);return 15<=e?(Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null):d}}; Proj4js.Proj.somerc={init:function(){var d=this.lat0;this.lambda0=this.long0;var b=Math.sin(d),a=this.a,f=1/this.rf,f=2*f-Math.pow(f,2),e=this.e=Math.sqrt(f);this.R=this.k0*a*Math.sqrt(1-f)/(1-f*Math.pow(b,2));this.alpha=Math.sqrt(1+f/(1-f)*Math.pow(Math.cos(d),4));this.b0=Math.asin(b/this.alpha);this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+d/2))+this.alpha*e/2*Math.log((1+e*b)/(1-e*b))},forward:function(d){var b=Math.log(Math.tan(Math.PI/4-d.y/2)),a=this.e/ 2*Math.log((1+this.e*Math.sin(d.y))/(1-this.e*Math.sin(d.y))),a=2*(Math.atan(Math.exp(-this.alpha*(b+a)+this.K))-Math.PI/4),f=this.alpha*(d.x-this.lambda0),b=Math.atan(Math.sin(f)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(f))),a=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(f));d.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0;d.x=this.R*b+this.x0;return d},inverse:function(d){for(var b=(d.x-this.x0)/this.R,a=2*(Math.atan(Math.exp((d.y- this.y0)/this.R))-Math.PI/4),f=Math.asin(Math.cos(this.b0)*Math.sin(a)+Math.sin(this.b0)*Math.cos(a)*Math.cos(b)),b=this.lambda0+Math.atan(Math.sin(b)/(Math.cos(this.b0)*Math.cos(b)-Math.sin(this.b0)*Math.tan(a)))/this.alpha,e=f,g=-1E3,h=0;1E-7this.lat0?this.S_POLE:this.N_POLE:d>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;this.phits=Math.abs(this.phits);if(this.es){var b;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits- Proj4js.common.HALF_PI)=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0}},forward:function(d){var b=d.x,b=Proj4js.common.adjust_lon(b-this.long0),a=d.y,f,e;if(this.sphere){var g,h,k;g=Math.sin(a);h=Math.cos(a); k=Math.cos(b);b=Math.sin(b);switch(this.mode){case this.EQUIT:e=1+h*k;e<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Equit");e=this.akm1/e;f=e*h*b;e*=g;break;case this.OBLIQ:e=1+this.sinph0*g+this.cosph0*h*k;e<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Obliq");e=this.akm1/e;f=e*h*b;e*=this.cosph0*g-this.sinph0*h*k;break;case this.N_POLE:k=-k,a=-a;case this.S_POLE:Math.abs(a-Proj4js.common.HALF_PI)=g;g++)f*=b,e+=this.A[g]*f;for(var b=e,f=1,h=0,k=0,l=0,g=1;6>=g;g++)e=f*b-h*a,h=h*b+f*a,f=e,k=k+this.B_re[g]*f-this.B_im[g]*h,l=l+this.B_im[g]*f+this.B_re[g]*h;d.x=l*this.a+this.x0;d.y=k*this.a+this.y0;return d},inverse:function(d){for(var b=(d.y-this.y0)/this.a,a=(d.x-this.x0)/this.a,f=1,e=0,g,h=0,k=0,l=1;6>=l;l++)g= f*b-e*a,e=e*b+f*a,f=g,h=h+this.C_re[l]*f-this.C_im[l]*e,k=k+this.C_im[l]*f+this.C_re[l]*e;for(f=0;f=l;l++)p=n*h-m*k,m=m*h+n*k,n=p,g+=(l-1)*(this.B_re[l]*n-this.B_im[l]*m),e+=(l-1)*(this.B_im[l]*n+this.B_re[l]*m);for(var n=1,m=0,q=this.B_re[1],t=this.B_im[1],l=2;6>=l;l++)p=n*h-m*k,m=m*h+n*k,n=p,q+=l*(this.B_re[l]*n-this.B_im[l]*m),t+=l*(this.B_im[l]*n+this.B_re[l]*m);k=q*q+t*t;h=(g*q+e*t)/k;k=(e*q-g*t)/k}b=h;a=1;h=0;for(l=1;9>=l;l++)a*=b,h+=this.D[l]* a;l=this.lat0+1E5*h*Proj4js.common.SEC_TO_RAD;d.x=this.long0+k;d.y=l;return d}};Proj4js.Proj.mill={init:function(){},forward:function(d){var b=d.y,a=this.x0+this.a*Proj4js.common.adjust_lon(d.x-this.long0),b=this.y0+1.25*this.a*Math.log(Math.tan(Proj4js.common.PI/4+b/2.5));d.x=a;d.y=b;return d},inverse:function(d){d.x-=this.x0;d.y-=this.y0;var b=Proj4js.common.adjust_lon(this.long0+d.x/this.a),a=2.5*(Math.atan(Math.exp(0.8*d.y/this.a))-Proj4js.common.PI/4);d.x=b;d.y=a;return d}}; Proj4js.Proj.gnom={init:function(){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1E3*this.a;this.rc=1},forward:function(d){var b,a,f,e,g;a=d.y;f=Proj4js.common.adjust_lon(d.x-this.long0);b=Math.sin(a);a=Math.cos(a);e=Math.cos(f);g=this.sin_p14*b+this.cos_p14*a*e;0a&&(g=-g);a=this.x0+g;g=Math.abs(g/(Proj4js.common.PI*this.R));b=0<=b?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-g*g-2*e*g):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-g*g-2*e*g);d.x=a;d.y=b;return d},inverse:function(d){var b,a,f,e,g,h,k,l;d.x-=this.x0;d.y-=this.y0;l=Proj4js.common.PI*this.R;b=d.x/l;f=d.y/l;e=b*b+f*f;g=-Math.abs(f)*(1+e);a=g-2*f*f+b*b;h=-2*g+1+2*f*f+e*e;l=f*f/h+(2*a*a*a/h/h/h-9*g*a/h/h)/27;k=(g-a*a/3/h)/h;g=2*Math.sqrt(-k/3);l=3*l/k/g;1Math.abs(a-d.y))break;d.y=a}if(!e)return Proj4js.reportError("gauss:inverse:convergence failed"),null;d.x=b;d.y=a;return d}}; Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0);this.lon1||(this.lon1=0,this.mode=1);this.lon2||(this.lon2=0);this.lat2||(this.lat2=0);var d=1-Math.pow(this.b/this.a,2);Math.sqrt(d);this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-d);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-d));this.al=this.a*this.bl*this.k0*this.com/this.con;Math.abs(this.lat0) Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=0<=this.lat0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi), this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=0.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this.dlon<-Proj4js.common.PI&&(this.lon2-=2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2+=2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2, this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"): Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=0<=this.lat0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(d){var b,a,f,e,g;f=d.x;a=d.y;b=Math.sin(a);e=Proj4js.common.adjust_lon(f-this.longc); f=Math.sin(this.bl*e);Math.abs(Math.abs(a)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(b=Proj4js.common.tsfnz(this.e,a,b),b=this.el/Math.pow(b,this.bl),g=0.5*(b-1/b),b=(g*this.singam-f*this.cosgam)/(0.5*(b+1/b)),a=Math.cos(this.bl*e),1E-7>Math.abs(a)?f=this.al*this.bl*e:(f=this.al*Math.atan((g*this.cosgam+f*this.singam)/a)/this.bl,0>a&&(f+=Proj4js.common.PI*this.al/this.bl))):(b=0<=a?this.singam:-this.singam,f=this.al*a/this.bl);Math.abs(Math.abs(b)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"); e=0.5*this.al*Math.log((1-b)/(1+b))/this.bl;f-=this.u;b=this.y0+f*this.cosaz-e*this.sinaz;d.x=this.x0+e*this.cosaz+f*this.sinaz;d.y=b;return d},inverse:function(d){var b,a,f,e;d.x-=this.x0;d.y-=this.y0;b=d.x*this.cosaz-d.y*this.sinaz;f=d.y*this.cosaz+d.x*this.sinaz;f+=this.u;a=Math.exp(-this.bl*b/this.al);b=0.5*(a-1/a);a=0.5*(a+1/a);f=Math.sin(this.bl*f/this.al);e=(f*this.cosgam+b*this.singam)/a;Math.abs(Math.abs(e)-1)<=Proj4js.common.EPSLN?(b=this.longc,e=0<=e?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI): (a=1/this.bl,e=Math.pow(this.el/Math.sqrt((1+e)/(1-e)),a),e=Proj4js.common.phi2z(this.e,e),b=this.longc-Math.atan2(b*this.cosgam-f*this.singam,a)/this.bl,b=Proj4js.common.adjust_lon(b));d.x=b;d.y=e;return d}}; Proj4js.Proj.lcc={init:function(){this.lat2||(this.lat2=this.lat0);this.k0||(this.k0=1);if(Math.abs(this.lat1+this.lat2)Proj4js.common.EPSLN?Math.log(b/e)/Math.log(a/f):d;this.f0=b/(this.ns*Math.pow(a,this.ns));this.rh=this.a*this.f0*Math.pow(g,this.ns);this.title||(this.title="Lambert Conformal Conic")}},forward:function(d){var b=d.x,a=d.y;if(!(90>=a&&-90<=a&&180>=b&&-180<=b))return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+b+" : "+a),null;var f=Math.abs(Math.abs(a)-Proj4js.common.HALF_PI);if(f>Proj4js.common.EPSLN)a=Proj4js.common.tsfnz(this.e, a,Math.sin(a)),a=this.a*this.f0*Math.pow(a,this.ns);else{f=a*this.ns;if(0>=f)return Proj4js.reportError("lcc:forward: No Projection"),null;a=0}b=this.ns*Proj4js.common.adjust_lon(b-this.long0);d.x=this.k0*a*Math.sin(b)+this.x0;d.y=this.k0*(this.rh-a*Math.cos(b))+this.y0;return d},inverse:function(d){var b,a,f,e=(d.x-this.x0)/this.k0,g=this.rh-(d.y-this.y0)/this.k0;0this.lat0?this.S_POLE:this.N_POLE:Math.abs(d)h){Proj4js.reportError("aeqd:Fwd:PointError");return}}else a=Math.acos(h),a/=Math.sin(a);d.x=this.x0+this.a*a*e*Math.sin(b);d.y=this.y0+this.a*a*(this.cos_p12*f-this.sin_p12*e*g);return d}, inverse:function(d){d.x-=this.x0;d.y-=this.y0;var b=Math.sqrt(d.x*d.x+d.y*d.y);if(b>2*Proj4js.common.HALF_PI*this.a)Proj4js.reportError("aeqdInvDataError");else{var a=b/this.a,f=Math.sin(a),a=Math.cos(a),e=this.long0,g;if(Math.abs(b)<=Proj4js.common.EPSLN)g=this.lat0;else{g=Proj4js.common.asinz(a*this.sin_p12+d.y*f*this.cos_p12/b);var h=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(h)<=Proj4js.common.EPSLN?e=0<=this.lat0?Proj4js.common.adjust_lon(this.long0+Math.atan2(d.x,-d.y)):Proj4js.common.adjust_lon(this.long0- Math.atan2(-d.x,d.y)):(h=a-this.sin_p12*Math.sin(g),Math.abs(h)Proj4js.common.PI&&(a=Proj4js.common.PI);b=(2*b+Math.sin(2*b))/Proj4js.common.PI;1D?0:Math.floor((D-f)/F)-1;F=D+Math.ceil(Math.abs(m-f)/F);idxRange={lowerX:v,upperX:A,lowerY:D,upperY:F};for(F=idxRange.lowerY;Fb/2)){var f=G.TileMatrix[e].TopLeftCorner,w=parseFloat(f.split(" ")[0]),s=parseFloat(f.split(" ")[1]),f=q.FromMapPoint(w,s),n=q.ToMapPoint(0,0),u=q.ToMapPoint(q.getClientWidth(),q.getClientHeight()),D,O,T,Z,P;D=n.xs?0:Math.floor((s-h)/b);Z=T+Math.ceil(Math.abs(l-h)/b);P=n.xs?0:Math.floor((s- n.y)/b);n=s+Math.ceil(Math.abs(u.y-n.y)/b);b=Math.max(P,D);O=Math.min(w,O);s=Math.max(s,T);Z=Math.min(n,Z);if(v!=b||z!=O||A!=s||I!=Z||e!=H){v=b;z=O;A=s;I=Z;H=e;parseFloat(G.TileMatrix[e].MatrixWidth);parseFloat(G.TileMatrix[e].MatrixHeight);var M;T=[];n=D=0;for(u=s;u<=Z;u++){T.push([]);for(P=b;P<=O;P++)w=f.x+256*P,s=f.y+256*u,M=document.createElement("img"),M.style.display="none",M.onload=function(){var a=this,b=0;a.style.opacity=b;var d=F/7,e=setInterval(function(){b>=F?(M.style.filter="alpha(opacity="+ 100*F+")",a.style.opacity=F,clearInterval(e)):(a.style.opacity=b,a.style.filter="alpha(opacity="+100*b+")",b+=d)},33);a.style.filter="alpha(opacity=0)";this.style.display="block"},M.xIdx=P,M.yIdx=u,M.style.position="absolute",M.style.left=w+"px",M.style.top=s+"px",M.galleryImg=!1,M.hideFocus=!0,M.style.MozUserSelect="none",M.border="0px",T[n].push(M),M.src=d+"?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&Layer="+a.layer+"&Style=default&Format=image/png&TileMatrixSet="+a.matrixSet+"&TileMatrix="+G.TileMatrix[e]["ows:Identifier"]+ "&TileRow="+u+"&TileCol="+P,p.appendChild(M),M.style.opacity=F,M.style.filter="alpha(opacity="+100*F+")",D++;n++}if(0z.indexOf("3826")&&(0<= z.indexOf("3825")?(d=TGOS.TWD97toTWD97_119(d.x,d.y),e=TGOS.TWD97toTWD97_119(e.x,e.y)):0<=z.indexOf("4326")&&(d=TGOS.TWD97toWGS84(d.x,d.y),e=TGOS.TWD97toWGS84(e.x,e.y)));break;case TGOS.TGCoordSys.EPSG3825:0>z.indexOf("3825")&&(0<=z.indexOf("3826")?(d=TGOS.TWD97_119toTWD97(d.x,d.y),e=TGOS.TWD97_119toTWD97(e.x,e.y)):0<=z.indexOf("4326")&&(d=TGOS.TWD97_119toWGS84(d.x,d.y),e=TGOS.TWD97_119toWGS84(e.x,e.y)))}var f=d.x,p=e.y,n=e.x,u=d.y;"1.3.0"==v&&0>z.indexOf("CRS:84")&&0<=z.indexOf("EPSG:4326")&&(f=e.y, p=d.x,n=d.y,u=e.x);a=h+"?BBOX="+(f+","+p+","+n+","+u)+"&WIDTH="+a+"&HEIGHT="+b;a+="&"+A.join("&");m&&(a=m+"?"+a);return a}}function g(){if(l){var a=k.getClientWidth(),b=k.getClientHeight(),d=k.ToMapPoint(0,0),e=k.ToMapPoint(a,b);return{left:d.x,top:d.y,right:e.x,bottom:e.y,width:a,height:b}}}var h,k,l=null,n=!0,m,p="auto",q,t=1,l=a.map,u=l.getPanes().overlayviewLayer;a&&(void 0!==a.opacity&&"number"==typeof a.opacity&&(t=a.opacity),void 0!==a.visible&&"boolean"==typeof a.visible&&(n=a.visible),void 0!== a.zIndex&&"number"==typeof a.zIndex&&(p=a.zIndex),void 0!==a.container&&(u=a.container),void 0!==a.proxy&&(m=0a?d=u.firstChild:a>=b||(d=u.childNodes[a]));u.removeChild(layerContainer);d?u.insertBefore(layerContainer,d):u.appendChild(layerContainer)}};this.RemoveSelf=function(){u&&F&&u.removeChild(F)};this.getLayerId=function(){return layerID};this.getNode= function(){return F};this.getDefaultViewport=function(){};this.getUrl=function(){return h};this.removeWmsLayer=function(){l.removeLayer(this)};this.getZIndex=function(){return p};this.setZIndex=function(a){p=a;F&&(F.style.zIndex=p)};this.getWmsVisible=function(){return this.getVisible()};this.getVisible=function(){return n};this.setWmsVisible=function(a){this.setVisible(a)};this.setVisible=function(a){n=a;F&&(F.style.display=n?"block":"none")};this.putVisible=function(a){this.setVisible(a)};this.setProxy= function(a){a&&(m=0a.x?a.x=0:a.x>p.getClientWidth()&& (a.x=p.getClientWidth());0>a.y?a.y=0:a.y>p.getClientHeight()&&(a.y=p.getClientHeight());0>b.x?b.x=0:b.x>p.getClientWidth()&&(b.x=p.getClientWidth());0>b.y?b.y=0:b.y>p.getClientHeight()&&(b.y=p.getClientHeight());if(!(a.x>b.x||a.y>b.y)){var d=p.ToMapPoint(a.x,a.y),e=p.ToMapPoint(b.x,b.y);C=d.x;L=d.y;J=e.x;O=e.y;nWidth=parseInt(b.x-a.x);nHeight=parseInt(b.y-a.y);"MSIE"==DeviceTest()?AttachEvent(P,"readystatechange",Q,!1):AttachEvent(P,"load",Q,!1);H==G&&(a="?"+B.join("&"),"97"!=h&&(b=l.Inverse(n,new CPoint3(C, L,0)),d=l.Inverse(n,new CPoint3(J,O,0)),C=b.X,L=b.Y,J=d.X,O=d.Y),a+="&BBOX="+C+","+O+","+J+","+L+"&WIDTH="+nWidth+"&HEIGHT="+nHeight,P.src=F+a)}}};var V=function(a,b){N=b};this.CreateLegend=function(a){if(1a.x?a.x=0:a.x>g.getClientWidth()&&(a.x=g.getClientWidth());0>a.y?a.y=0:a.y>g.getClientHeight()&&(a.y=g.getClientHeight());0>d.x?d.x=0:d.x>g.getClientWidth()&&(d.x=g.getClientWidth());0>d.y?d.y=0:d.y>g.getClientHeight()&&(d.y=g.getClientHeight());if(!(a.x>d.x||a.y>d.y)){var e=g.ToMapPoint(a.x,a.y),f=g.ToMapPoint(d.x,d.y);A=e.x;I=e.y;F=f.x;H=f.y;nWidth=parseInt(d.x-a.x);nHeight=parseInt(d.y-a.y);a="/GetImage?V="+ G+"&S="+D.valueOf()+"&Width="+nWidth+"&Height="+nHeight+"&Left="+A+"&Top="+I+"&Right="+F+"&Bottom="+H;"MSIE"==DeviceTest()?AttachEvent(B,"readystatechange",s,!1):AttachEvent(B,"load",s,!1);B.src=b+a}}};var w=function(a,b){E=b};this.CreateLegend=function(a){if(1=e?a/-e-g:d.Z/f-g*(1-this.es),a=180*Math.atan(f/e)/Math.PI;d=0!= d.X?180*Math.atan2(d.Y,d.X)/Math.PI:0Math.abs(v))break}n=q;m=Math.PI/2;Math.abs(n)>=m?k=new CPoint3(0,0>l.Y?-m:m,l.Z):(t=Math.sin(n),m=Math.cos(n),p=1E-10=Math.abs(Math.abs(n.Y)-g))l=null;else{var m=n.X,p=Math.log(Math.tan(h+0.5*n.Y));l=new CPoint3(m,p,n.Z)}else 1E-10>=Math.abs(Math.abs(n.Y)-g)?l=null:(m=n.X,p=-Math.log(e(n.Y,Math.sin(n.Y),Math.sqrt(k.es))), l=new CPoint3(m,p,n.Z));l.X=l.X*f*k.SemiMajorAxis+b;l.Y=l.Y*f*k.SemiMajorAxis+a;return l};this.Inverse=function(e,h){var n=CPoint3((h.X-b)/e.SemiMajorAxis/f,(h.Y-a)/e.SemiMajorAxis/f,h.Z);if(0==e.es){var m=g-2*Math.atan(Math.exp(-n.Y));h=new CPoint3(n.X,m,n.Z)}else{var m=Math.exp(-n.Y),p=Math.sqrt(e.es),q=0.5*p,t=g-2*Math.atan(m);i=15;do var u=p*Math.sin(t),u=g-2*Math.atan(m*Math.pow((1-u)/(1+u),q))-t,t=t+u;while(1E-10k-1?k-1:0>a?0:a;if((a>=k||0>a)&&g==b)return!1;g= b;h=Math.pow(2,g);return!0};this.getScale=function(){return f*h};this.putScale=function(a){this.putMapLevel(Math.log(a/f)/Math.LN2)};this.getScaleX=function(){return f*h};this.getScaleY=function(){return e*h}} function MapBase(d,b){var a,f,e,g,h,k=0,l=0,n=0,m=0,p=null;e=[];g=[];h=null;p=b;a=d.ownerDocument.createElement("div");d.appendChild(a);a.style.position="absolute";a.style.overflow="hidden";a.style.left="0px";a.style.top="0px";a.style.width="100%";a.style.height="100%";a.style.zIndex=0;f=a.ownerDocument.createElement("div");a.appendChild(f);f.style.position="absolute";f.style.left="0px";f.style.top="0px";f.style.width="100%";f.style.height="100%";f.style.zIndex=0;var k=Number(f.clientWidth),l=Number(f.clientHeight), q,t=FuncAdapter(this,function(){if(k!=Number(f.clientWidth)||l!=Number(f.clientHeight))q&&clearTimeout(q),q=setTimeout(FuncAdapter(this,function(){this.RefreshMap(!0,!0)}),1E3),this.RefreshMap(!1,!1)});AttachEvent(f,"resize",t,!1);this.setColor=function(a){f.style.background=a};this.FinalRelease=function(){this.SelectMapTool(null);this.RemoveAllElements();DetachEvent(f,"resize",t,!1);a.removeChild(a)};this.getHObject=function(){return f};this.getHPackage=function(){return a};this.getClientWidth=function(){return k}; this.getClientHeight=function(){return l};this.getCenterX=function(){return n};this.putCenterX=function(a){n=a};this.getCenterY=function(){return m};this.putCenterY=function(a){m=a};this.getTransformation=function(){return p};this.putScale=function(a){p=a};this.getScale=function(){return p.getScale()};this.putScale=function(a){p.putScale(a)};this.getCellSizeX=function(){return this.ToMapDistX(1)};this.getCellSizeY=function(){return this.ToMapDistY(1)};this.MoveMapTo=function(a,b){this.putCenterX(a); this.putCenterY(b)};this.ZoomMapTo=function(a){if(null!=a.left&&null!=a.top&&null!=a.right&&null!=a.bottom){this.MoveMapTo((a.right+a.left)/2,(a.bottom+a.top)/2);var b=l/(a.bottom-a.top);this.putScale(Math.min(Math.abs(k/(a.right-a.left)),Math.abs(b)))}};this.getPackageOffset=function(){var b=0,d=0,d=a.getBoundingClientRect(),b=d.left,d=d.top;return new TGOS.TGPoint(b,d)};this.getCursorPosition=function(a){if(null==a)return null;var b=this.getPackageOffset();return new TGOS.TGPoint(a.clientX-b.x, a.clientY-b.y)};this.ToMapPoint=function(a,b){return new TGOS.TGPoint(this.ToMapDistX(a-k/2)+n,this.ToMapDistY(b-l/2)+m)};this.FromMapPoint=function(a,b){return new TGOS.TGPoint(this.FromMapDistX(a-n)+k/2,this.FromMapDistY(b-m)+l/2)};this.ToMapDistX=function(a){return a/p.getScaleX()};this.ToMapDistY=function(a){return a/p.getScaleY()};this.FromMapDistX=function(a){return a*p.getScaleX()};this.FromMapDistY=function(a){return a*p.getScaleY()};this.SelectMapTool=function(a){if(a){if(a.InitMapEvent)return h&& h.ExitMapEvent&&h.ExitMapEvent(),a.InitMapEvent(this),h=a,!0}else h&&h.ExitMapEvent&&(h.ExitMapEvent(),h=null);return!1};this.getLayers=function(){return e};this.AddLayer=function(a){null!=a&&(a.Initialize&&a.Initialize(this),e.push(a))};this.RemoveLayer=function(a){var b,d=e.length;for(b=0;bthis.FromMapDistX(m.getLeft()))&&(a=m.getLeft());m.getTop&&(null== b||this.FromMapDistY(b)>this.FromMapDistY(m.getTop()))&&(b=m.getTop());m.getRight&&(null==d||this.FromMapDistX(d)a.Left!=this.Right>this.Left||(this.Left=a.Left),!a.Top||null!=this.Top&&this.Topa.Bottom!=this.Top>this.Bottom||(this.Bottom=a.Bottom))};this.Shrink= function(a){a.constructor==TGOS.TGEnvelope&&(!a.Left||null!=this.Left&&this.Leftthis.Left||(this.Left=a.Left),!a.Top||null!=this.Top&&this.Top>a.Top!=this.Bottoma.Right!=this.Leftthis.Bottom||(this.Bottom=a.Bottom))};this.toString=function(){return Math.min(this.Left,this.Right)+" "+Math.min(this.Top,this.Bottom)+","+ Math.max(this.Left,this.Right)+" "+Math.max(this.Top,this.Bottom)}};function Overview(d,b,a,f,e,g){function h(a,b){var d,e,f=!1;this.ExitMapEvent=null;this.IsMapAction=function(){return f};this.InitMapEvent=function(g){var m=g.getHObject(),h=function(a){var b=a.screenX-d,f=a.screenY-e;d=a.screenX;e=a.screenY;g.MoveMapTo(g.getCenterX()-g.ToMapDistX(b),g.getCenterY()-g.ToMapDistY(f));g.RefreshMap(!1)},l=function(a){DetachEvent(m,"mousemove",h,!0);DetachEvent(m,"mouseup",l,!1);g.RefreshMap(!0);f=!1},k=function(a){util.disableDefault(a);f=!0;d=a.screenX;e=a.screenY;AttachEvent(m, "mouseup",l,!1);AttachEvent(m,"mousemove",h,!0)},p=function(b){a&&(f=!0,b=g.getCursorPosition(b),b=g.ToMapPoint(b.X,b.Y),g.MoveToAnimation(b,g.getScale(),function(){f=!1}))},n=function(a){if(b){f=!0;var d=g.getCursorPosition(a),d=g.ToMapPoint(d.X,d.Y),e=g.getScale(),m=a.wheelDelta?a.wheelDelta:-a.detail;a=0;0m&&(a=-1);m=1;m=g.getTransformation();m=null!=m&&null!=m.getLevelScale&&null!=m.getMapLevel?m.getLevelScale(m.getMapLevel()+a)/e:Math.pow(2,a);e*=m;d=new MapPoint((g.getCenterX()-d.X)/ m+d.X,(g.getCenterY()-d.Y)/m+d.Y);g.MoveToAnimation(d,e,function(){f=!1})}};this.ExitMapEvent=function(){b&&DetachEvent(m.ownerDocument,"mousewheel",n,!1);DetachEvent(m,"mousedown",k,!1);a&&DetachEvent(m,"dblclick",p,!1)};AttachEvent(m,"mousedown",k,!1);a&&AttachEvent(m,"dblclick",p,!1);b&&AttachEvent(m.ownerDocument,"mousewheel",n,!1)}}function k(a){switch(a){case "Open":d.style.width=f+"px";d.style.height=e+"px";d.style.border="2px solid";l.style.width=f+"px";l.style.height=e+"px";q.alt="Open"; q.src=TGOS.RES_PATH+"ShowClose.gif";q.status=!0;break;case "Close":d.style.width="11px",d.style.height="11px",d.style.border="0px",l.style.width="11px",l.style.height="11px",q.alt="Open",q.src=TGOS.RES_PATH+"ShowOpen.gif",q.status=!1}}var l=null,n=null,m=null,p=null,q,t=null,u=null;this.Show=function(a){a?(d.style.display="inline",k("Open")):d.style.display="none"};this.Minimize=function(){k("Close")};this.FinalRelease=function(){b.RemoveElement(this);p&&p.FinalRelease&&p.FinalRelease();p=null;m&& m.FinalRelease&&m&&m.FinalRelease&&m.FinalRelease();m=null;n&&d.removeChild(n);n=null};this.CenterXY=function(){return new MapPoint(m.getCenterX(),m.getCenterY())};this.SelectAreaHide=function(){m_IndexObj.style.visibility="hidden"};this.SelectAreaShow=function(){m_IndexObj.style.visibility="visible"};this.getTarget=function(){return b};this.getMapBase=function(){return m};this.UpdateElement=function(){p.UpdateElement()};this.RebuildElement=function(){null!=p&&p.RebuildElement();if(null!=m){var a= b.getScale()/Math.pow(2,g);m.MoveToAnimation(new MapPoint(b.getCenterX(),b.getCenterY()),a)}};var v=new ScaleTransformation(1);v.putBaseScaleX(a.getBaseScaleX());v.putBaseScaleY(a.getBaseScaleY());l=document.createElement("div");d.appendChild(l);l.style.position="absolute";l.style.right="0px";l.style.bottom="0px";this.setColor=function(a){l.style.backgroundColor=a};l.style.width=f-10+"px";l.style.height=e-10+"px";l.style.overflow="hidden";n=document.createElement("div");l.appendChild(n);n.style.position= "absolute";n.style.overflow="hidden";n.style.right="0px";n.style.bottom="0px";n.style.width=f+"px";n.style.height=e+"px";q=l.ownerDocument.createElement("img");q.onreadystatechange=function(){n.style.right=q.offsetWidth-10+"px";n.style.width=f+"px";n.style.height=e+"px";q.onstatechange=null};l.appendChild(q);q.style.position="absolute";q.style.right="0px";q.style.bottom="0px";q.status=!0;q.alt="Close";q.style.cursor="pointer";var z=null;this.setStyle=function(a){};q.onclick=function(){var a=function(b, e){var f=parseInt(l.style.width),g=parseInt(l.style.height),m=b-f,h=e-g;10>Math.abs(m)||10>Math.abs(h)?(d.style.width=b+"px",d.style.height=e+"px",l.style.width=b+"px",l.style.height=e+"px",d.style.border="0px",z=null,q.status&&(d.style.border="2px solid",d.style.width=b+"px",d.style.height=e+"px",l.style.width=b+"px",l.style.height=e+"px")):(d.style.width=f+m/2+"px",d.style.height=g+h/2+"px",l.style.width=f+m/2+"px",l.style.height=g+h/2+"px",z=setTimeout(function(){a(b,e)},50))};null!=z&&clearTimeout(z); z=null;(q.status=!q.status)?(q.alt="Close",q.src=TGOS.RES_PATH+"ShowClose.gif",a(f,e)):(q.alt="Open",q.src=TGOS.RES_PATH+"ShowOpen.gif",d.style.border="2px solid",a(parseInt(q.offsetWidth),parseInt(q.offsetHeight)))};m=new MapBase(n,v,"0px","0px","100%","100%");m.MoveMapTo(b.getCenterX(),b.getCenterY());m.RefreshMap(!0);p=new function(a){var b=a.getTarget(),d=a.getMapBase(),e=!1,f=new h(!1,!1),g=d.getHPackage(),m=document.createElement("div");g.appendChild(m);m.style.position="absolute";m.style.overflow= "hidden";m.style.width="40px";m.style.height="40px";m.style.left="15px";m.style.top="15px";m.style.border="inset 1px #0300FA";a=m.ownerDocument.createElement("div");m.appendChild(a);a.style.filter="Alpha(Opacity=35)";a.style.opacity=0.35;a.style.MozOpacity=0.35;a.style.MozUserSelect="none";a.style.backgroundColor="#5e38ff";a.style.width="100%";a.style.height="100%";var l,k,p=function(a){var e=a.screenX-l,f=a.screenY-k;l=a.screenX;k=a.screenY;b.MoveMapTo(b.getCenterX()+d.ToMapDistX(e),b.getCenterY()+ d.ToMapDistY(f));b.RefreshMap(!1)},w=function(a){m.style.cursor="default";DetachEvent(m,"mousemove",p,!0);DetachEvent(m,"mouseup",w,!1);b.RefreshMap(!0)},n=function(a){util.disableDefault(a);l=a.screenX;k=a.screenY;m.style.cursor="move";AttachEvent(m,"mousemove",p,!0);AttachEvent(m,"mouseup",w,!1)};AttachEvent(m,"mousedown",n,!1);d.SelectMapTool(f);d.AddElement(this);this.FinalRelease=function(){d.RemoveElement(this);DetachEvent(m,"mousedown",n,!1);f&&f.FinalRelease&&f.FinalRelease();f=null;m&&g.removeChild(m); m=null};this.UpdateElement=function(){if(f.IsMapAction())e||(e=!0,t.x=parseInt(m.style.left)+parseInt(m.style.width)/2,t.y=parseInt(m.style.top)+parseInt(m.style.height)/2,a=d.ToMapPoint(t.x,t.y),b.MoveMapTo(a.x,a.y),b.RefreshMap(!1),e=!1);else{var a=b.ToMapPoint(0,0),g=b.ToMapPoint(b.getClientWidth(),b.getClientHeight());t=d.FromMapPoint(a.x,a.y);u=d.FromMapPoint(g.x,g.y);t.x&&t.y&&u.x&&u.y&&(m.style.left=t.x+"px",m.style.top=t.y+"px",m.style.width=u.x-t.x+"px",m.style.height=u.y-t.y+"px")}};this.RebuildElement= function(){f.IsMapAction()&&!e&&(e=!0,b.RefreshMap(!0),e=!1)}}(this);b.AddElement(this);this.RebuildElement()};TGOS.CTRL_ZINDEX=214748364; TGOS.HtmlControl=function(d,b,a,f,e){this.getDiv=function(){return k};this.getPosition=function(){return g};this.setPosition=function(a){var e=d.controls[g].indexOf(k);b in TGOS.TGControlPosition&&(0<=e&&d.controls[g].removeAt(e),d.controls[a].push(k),g=a)};this.setContent=function(a){"string"==typeof a&&(h.innerHTML=a)};this.remove=function(){d.getMapBase().RemoveElement(this);var a=d.controls[g];a.removeAt(a.indexOf(k))};var g=null,h=null,k=null,g=TGOS.TGControlPosition.BOTTOM_LEFT;b in TGOS.TGControlPosition&& (g=b);k=document.createElement("div");util.disableSelect(k);k.style.width="250px";k.style.height="50px";h=document.createElement("div");k.appendChild(h);h.innerHTML=a;h.style.position="absolute";h.style.fontFamily="calibri,\u5fae\u8edf\u6b63\u9ed1\u9ad4";h.style.fontWeight="600";h.style.left="5px";k.style.position="absolute";this.setPosition(g)}; TGOS.CopyrightControl=function(d,b){this.getDiv=function(){return e};this.getPosition=function(){return a};this.setPosition=function(f){var g=d.controls[a].indexOf(e);b in TGOS.TGControlPosition&&(0<=g&&d.controls[a].removeAt(g),d.controls[f].push(e),a=f)};var a=null,f=null,e=null,g=(new Date).getFullYear(),a=TGOS.TGControlPosition.BOTTOM_LEFT;b in TGOS.TGControlPosition&&(a=b);e=document.createElement("div");util.disableSelect(e);e.style.width="250px";e.style.height="20px";f=document.createElement("div"); e.appendChild(f);f.innerHTML="TGOS MAP \u00a9 "+g+" \u5167\u653f\u90e8,\u4ea4\u901a\u90e8";f.style.position="absolute";f.style.fontFamily="calibri,\u5fae\u8edf\u6b63\u9ed1\u9ad4";f.style.fontWeight="900";f.style.left="5px";e.style.position="absolute";this.setPosition(a)}; TGOS.MapTypeBarControl=function(d,b,a,f){function e(a){u=document.createElement("div");u.style.position="absolute";u.style.overflow="hidden";v=document.createElement("table");v.style.borderSpacing="0";v.border="0";u.appendChild(v);for(var b=v.insertRow(-1),e=0;e f?1:5>f?2:5)*k,g=b.FromMapDistX(f*g)+2,n=d/0.3048,k=n,B=1,d="\u82f1\u544e";21702k?1:5>k?2:5)*n;B=b.FromMapDistX(0.3048*k*B)+2;z.Inverse(v,new CPoint3(b.getCenterX(),b.getCenterY(),0));l.style.width=Math.round(Math.max(g,B))+"px";m.style.left=Math.round(g-4)+"px";p.style.left=Math.round(B-4)+"px";t.innerHTML=f+a;q.innerHTML=k+d;Math.round(Math.max(g,B))}};this.display=function(a){k.style.display= !1==a?"none":""};this.ControlOptionsChang=function(a,b){Location(b.getClientWidth(),b.getClientHeight())};this.setPosition(n);this.setStyle(u);this.UpdateElement()};function initControlArray(d){var b=d.controls,a=function(){f.BOTTOM_CENTER_update.call(b.BOTTOM_CENTER);f.BOTTOM_LEFT_update.call(b.BOTTOM_LEFT);f.BOTTOM_RIGHT_update.call(b.BOTTOM_RIGHT);f.LEFT_BOTTOM_update.call(b.LEFT_BOTTOM);f.LEFT_CENTER_update.call(b.LEFT_CENTER);f.LEFT_TOP_update.call(b.LEFT_TOP);f.RIGHT_BOTTOM_update.call(b.RIGHT_BOTTOM);f.RIGHT_CENTER_update.call(b.RIGHT_CENTER);f.RIGHT_TOP_update.call(b.RIGHT_TOP);f.TOP_CENTER_update.call(b.TOP_CENTER);f.TOP_LEFT_update.call(b.TOP_LEFT); f.TOP_RIGHT_update.call(b.TOP_RIGHT)},f={BOTTOM_CENTER_update:function(){var a=0,e=0;b.BOTTOM_CENTER.forEach(function(b,f){var n=parseInt(b.clientWidth,10),m=parseInt(b.clientHeight,10),p=0<=d.getMapSize().width/2-n/2?d.getMapSize().width/2-n/2:0;a+=n;e=Math.max(e,m);b.style.right="auto";b.style.left=p+"px";b.style.top="auto";b.style.bottom="0px"});b.BOTTOM_CENTER.totalWidth=a;b.BOTTOM_CENTER.totalHeight=e},BOTTOM_LEFT_update:function(){var a=0,d=0;b.BOTTOM_LEFT.forEach(function(b,e){var f=parseInt(b.scrollWidth, 10),m=parseInt(b.scrollHeight,10);a+=f;d=Math.max(d,m);b.style.right="auto";b.style.left=a-f+"px";b.style.top="auto";b.style.bottom="0px"});b.BOTTOM_LEFT.totalWidth=a;b.BOTTOM_LEFT.totalHeight=d},BOTTOM_RIGHT_update:function(){var a=0,d=0;b.BOTTOM_RIGHT.forEach(function(b,e){var f=parseInt(b.clientWidth,10),m=parseInt(b.clientHeight,10);a+=f;d=Math.max(d,m);b.style.left="auto";b.style.right=a-f+"px";b.style.top="auto";b.style.bottom="0px"});b.BOTTOM_RIGHT.totalWidth=a;b.BOTTOM_RIGHT.totalHeight=d}, TOP_LEFT_update:function(){var a=0,d=0;b.TOP_LEFT.forEach(function(b,e){var f=parseInt(b.clientWidth,10),m=parseInt(b.clientHeight,10);a+=f;d=Math.max(d,m);b.style.right="auto";b.style.left=a-f+"px";b.style.bottom="auto";b.style.top="0px"});b.TOP_LEFT.totalWidth=a;b.TOP_LEFT.totalHeight=d},TOP_CENTER_update:function(){var a=0,e=0;b.TOP_CENTER.forEach(function(b,f){var n=parseInt(b.clientWidth,10),m=parseInt(b.clientHeight,10),p=0<=d.getMapSize().width/2-n/2?d.getMapSize().width/2-n/2:0;a+=n;e=Math.max(e, m);b.style.right="auto";b.style.left=p+"px";b.style.bottom="auto";b.style.top="0px"});b.TOP_CENTER.totalWidth=a;b.TOP_CENTER.totalHeight=e},TOP_RIGHT_update:function(){var a=0,d=0;b.TOP_RIGHT.forEach(function(b,e){var f=parseInt(b.clientWidth,10),m=parseInt(b.clientHeight,10);a+=f;d=Math.max(d,m);b.style.left="auto";b.style.right=a-f+"px";b.style.bottom="auto";b.style.top="0px"});b.TOP_RIGHT.totalWidth=a;b.TOP_RIGHT.totalHeight=d},LEFT_TOP_update:function(){var a=0,d=0,e=0;0=a&&(a=0);return this.insertAt(a,b)};d.pop=function(){var b=this.arr_.length-1;if(!(0>b))return this.removeAt(b)};d.forEach=function(b){for(var a=0;athis.arr_.length- 1)){var a=this.arr_.splice(b,1);TGOS.TGEvent.trigger_(this,"remove_at",b,a[0]);TGOS.TGEvent.trigger_(this,"changed");return a}};d.insertAt=function(b,a){b>this.arr_.length||(this.arr_.splice(b,0,a),TGOS.TGEvent.trigger_(this,"insert_at",b),TGOS.TGEvent.trigger_(this,"changed"))};d.setAt=function(b,a){if(!(b>this.arr_.length-1)){var d=this.arr_[b];this.arr_.splice(b,1,a);TGOS.TGEvent.trigger_(this,"set_at",b,d);TGOS.TGEvent.trigger_(this,"changed")}};d.indexOf=function(b){return this.arr_.indexOf(b)}; TGOS.RegisterEvent(TGOS.MVCArray,["insert_at","remove_at","set_at","changed"])})();(function(){var d=new HorizontalDatum(6378137,0),b=new MercatorProjection(0,0,0,1),a=function(a,b){this.map=b;this.add=function(b){a.push(b)};this.remove=function(b){var d=this.map.getMapBase(),e=a.indexOf(b);-1!=e&&(a.splice(e,1),d.getHPackage().contains(b.getElement())&&d.getHPackage().removeChild(b.getElement()))};this.UpdateElement=function(){for(var b=0;b=a.length)){var b=a[0].getEventElement();if(b)for(var d=a.length,e=1;ed){a.splice(f,0,b);break}else if(f==a.length-1){a.push(b);break}}; this.updateElementOrder=function(b){if(b){var d=b.getEventElement();if(d&&(b=b.getZIndex(),0!==a.length))for(var e=a.length,f=0;fb){d.insertBefore(h);break}else if(f==a.length-1){d.toFront();break}}}};this.containing=function(b){return 0<=a.indexOf(b)};this.remove=function(b){b=a.indexOf(b);a.splice(b,1)};this.UpdateElement=function(){for(var b=a.length,d=0;dthis.overlayForwardEvents.indexOf(a[b])&&this.overlayForwardEvents.push(a[b]);else a instanceof String&&0>this.overlayForwardEvents.indexOf(a)&&this.overlayForwardEvents.push(a)};this.getOverlayForwardEvents=function(){return this.overlayForwardEvents};this.controls={BOTTOM_CENTER:new TGOS.MVCArray,BOTTOM_LEFT:new TGOS.MVCArray,BOTTOM_RIGHT:new TGOS.MVCArray,LEFT_BOTTOM:new TGOS.MVCArray,LEFT_CENTER:new TGOS.MVCArray, LEFT_TOP:new TGOS.MVCArray,RIGHT_BOTTOM:new TGOS.MVCArray,RIGHT_CENTER:new TGOS.MVCArray,RIGHT_TOP:new TGOS.MVCArray,TOP_CENTER:new TGOS.MVCArray,TOP_LEFT:new TGOS.MVCArray,TOP_RIGHT:new TGOS.MVCArray};this.setKeyboardEdit=function(a,b){M.OpenCloseKeyboardEditor(a,b)};this.getMapSize=function(){var a=parseInt(Q.offsetWidth),b=parseInt(Q.offsetHeight);return new TGOS.TGSize(a,b)};this.IndexViewControl={Show:function(a){oa.Show(a);oa.getMapBase().RefreshMap(!0)},Minimize:function(){oa.Minimize();oa.getMapBase().RefreshMap(!0)}}; this.setCoordSys=function(a){a instanceof TGOS.TGCoordSys&&(G=a,TGOS.TGEvent.trigger(this,"projection_changed"))};this.getDocName=function(){var a;switch(G){case TGOS.TGCoordSys.EPSG3826:a=TGOS.MapTypeDocumentName;R="97";break;case TGOS.TGCoordSys.EPSG3825:a=TGOS.MapTypeDocumentNameTWD97_119;R="97_119";break;case TGOS.TGCoordSys.EPSG3857:a=TGOS.MapTypeDocumentNameGoogle,R="google"}return a};this.getCoordSys=function(){return G};this.getOPackage=function(){return V};this.getMapOptions=function(){return J}; this.getMapTypeId=function(){return ca};this.getHPackage=function(){return Q};this.getHPack=function(){return N.getHPackage()};this.getHObj=function(){return N.getHObject()};this.getHMap=function(){return N.getHObject()};this.getMapBase=function(){return N};this.getMap=function(){return this};this.ZoomTo=function(a){F(a)};this.ZoomIn=function(){F(W.getMapLevel()+1)};this.ZoomOut=function(){F(W.getMapLevel()-1)};this.setOptions=function(a){var b=function(a){var b;switch(G){case TGOS.TGCoordSys.EPSG3857:b= TGOS.WGS84ToGoo(a.left,a.top);a=TGOS.WGS84ToGoo(a.right,a.bottom);b=new TGOS.TGEnvelope(b.x,b.y,a.x,a.y);break;default:b=a}W.setMapBoundsLevel(b);M.setMapBounds(b);N.RefreshMap(!0)},d=function(a,b){var d=a,e=b;null!=d&&null!=e&&d>e&&(d=b,e=a);W.setMapMinMaxLevel(d,e);N.RefreshMap(!0)},e=function(a){"string"==typeof a&&(N.setColor(a),J.backgroundColor=a)},f=function(a){"boolean"==typeof a&&(a?(va.display(!1),na.display(!1),fa.display(!1)):(va.display(!0),na.display(!0),fa.display(!0)),J.disableDefaultUI= a,N.RefreshMap(!0))},g=function(a){"boolean"==typeof a&&(Z=a,J.scrollwheel=a,M.OpenCloseWheel(a))},m=function(a){"boolean"==typeof a&&(na.display(a),J.mapTypeControl=a)},h=function(a){na.setOptions(a);J.mapTypeControlOptions=a;N.RefreshMap(!0)},l=function(a){"boolean"==typeof a&&(fa.display(a),J.navigationControl=a);N.RefreshMap(!0)},k=function(a){fa.setOptions(a);J.navigationControlOptions=a},p=function(a){"boolean"==typeof a&&(va.display(a),J.scaleControl=a)},s=function(a){va.setOptions(a);J.scaleControlOptions= a},w=function(a){"boolean"==typeof a&&(oa.Show(a),J.indexViewControl=a)},n=function(a){a==TGOS.TGIndexViewControlOptions.MINIMIZED&&(oa.Minimize(),J.indexViewControlOptions=a)},u=function(a){"boolean"==typeof a&&(T=a,J.draggable=a,M.OpenCloseMove(a))},C=function(a){"boolean"==typeof a&&(M.allowKeyboard(a),J.keyboardShortcuts=a)},q=function(a){"boolean"==typeof a&&(M.setDragInertia(a),J.dragInertia=a)},t=function(a){"string"==typeof a&&(M.changeDraggableCursor(a),J.draggableCursor=a)},v=function(a){"string"== typeof a&&(M.changeDraggingCursor(a),J.draggingCursor=a)};void 0!=a&&(void 0!=a.backgroundColor&&e(a.backgroundColor),void 0!=a.disableDefaultUI&&f(a.disableDefaultUI),void 0!=a.scrollwheel&&g(a.scrollwheel),void 0!=a.mapTypeControl&&m(a.mapTypeControl),void 0!=a.mapTypeControlOptions&&h(a.mapTypeControlOptions),void 0!=a.navigationControl&&l(a.navigationControl),void 0!=a.navigationControlOptions&&k(a.navigationControlOptions),void 0!=a.scaleControl&&p(a.scaleControl),void 0!=a.scaleControlOptions&& s(a.scaleControlOptions),void 0!=a.indexViewControl&&w(a.indexViewControl),void 0!=a.indexViewControlOptions&&n(a.indexViewControlOptions),void 0!=a.draggable&&u(a.draggable),void 0!=a.keyboardShortcuts&&C(a.keyboardShortcuts),void 0!=a.draggableCursor&&t(a.draggableCursor),void 0!=a.dragInertia&&q(a.dragInertia),void 0!=a.draggingCursor&&v(a.draggingCursor),void 0!=a.center&&S.setCenter(a.center),void 0!=a.dbClickZoomIn&&M.OpenCloseDblClick(a.dbClickZoomIn),void 0!==a.maxZoom&&void 0!==a.minZoom? d(a.minZoom,a.maxZoom):(void 0!==a.maxZoom&&(W.setMapMaxLevel(a.maxZoom),N.RefreshMap(!0)),void 0!==a.minZoom&&(W.setMapMinLevel(a.minZoom),N.RefreshMap(!0))),void 0!==a.mapBounds&&b(a.mapBounds))};this.freezeMap=function(){da||(M.ExitMapEvent(),da=!0)};this.unFreezeMap=function(){da&&(M.InitMapEvent(this),da=!1)};this.loopThroughOverlay=function(){};this.resize=function(a,b){Q.style.width=a+"px";Q.style.height=b+"px";l=Q.clientWidth;k=Q.clientHeight};this.getBoundary=function(){return N.getExtent()}; this.getLevel=function(){return W.getMapLevel()};this.getDiv=function(){return la};this.getEventElement=function(){return this.getHObj()};this.getTransformation=function(){return W};this.fitBounds=function(a){if(null!=a.left&&null!=a.top&&null!=a.right&&null!=a.bottom){var e={X:0,Y:0},f={X:0,Y:0};G==TGOS.TGCoordSys.EPSG3857?(e=b.Forward(d,new CPoint3(a.left,a.top,0)),f=b.Forward(d,new CPoint3(a.right,a.bottom,0))):(e.X=a.left,e.Y=a.top,f.X=a.right,f.Y=a.bottom);TGOS.moveMapTo_(this,(f.X+e.X)/2,(f.Y+ e.Y)/2);a=Number(Q.clientHeight)/(f.Y-e.Y);N.putScale(Math.min(Math.abs(Number(Q.clientWidth)/(f.X-e.X)),Math.abs(a)));W.FitLevel();N.RefreshMap(!0)}};this.getRawBound=function(){var a=l,b=k,d=N.ToMapPoint(0,0),a=N.ToMapPoint(a,b);return new TGOS.TGEnvelope(d.x,d.y,a.x,a.y)};this.getBounds=function(){var a=l,b=k,d=N.ToMapPoint(0,0),a=N.ToMapPoint(a,b),e,f,g,m;switch(G){case TGOS.TGCoordSys.EPSG3857:f=TGOS.GooToWGS84(d.x,d.y);d=TGOS.GooToWGS84(a.x,a.y);e=f.x;f=f.y;g=d.x;m=d.y;break;case TGOS.TGCoordSys.EPSG3826:e= d.x;f=d.y;g=a.x;m=a.y;break;case TGOS.TGCoordSys.EPSG3825:e=d.x,f=d.y,g=a.x,m=a.y}return new TGOS.TGEnvelope(e,f,g,m)};this.checkMapBoundsRestrict=function(a,b,d){var e=null;if(a){var f=0,g=0,m=this.getRawBound(),h=m.top-m.bottom,l=a.top-a.bottom;m.right-m.left>a.right-a.left?(f=1,b=(a.left+a.right)/2):m.lefta.right&&(f=m.right-a.right,b-=f);h>l?(g=1,d=(a.top+a.bottom)/2):m.top>a.top?(g=m.top-a.top,d-=g):m.bottomd&&(b=d);W.putMapLevel(b);na.setActiveType(a);N.RefreshMap(!0)}};this.panBy=function(a,b){M.panBy(a,b);N.RefreshMap(!0)};this.panToBounds=function(a){if(null!=a.left&&null!=a.top&&null!=a.right&&null!=a.bottom){var b,d;switch(G){case TGOS.TGCoordSys.EPSG3857:a=TGOS.WGS84ToGoo(a.left,a.top);b=a.x;d=a.y;break; case TGOS.TGCoordSys.EPSG3826:b=a.left;d=a.top;break;case TGOS.TGCoordSys.EPSG3825:b=a.left,d=a.top}TGOS.moveMapTo_(this,b,d);N.RefreshMap(!0)}};this.getLayerList=function(){return ja};this.setMapAction=function(a,b){if(1==a){var d=N.getHObject(),e=function(a,e,g,m){DetachEvent(d,"mousedown",f,!1);freezeMap||M.InitMapEvent(this);null!=b&&b(a,e,g,m)},f=function(a){RectangleTracker(N,a,e)};M.ExitMapEvent();AttachEvent(d,"mousedown",f,!1)}else freezeMap||M.InitMapEvent(this)};this.getCoordinateString= function(a,b){var d=N.ToMapPoint(a,b);return d.x+","+d.y};this.changeOverviewMapType=function(a,b){for(var d=0;d=C.length?d.insertBefore(g,e):d.insertBefore(g,C[0].div.main);var m=Raphael(g);m.canvas.setAttribute("fill-rule","evenodd");m.canvas.setAttribute("pointer-events","auto");m.rect(0,0,300,300).hide();var h=document.createElement("div"); h.style.position="absolute";h.style.width="100%";h.style.height="100%";h.style.pointerEvents="auto";h.className="IndependentContainer";a&&(h.className=h.className+"_"+a);d.insertBefore(h,e);d=Raphael(h);d.canvas.setAttribute("fill-rule","evenodd");d.canvas.setAttribute("pointer-events","auto");d.rect(0,0,300,300).hide();f={layerId:f,div:{main:h,shadow:g},paper:{main:d,shadow:m}};C.push(f);return f};this.removeAdvancedLayer=function(a){w&&(a=w.indexOf(a),0<=a&&w.splice(a,1))};this.removeIndependentContainer= function(a){var b=this.getMapBase().getHObject();if(C){var d=C.indexOf(a);0<=d&&(b.removeChild(a.div.main),b.removeChild(a.div.shadow),C.splice(d,1))}};this.getAdvancedLayers=function(){return w};this.getIndependentContainers=function(){return C};this.moveIndependentContainerToTop=function(a){var b=this.getMapBase().getHObject();if(null!=b&&C&&null!=a){var d=C.indexOf(a);if(0<=d&&01E3*b?(TGOS.moveMapTo_(k,a.x,a.y),e.RefreshMap(!0),clearInterval(p)):(d=(d-l)/(1E3*b),e.putCenterX(f+d*m),e.putCenterY(g+d*h),e.RefreshMap(!1))}, d)};this.panBy=function(a,b){var d=k.getMapBase(),e=d.getClientWidth(),f=d.getClientHeight(),g=d.getCenterX()+a,m=d.getCenterY()+b,d=d.FromMapPoint(g,m);0<=d.x&&d.x<=e&&0<=d.y&&d.y<=f?fa({x:g,y:m},0.5,30):TGOS.moveMapTo_(k,g,m)};this.panToBounds=function(a){var b=k.getMapBase();a=b.getClientWidth();var d=b.getClientHeight(),e=b.getCenterX()+offsetX,f=b.getCenterY()+offsetY,b=b.FromMapPoint(e,f);0<=b.x&&b.x<=a&&0<=b.y&&b.y<=d?fa({x:e,y:f},0.5,30):TGOS.moveMapTo_(k,e,f)};this.setMapBounds=function(a){n= a;a=k.getMapBase();var b=a.getCenterX(),d=a.getCenterY(),b=k.checkMapBoundsRestrict(n,b,d);null!=b&&(TGOS.moveMapTo_(k,b.x,b.y),a.RefreshMap(!0))};this.allowKeyboard=function(a){"boolean"==typeof a&&(U=a)};this.clearNum=function(){c=0};var na=!0;this.setDragInertia=function(a){"boolean"==typeof a&&(na=a)};this.changeDraggableCursor=function(a){Q=a;R.style.cursor=Q};this.changeDraggingCursor=function(a){V=a};this.InitMapEvent=function(g){var h=g.getMapBase();R=h.getHObject();h.getHPackage();var l= [],v=function(a){setTimeout(function(){B=!1},a)},A=function(a,b,d){var e=20;d&&(e=d);return Math.abs(a.X-b.X)<=e&&Math.abs(a.Y-b.Y)<=e?!0:!1},z=function(a,b){var d=h.getCursorPosition(a),e=h.getCursorPosition(b),f=parseFloat((d.x+e.x)/2),g=parseFloat((d.y+e.y)/2),d=Math.sqrt((d.x-e.x)*(d.x-e.x)+(d.y-e.y)*(d.y-e.y));return{scrCenter:{X:f,Y:g},length:d}},pa=function(a){var b;a.preventDefault();l=a.touches;xa&&xa.stop();la=ha=0;a=l[0];!0==B&&!0==A({X:l[0].clientX,Y:l[0].clientY},H)&&(K=!0,B=!1,D=a); H={X:a.clientX,Y:a.clientY};if(1Qa&&2qa&&TGOS.TGEvent.trigger(k,"dragstart");TGOS.TGEvent.trigger(k,"drag");qa++}},xa,Aa=500,Qa=0.08,Ra=function(a){util.disableDefault(a);if(d){DetachEvent(R,"mousemove",Ka,!0);DetachEvent(R,"mouseup",Ra,!0);R.style.cursor=Q?Q:"default";S=!1;if(n){var b=a.screenX- M;a=a.screenY-N;b=h.getCenterX()-h.ToMapDistX(b);a=h.getCenterY()-h.ToMapDistY(a);b=k.checkMapBoundsRestrict(n,b,a);null!=b&&TGOS.moveMapTo_(k,b.x,b.y);h.RefreshMap(!0);TGOS.TGEvent.trigger(k,"idle")}else if(na){a=Math.abs(Math.sqrt(ha*ha+la*la));var e=-ha,b=-la;if(a>Qa&&2b&&(g=-1);a.putMapLevel(a.getMapLevel()+g);b=h.getScale()/f;d=new TGOS.TGPoint((h.getCenterX()-d.x)/b+d.x,(h.getCenterY()-d.y)/b+d.y);n&&(b=k.checkMapBoundsRestrict(n,d.x,d.y),null!=b&&(d.x=b.x,d.y=b.y));TGOS.moveMapTo_(k,d.x,d.y);h.RefreshMap(!0);TGOS.TGEvent.trigger(k,"idle")}},Ca=0,Ma=function(a){U&&(Ca=0)},Fa=function(a){function b(a,d){TGOS.moveMapTo_(k,h.getCenterX()+a,h.getCenterY()+d);h.RefreshMap(!1)} if(U&&!X){var d=h.getTransformation();Ca+=4;24k&&(b=k),this.setMapMinLevel(b)}; this.getBaseScaleX=function(){return H};this.putBaseScaleX=function(a){H=a};this.getBaseScaleY=function(){return G};this.putBaseScaleY=function(a){G=a};this.getMapMinLevel=function(){return n};this.setMapMinMaxLevel=function(b,d){k=null==d?TGOS.MapTypeMaxZoomLevel[a.getCoordSys()][a.getMapTypeId()]:Math.min(d,TGOS.MapTypeMaxZoomLevel[a.getCoordSys()][a.getMapTypeId()]);n=null==b?0:b;l>k?(this.putMapLevel(k),a.setZoom(k)):lk&&(this.putMapLevel(k),a.setZoom(k))};this.getMapMaxLevel=function(){Math.min(k,TGOS.MapTypeMaxZoomLevel[a.getCoordSys()][a.getMapTypeId()]);return k};this.setMapMinLevel=function(b){n=null==b?0:b;lk?k:g,p=null==n?0:n,u=b>g?g:bg||bC.sclientx-a.clientX||-2>C.sclienty-a.clientY)C.dragMoved=!0;d(a);DetachEvent(document.body,"mousemove",C.markMove,!0);DetachEvent(document.body,"mouseup",C.endDrag,!0);!C.dragMoved&& C.editable?null!=C.clickCallback&&C.clickCallback.call(this,C):null!=C.movedCallback&&C.movedCallback.call(this,C)};this.markMove=function(a){d(a);var b=l.getMapBase(),e=b.getPackageOffset(),f;switch(l.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);f=TGOS.GooToWGS84(f.x,f.y);f=new TGOS.TGPoint(f.x,f.y);break;case TGOS.TGCoordSys.EPSG3826:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);break;case TGOS.TGCoordSys.EPSG3825:f=b.ToMapPoint(a.clientX-e.x,a.clientY- e.y)}a=f.x-C.spos.x;f=f.y-C.spos.y;b=m.getBounds();m.transform(1,0,0,1,a-(b.left-C.senv.left),f-(b.top-C.senv.top));C.update();C.editable&&null!=C.moveCallback&&C.moveCallback.call(this,C)};this.markDrag=function(a){d(a);C.sclientx=a.clientX;C.sclienty=a.clientY;C.dragMoved=!1;var b=l.getMapBase(),e=b.getPackageOffset(),f;switch(l.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:a=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);a=TGOS.GooToWGS84(a.x,a.y);f=new TGOS.TGPoint(a.x,a.y);break;case TGOS.TGCoordSys.EPSG3826:f= b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);break;case TGOS.TGCoordSys.EPSG3825:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y)}C.spos=f;a=m.getBounds();C.senv=new TGOS.TGEnvelope(a.left,a.top,a.right,a.bottom);AttachEvent(document.body,"mousemove",C.markMove,!0);AttachEvent(document.body,"mouseup",C.endDrag,!0)};this.clone=function(){var a={opacity:this.getOpacity(),fillColor:this.getFillColor(),fillOpacity:this.getFillOpacity(),fillOutline:this.getFillOutline(),strokeColor:this.getStrokeColor(),strokeWeight:this.getStrokeWeight(), strokeOpacity:this.getStrokeOpacity(),strokeDasharray:this.getStrokeDasharray()},a=new TGOS.TGFill(null,this.getPath(),a);a.setTitle(this.getTitle());return a};this.setClickCallback=function(a){this.clickCallback=a};this.setMoveCallback=function(a){this.moveCallback=a};this.setMovedCallback=function(a){this.movedCallback=a};this.getEditable=function(){return this.editable};this.setEditable=function(a){this.editable=a;this.setDraggable(a)};this.getDraggable=function(){return this.draggable};this.setDraggable= function(a){void 0!==a&&(this.draggable=a,this.elem&&(!0==a&&this.elem?this.elem.mousedown(this.markDrag):!1==a&&this.elem&&this.elem.unmousedown(this.markDrag)))};this.getVisible=function(){return D};this.setVisible=function(a){switch(a){case !0:D=!0;J.show();this.redraw();this.update();break;case !1:J.hide(),D=!1,this.redraw(),this.update()}};this.getAdvancedLayer=function(){return n};this.setAdvancedLayer=function(a){n=a};this.getPaper=function(){return null!=n?n.paper.main:l.getPaper()};this.getMap= function(){return l};this.setMap=function(a){J&&J.remove();if(null==a){if(!l)return;l.overlay.containing(this)&&l.overlay.remove(this);TGOS.TGEvent.clearInstanceListeners(this);l=null}a instanceof TGOS.TGOnlineMap&&(l=a,this.init())};this.getPath=function(){return m};this.setPath=function(a){m=a;this.redraw(!0)};this.isPointInEnvelope=function(a,b){var d=null,e=m;void 0!==e&&null!=e&&(e.getEnvelope&&(e=e.getEnvelope()),e.left&&(d=a>=e.left&&a<=e.right&&b>=e.bottom&&b<=e.top?!0:!1));return d};this.getEnvelope= function(){if(this.getPath){var a=this.getPath();if(void 0!==a)return void 0!==a.Envelope?a.Envelope:a}return null};this.getBounds=function(){if(m)return m.getBounds()};this.setClickable=function(a){"boolean"===typeof a&&((p=a)?TGOS.TGEvent.releaseEventLock(this,"click"):TGOS.TGEvent.lockEvent(this,"click"),TGOS.TGEvent.trigger(this,"clickable_changed"))};this.getOpacity=function(){return q};this.setOpacity=function(a){q=a;J&&J.attr({opacity:q})};this.getFillOpacity=function(){return t};this.setFillOpacity= function(a){t=a;J&&J.attr({"fill-opacity":q})};this.getFillOutline=function(){return v};this.setFillOpacity=function(a){v=a;J&&J.attr({"stroke-opacity":q})};this.getTitle=function(){return G};this.setTitle=function(a){G=a;J&&(J.attr({title:G}),TGOS.TGEvent.trigger(this,"title_changed"))};this.getClickable=function(){return p};this.getFillColor=function(){return u};this.setFillColor=function(a){u=a;J&&J.attr({fill:u})};this.getStrokeColor=function(){return z};this.setStrokeColor=function(a){z=a;J&& J.attr({stroke:a})};this.getStrokeWeight=function(){return A};this.setStrokeWeight=function(a){A=a;J&&J.attr({"stroke-width":A})};this.getStrokeOpacity=function(){return I};this.setStrokeOpacity=function(a){I=a;J&&J.attr({"stroke-opacity":I})};this.getStrokeDasharray=function(){return F};this.setStrokeDasharray=function(a){F=a;J&&J.attr({"stroke-dasharray":F})};this.getZIndex=function(){return H};this.setZIndex=function(a,b){"number"===typeof a&&J&&(H=parseFloat(a),l.overlay.updateArrayOrder(this), l.overlay.updateElementOrder(this),TGOS.TGEvent.trigger(this,"zindex_changed"))};this.update=function(){if(m&&l)if(D){console.log("TGFill:update");var a=l.getMapBase(),b=this.getAnchorPoint(),b=a.FromMapPoint(b.x,b.y),a=b.x-h,b=b.y-k,d=this.elem.width/J.width,e=this.elem.height/J.height;null!=s&&null!=w?J.transform("t"+a+","+b+"r"+E+","+h+","+k+"s"+d+","+e+",0,0"):J.transform("t"+a+","+b)}else J.hide()};this.setRotate=function(a){E=a;this.redraw();this.update()};this.createPathStr=function(){var d= "",e=l.getCoordSys(),f=l.getMapBase(),g=f.getCellSizeX();e==TGOS.TGCoordSys.EPSG3857&&(g/=1E6);if(m instanceof TGOS.TGPolygon)for(var d=d+a(f,e,g,m.getExteriorRing()),h=m.getInteriorRings(),k=0;kD.sclientx-a.clientX||-2>D.sclienty-a.clientY)D.dragMoved=!0;d(a);DetachEvent(document.body,"mousemove",D.markMove,!0);DetachEvent(document.body,"mouseup",D.endDrag,!0);!D.dragMoved&&D.editable?null!=D.clickCallback&&D.clickCallback.call(this,D):null!=D.movedCallback&&D.movedCallback.call(this,D)};this.markMove=function(a){d(a);var b=h.getMapBase(),e=b.getPackageOffset(), f;switch(h.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);f=TGOS.GooToWGS84(f.x,f.y);f=new TGOS.TGPoint(f.x,f.y);break;case TGOS.TGCoordSys.EPSG3826:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);break;case TGOS.TGCoordSys.EPSG3825:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y)}a=l.Envelope;l.transform(1,0,0,1,f.x-D.spos.x-(a.left-D.senv.left),f.y-D.spos.y-(a.top-D.senv.top));D.update();D.editable&&null!=D.moveCallback&&D.moveCallback.call(this,D)};this.markDrag= function(a){D.sclientx=a.clientX;D.sclienty=a.clientY;D.dragMoved=!1;D.selected=!1;d(a);var b=h.getMapBase(),e=b.getPackageOffset(),f;switch(h.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:a=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);a=TGOS.GooToWGS84(a.x,a.y);f=new TGOS.TGPoint(a.x,a.y);break;case TGOS.TGCoordSys.EPSG3826:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y);break;case TGOS.TGCoordSys.EPSG3825:f=b.ToMapPoint(a.clientX-e.x,a.clientY-e.y)}D.spos=f;a=l.Envelope;D.senv=new TGOS.TGEnvelope(a.left, a.top,a.right,a.bottom);AttachEvent(document.body,"mousemove",D.markMove,!0);AttachEvent(document.body,"mouseup",D.endDrag,!0)};this.clone=function(){var a={opacity:this.getOpacity(),strokeWeight:this.getStrokeWeight(),strokeOpacity:this.getStrokeOpacity(),strokeColor:this.getStrokeColor(),strokeDasharray:this.getStrokeDasharray(),icons:this.getIcons()},a=new TGOS.TGLine(null,this.getPath(),a);a.setTitle(this.getTitle());return a};this.setClickCallback=function(a){this.clickCallback=a};this.setMoveCallback= function(a){this.moveCallback=a};this.setMovedCallback=function(a){this.movedCallback=a};this.getEditable=function(){return this.editable};this.setEditable=function(a){this.editable=a;this.setDraggable(a)};this.getDraggable=function(){return this.draggable};this.setDraggable=function(a){this.draggable=a;B&&(a&&B?B.mousedown(this.markDrag):B.unmousedown(this.markDrag))};this.isPointInEnvelope=function(a,b){var d=null,e=l;void 0!==e&&null!=e&&(e.getEnvelope&&(e=e.getEnvelope()),e.left&&(d=a>=e.left&& a<=e.right&&b>=e.bottom&&b<=e.top?!0:!1));return d};this.getEventElement=function(){return B};this.calEnv=function(){for(var a=l.getPath(),b=Infinity,d=-Infinity,e=-Infinity,f=Infinity,g=0;ga&&0<=a&&(k=a,p&&p.attr({opacity:a}),this.redraw(),this.update())};this.getImage=function(){return null!=this.url?this.url:l};this.setImage=function(a){if(a instanceof TGOS.TGImage)l=a,p&&(p.attr({src:l.getUrl()}),this.redraw(),this.update());else if("string"==typeof a&&(this.url=a,-1=k.length)throw"Invalid WKT : "+d;var l=k[1].toUpperCase();d=k[2];if(b(l,"POINT"))return b=d.split(f),{type:"POINT",geometry:new TGOS.TGPoint(parseFloat(b[0]),parseFloat(b[1]))};if(b(l,"LINESTRING")){k=[];d=d.split(e);for(h=0;hh||b.x==a.x&&b.y==a.y?(f=-1,e=b.x,b=b.y):1d.left!=this.right>this.left||(this.left=d.left),!d.top||null!=this.top&&this.topd.bottom!=this.top>this.bottom||(this.bottom=pEnv.bottom))}; TGOS.TGEnvelope.prototype.Shrink=function(d){d.constructor==TGOS.TGEnvelope&&(!d.left||null!=this.left&&this.leftthis.left||(this.left=d.left),!d.top||null!=this.top&&this.top>d.top!=this.bottomd.right!=this.leftthis.bottom||(this.bottom=d.bottom))}; TGOS.TGEnvelope.prototype.toString=function(){return Math.min(this.left,this.right)+" "+Math.min(this.top,this.bottom)+","+Math.max(this.left,this.right)+" "+Math.max(this.top,this.bottom)}; TGOS.TGEnvelope.prototype.nearestPoint=function(d,b,a){var f=null,e=null,g=Infinity;void 0!==b&&(g=b);if(d instanceof TGOS.TGPoint){b=new TGOS.TGPoint(this.left,this.top);var h=new TGOS.TGPoint(this.right,this.top),k=new TGOS.TGPoint(this.right,this.bottom),l=new TGOS.TGPoint(this.left,this.bottom),n=new TGOS.TGPoint(this.left,this.top);b=new TGOS.TGLineString([b,h,k,l,n]);b.nearestPoint&&(d=b.nearestPoint(d,g,a),null!=d&&(null!=d.point&&(f=d.point),null!=d.distance&&(e=d.distance)))}return null!= f?{point:f,distance:e}:null};TGOS.TGEnvelope.prototype.transform=function(d,b,a,f,e,g){var h=new TGOS.TGPoint(this.left,this.top),k=new TGOS.TGPoint(this.right,this.bottom);h.transform(d,b,a,f,e,g);k.transform(d,b,a,f,e,g);this.left=h.x;this.top=h.y;this.right=k.x;this.bottom=k.y;this.renderer&&this.renderer.redraw()};TGOS.TGEnvelope.prototype.isEmpty=function(){var d=IsNumeric(this.left),b=IsNumeric(this.top),a=IsNumeric(this.right),f=IsNumeric(this.bottom);return!0==d&&!0==b&&!0==a&&!0==f?!0:!1}; TGOS.TGEnvelope.prototype.setEmpty=function(){this.bottom=this.right=this.top=this.left=null};TGOS.TGEnvelope.prototype.getLeft=function(){return this.left};TGOS.TGEnvelope.prototype.getTop=function(){return this.top};TGOS.TGEnvelope.prototype.getRight=function(){return this.right};TGOS.TGEnvelope.prototype.getBottom=function(){return this.bottom};TGOS.TGEnvelope.prototype.setLeft=function(d){this.left=d};TGOS.TGEnvelope.prototype.setTop=function(d){this.top=d}; TGOS.TGEnvelope.prototype.setRight=function(d){this.right=d};TGOS.TGEnvelope.prototype.setBottom=function(d){this.bottom=d};TGOS.TGEnvelope.prototype.getWidth=function(){return Math.abs(this.left-this.right)};TGOS.TGEnvelope.prototype.getHeight=function(){return Math.abs(this.top-this.bottom)};TGOS.TGEnvelope.prototype.getEnvelope=function(){return this};TGOS.TGEnvelope.prototype.getBounds=function(){return this}; TGOS.TGEnvelope.prototype.contains=function(d){return d.x>=this.left&&d.x<=this.right&&d.y>=this.bottom&&d.y<=this.top};TGOS.TGLineString=function(d){this.path=d;this.renderer=null;this.Envelope=new TGOS.TGEnvelope(0,0,0,0);this.updateEnvelope()};TGOS.extend(TGOS.TGGeometry,TGOS.TGLineString);TGOS.TGLineString.prototype.type="TGLineString"; TGOS.TGLineString.prototype.nearestPoint=function(d,b,a){var f=null,e=null,g=Infinity;void 0!==b&&(g=b);var h=!0;void 0!==a.snapEdge&&(h=a.snapEdge);b=!0;void 0!==a.snapVertex&&(b=a.snapVertex);if(d instanceof TGOS.TGPoint&&(h||b)){if(b){var k=d.x,l=d.y;a=Infinity;var n;for(b=0;bd&&(d=30),120a.sclientx-b.clientX||-2>a.sclienty-b.clientY)a.dragMoved=!0;DetachEvent(document.body, "mousemove",a.textMove,!0);DetachEvent(document.body,"mouseup",a.endDrag,!0);!a.dragMoved&&a.editable?null!=a.clickCallback&&a.clickCallback.call(this,a):null!=a.movedCallback&&a.movedCallback.call(this,a)};this.textMove=function(b){b=a.toMapPoint(b.clientX,b.clientY);b.x-=a.soffsetx;b.y-=a.soffsety;a.setPosition(b);a.editable&&null!=a.moveCallback&&a.moveCallback.call(this,a)};this.textDrag=function(b){a.sclientx=b.clientX;a.sclienty=b.clientY;var d=a.toMapPoint(a.sclientx,a.sclienty);a.soffsetx= d.x-a.position.x;a.soffsety=d.y-a.position.y;a.dragMoved=!1;b.cancelBubble=!0;b.stopPropagation&&b.stopPropagation();AttachEvent(document.body,"mousemove",a.textMove,!0);AttachEvent(document.body,"mouseup",a.endDrag,!0)};this.setClickCallback=function(a){this.clickCallback=a};this.setMoveCallback=function(a){this.moveCallback=a};this.setMovedCallback=function(a){this.movedCallback=a};b&&this.setOptions(b)};TGOS.extend(TGOS.Graphic,TGOS.TGLabel);var d=TGOS.TGLabel.prototype;d.font="";d.fontSize=12; d.fontWeight="normal";d.fontColor="#000000";d.opacity=1;d.backgroundColor="";d.position=null;d.label="";d.title="";d.zIndex;d.offset=null;d.visible=!0;d.map=null;d.mapbase=null;d.elem=null;d.clone=function(){var b={font:this.getFont(),fontSize:this.getFontSize(),fontWeight:this.getFontWeight(),fontColor:this.getFontColor(),opacity:this.getOpacity(),backgroundColor:this.getBackgroundColor(),position:this.getPosition(),label:this.getLabel(),title:this.getTitle(),offset:this.getOffset()};return new TGOS.TGLabel(b)}; d.getEventElement=function(){return this.elem};d.isPointInEnvelope=function(){return null};d.update=function(){if(this.map){switch(this.map.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:this.mapbase.FromMapPoint(this.position.x,this.position.y);var b=TGOS.WGS84ToGoo(this.position.x,this.position.y),a=this.mapbase.FromMapPoint(b.x,b.y);break;case TGOS.TGCoordSys.EPSG3826:a=this.mapbase.FromMapPoint(this.position.x,this.position.y);break;case TGOS.TGCoordSys.EPSG3825:a=this.mapbase.FromMapPoint(this.position.x, this.position.y)}b=a.x;a=a.y;this.offset&&(b+=this.offset.x,a+=this.offset.y);this.elem.transform("t"+b+","+a)}};d.setVisible=function(b){this.elem&&(!0==b?this.elem.show():!1==b&&this.elem.hide());this.visible=b;TGOS.TGEvent.trigger(this,"visible_changed")};d.getVisible=function(){return this.visible};d.setZIndex=function(b,a){void 0!=b&&this.elem&&(this.zIndex=b,this.map.overlay.updateArrayOrder(this),this.map.overlay.updateElementOrder(this),TGOS.TGEvent.trigger(this,"zindex_changed"))};d.getZIndex= function(){return this.zIndex};d.setFont=function(b){this.font=b;this.elem&&this.elem.attr({"font-family":this.font})};d.getFont=function(){return this.font};d.setFontSize=function(b){this.fontSize=b;this.elem&&this.elem.attr({"font-size":this.fontSize})};d.getFontSize=function(){return this.fontSize};d.setSize=function(b){this.size=b};this.getSize=function(){return this.size};d.setFontColor=function(b){this.fontColor=b;this.elem&&this.elem.attr({fill:this.fontColor})};d.getFontColor=function(){return this.fontColor}; d.setOpacity=function(b){this.opacity=b;this.elem&&this.elem.attr({opacity:this.opacity})};d.getOpacity=function(){return this.opacity};d.setBackgroundColor=function(b){this.backgroundColor=b};d.getBackgroundColor=function(){return this.backgroundColor};d.setPosition=function(b){this.position=b;this.update();TGOS.TGEvent.trigger(this,"position_changed")};d.getPosition=function(){return this.position};d.setLabel=function(b){this.label=b;this.elem&&this.elem.attr({text:this.label});TGOS.TGEvent.trigger(this, "label_changed")};d.getLabel=function(){return this.label};d.setTitle=function(b){this.title=b;this.elem&&(this.elem.attr({title:this.title}),TGOS.TGEvent.trigger(this,"title_changed"))};d.getTitle=function(){return this.title};d.setFontWeight=function(b){this.fontWeight=b;this.elem&&this.elem.attr({"font-weight":this.fontWeight})};d.getFontWeight=function(){return this.fontWeight};d.destroy=function(){this.map&&(this.map.overlay.remove(this),this.elem&&this.elem.remove())};d.getOffset=function(){return this.offset}; d.setOffset=function(b){b instanceof TGOS.TGPoint&&(this.offset=b,this.update())};d.setMap=function(b){this.destroy();null==b&&this.map?(this.map=null,TGOS.TGEvent.clearInstanceListeners(this)):b instanceof TGOS.TGOnlineMap&&(this.map=b,paper=this.getPaper(),this.elem=paper.text(0,0,this.label),this.map.overlay.add(this),this.mapbase=this.map.getMapBase(),this.elem.attr({"font-family":this.font,fill:this.fontColor,"font-weight":this.fontWeight,"font-size":this.fontSize,text:this.label,opacity:this.opacity}), this.bindEvents(),this.update())};d.getMap=function(){return this.map};d.getMapBase=function(){return this.mapbase};d.editable=!1;d.getEditable=function(){return this.editable};d.setEditable=function(b){this.editable=b;this.setDraggable(b)};d.draggable=!1;d.getDraggable=function(){return this.draggable};d.setDraggable=function(b){this.draggable=b;TGOS.TGEvent.trigger(this,"draggable_changed");this.elem&&(this.elem&&!0==b?this.elem.mousedown(this.textDrag):this.elem&&!1==b&&this.elem.unmousedown(this.textDrag))}; d.clickable=!1;d.getClickable=function(){return this.clickable};d.setClickable=function(b){"boolean"===typeof b&&((this.clickable=b)?TGOS.TGEvent.releaseEventLock(this,"click"):TGOS.TGEvent.lockEvent(this,"click"),TGOS.TGEvent.trigger(this,"clickable_changed"))};d.advancedLayer=null;d.getAdvancedLayer=function(){return this.advancedLayer};d.setAdvancedLayer=function(b){this.advancedLayer=b};d.getPaper=function(){return null!=this.advancedLayer?this.advancedLayer.paper.main:this.map.getPaper()};d.getShadowPaper= function(){return null!=this.advancedLayer?this.advancedLayer.paper.shadow:this.map.getShadowPaper()};d.setOptions=function(b){void 0!==b.zIndex&&this.setZIndex(b.zIndex);b.font&&this.setFont(b.font);b.fontColor&&this.setFontColor(b.fontColor);b.fontWeight&&this.setFontWeight(b.fontWeight);b.fontSize&&this.setFontSize(b.fontSize);b.label&&this.setLabel(b.label);b.backgroundColor&&this.setBackgroundColor(b.backgroundColor);void 0!==b.opacity&&this.setOpacity(b.opacity);void 0!==b.clickable&&this.setClickable(b.clickable); void 0!==b.draggable&&this.setDraggable(b.draggable);b.position&&this.setPosition(b.position);b.map&&this.setMap(b.map);this.update()};TGOS.RegisterEvent(TGOS.TGLabel,"label_changed zindex_changed click dblclick rightclick mousemove mousedown mouseup mouseover mouseout".split(" "))})();TGOS.TGInfoWindow=function(d,b,a){var f="",e,g,h,k,l=this,n,m;k=document.createElement("img");e=document.createElement("div");g=document.createElement("div");h=document.createElement("div");document.createElement("div");k.src=TGOS.RES_PATH+"Sample/Angle.png";k.style.position="absolute";k.style.height="21px";k.style.width="34px";k.style.zIndex=1E6;e.style.position="absolute";e.style.border="solid 1px #AAAAAA";e.style.backgroundColor="#ffffff";e.style.opacity=1;e.style.borderRadius="5px";e.style.overflow= "auto";g.style.width="auto";g.style.height="auto";g.style.position="absolute";g.style.overflow="auto";g.style.margin="10px";g.style["word-break"]="keep-all";h.style.position="absolute";h.top="5px";h.style.width="15px";h.style.height="15px";h.style.overflow="auto";h.style.right="5px";h.style.zIndex=1E6;h.style.backgroundImage='url("'+TGOS.RES_PATH+'Sample/Close.png")';this.onCloseClick=function(a){l.close()};AttachEvent(h,"click",this.onCloseClick);e.appendChild(g);var p={position:b||new TGOS.TGPoint(0, 0),pixelOffset:new TGOS.TGSize(0,0),zIndex:1E6,disableAutoPan:!0};this.getElement=function(){return e};this.open=function(a){a.infoWindowLayer.containing(this)?this.update():(a.getHPack().appendChild(e),a.getHPack().appendChild(k),a.getHPack().appendChild(h),a.infoWindowLayer.add(this),n=a,m=n.getMapBase(),e.style.zIndex=p.zIndex,g.innerHTML='
'+f+"

",e.style.width=g.scrollWidth+40>p.maxWidth?p.maxWidth+40+"px":g.scrollWidth+40+"px",k.style.display="inline",h.style.display= "inline",e.style.height=g.scrollHeight+30+"px",this.update(),this.panToCenter())};this.close=function(){n&&n.infoWindowLayer.containing(this)&&(TGOS.TGEvent.trigger(this,"closeclick"),n.infoWindowLayer.remove(this),k.parentNode&&k.parentNode.removeChild(k),h.parentNode&&h.parentNode.removeChild(h))};this.setContent=function(a){"string"==typeof a?f=a:a instanceof HTMLElement&&g.appendChild(a);f=a;g.innerHTML='
'+f+"

";e.style.width=g.scrollWidth+40>p.maxWidth?p.maxWidth+ 40+"px":g.scrollWidth+40+"px";e.style.height=g.scrollHeight+30+"px";TGOS.TGEvent.trigger(this,"content_changed")};this.setPosition=function(a){a instanceof TGOS.TGPoint&&(a.x!==p.position.x||a.y!==p.position.y)&&(p.position=a,this.update(),TGOS.TGEvent.trigger(this,"position_changed"))};this.getPosition=function(){return p.position};this.getContentPane=function(){return g};this.setMaxWidth=function(a){p.maxWidth=a;e.style.width=g.scrollWidth+40>p.maxWidth?p.maxWidth+40+"px":g.scrollWidth+40+"px"; e.style.height=g.scrollHeight+30+"px"};this.setZIndex=function(a){a!==p.zIndex&&(p.zIndex=a,e.style.zIndex=a,k.style.zIndex=a,h.style.zIndex=a,this.update(),TGOS.TGEvent.trigger(this,"zindex_changed"))};this.getZIndex=function(){return p.zIndex};this.setPixelOffset=function(a){p.pixelOffset=a;this.update()};this.disableAutoPan=function(a){"boolean"==typeof a&&(p.disableAutoPan=a)};this.putOpacity=function(a){e.style.opacity=a;k.style.opacity=a;h.style.opacity=a;e.style.filter="alpha(opacity="+100* a+")";k.style.filter="alpha(opacity="+100*a+")";h.style.filter="alpha(opacity="+100*a+")"};this.panToCenter=function(){if(!1==p.disableAutoPan&&m&&n){var a=m.FromMapPoint(p.position.x,p.position.y),b=parseInt(a.x)-e.offsetWidth/2,a=parseInt(a.y)-e.offsetHeight/2;m.ToMapPoint(b,a);n.setCenter(p.position)}};this.setMessageText=function(a){this.setContent(a)};this.setOptions=function(a){void 0!=a&&("boolean"==typeof a.disableAutoPan&&this.disableAutoPan(a.disableAutoPan),a.position instanceof TGOS.TGPoint&& this.setPosition(a.position),"number"==typeof a.maxWidth&&this.setMaxWidth(a.maxWidth),a.pixelOffset instanceof TGOS.TGSize&&this.setPixelOffset(a.pixelOffset),"number"==typeof a.zIndex&&this.setZIndex(a.zIndex),"string"==typeof a.messageText&&this.setMessageText(a.messageText),"number"==typeof a.opacity&&this.putOpacity(a.opacity),this.update())};this.update=function(){if("undefined"!=typeof m&&n){switch(n.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:var a=TGOS.WGS84ToGoo(p.position.x,p.position.y), a=m.FromMapPoint(a.x,a.y);break;case TGOS.TGCoordSys.EPSG3826:a=m.FromMapPoint(p.position.x,p.position.y);break;case TGOS.TGCoordSys.EPSG3825:a=m.FromMapPoint(p.position.x,p.position.y)}e.style.left=parseInt(a.x)+p.pixelOffset.width+"px";e.style.top=parseInt(a.y)-19-parseInt(e.offsetHeight)+p.pixelOffset.height+"px";k.style.left=parseInt(a.x)+p.pixelOffset.width+"px";k.style.top=parseInt(a.y)-19+p.pixelOffset.height+"px";h.style.left=parseInt(a.x)+e.clientWidth+p.pixelOffset.width-20+"px";h.style.top= parseInt(e.style.top)+5+"px"}};this.setContent(d);this.setOptions({position:b});this.setOptions(a)};TGOS.RegisterEvent(TGOS.TGInfoWindow,["closeclick","content_changed","position_changed","zindex_changed","domready"]);TGOS.TGImage=function(d,b,a,f,e){var g="";this.size=b instanceof TGOS.TGSize?b:new TGOS.TGSize(32,32);e instanceof TGOS.TGSize&&(this.scaledSize=e);this.anchor=f instanceof TGOS.TGPoint?f:new TGOS.TGPoint(this.size.width/2-1,this.size.height-1);this.origin=a instanceof TGOS.TGPoint?a:new TGOS.TGPoint(0,0);this.setOptions=function(a){a.scale&&(this.scale=a.scale);a.hotSpot&&(this.hotSpot=a.hotSpot)};this.setUrl=function(a){"string"==typeof a&&(g=a)};this.getUrl=function(){return g};this.setUrl(d)}; TGOS.extend(TGOS.MVCObject,TGOS.TGImage);TGOS.TGSymbol=function(){var d={FORWARD_OPEN_ARROW:1,BACKWARD_OPEN_ARROW:3};TGOS.TGSymbolStyle={FORWARD_CLOSED_ARROW:0,FORWARD_OPEN_ARROW:1,BACKWARD_CLOSED_ARROW:2,BACKWARD_OPEN_ARROW:3,CIRCLE:4,DOUBLE_CIRCLE:5,TRIPLE_CIRCLE:6,CIRCLE_SPOT:7,TRIANGLE:8,INVERT_TRIANGLE:9,SQUARE:10,PENTAGON:11,HEXAGON:12,OCTAGON:13,PENTASTAR:14,HEXASTAR:15};var b=function(){this.anchor=new TGOS.TGPoint(0,0);this.symbolStyle=TGOS.TGSymbolStyle.CIRCLE;this.yPixel=this.xPixel=48;this.rotation=0;this.opacity=1;this.fillColor= "#ffffff";this.fillOpacity=0;this.strokeColor="#000000";this.strokeWeight=2;this.strokeOpacity=1};TGOS.extend(TGOS.MVCObject,b);b.noFill=function(a){for(var b in d)if(d[b]==a)return!0;return!1};b.SymbolPath="M0 0 L 100 50 L0 100L50 50Z;M0 0 L 100 50 L0 100;M100 0 L 0 50 L100 100L50 50Z;M100 0 L 0 50 L100 100;M0 50 A 50 50 0 0 1 100 50 A50 50 0 0 1 0 50z;M0 50A50 50 0 0 1 100 50 A50 50 0 0 1 0 50zM25 50A25 25 0 0 1 75 50 A25 25 0 0 1 25 50z;M0 50A50 50 0 0 1 100 50 A50 50 0 0 1 0 50zM16.67 50A33.33 33.33 0 0 1 83.33 50 A33.33 33.33 0 0 1 16.67 50zM33.33 50A16.67 16.67 0 0 1 66.67 50 A16.67 16.67 0 0 1 33.33 50z;M0 50A50 50 0 0 1 100 50 A50 50 0 0 1 0 50ZM45 45L55 55M55 45L45 55;M50 0L7 75L93 75Z;M93 25L7 25L50 100Z;M0 0L100 0L100 100L0 100Z;M50 0L2 35L21 90L79 90L98 35Z;M50 0L7 25L7 75L50 100L93 75L93 25Z;M50 0L15 15L0 50L15 85L50 100L85 85L100 50L85 15Z;M50 0L35 30L2 35 L26 58L21 90L50 75L79 90L74\t58L98 35L65\t30Z;M50,0L38,28L7,25L25,50L7,75L37,72L50,100L62,72L93,75L75,50L93,25L63,28Z".split(";"); return b}();TGOS.TGEvent=function(){var d=0>util.getInternetExplorerVersion()?0:1,b={standardDomMouseEvents:{click:"click",mousemove:"mousemove",mousedown:"mousedown",mouseover:"mouseover",mouseout:"mouseout",mouseup:"mouseup",dblclick:"dblclick",rightclick:"rightclick"},RIGHTBUTTON:2};b.LEFTBUTTON=d;TGOS.MapsEventListener=function(){};TGOS.OverlayCompleteEvent=function(a,b,d){this.overlay=a;this.type=b;this.action=d?d:""};TGOS.TGMouseEvent=function(a){this.mapListener_=null;this.stop=function(){b.removeListener(this.mapListener_); this.mapListener_=null};this.stopPropagation=function(){a.stopPropagation&&a.stopPropagation();a.cancelBubble=!0};this.point=new TGOS.TGPoint};b.addListener_=function(a,b,d,g,h){if(a&&b&&a.events&&!(0>a.events.indexOf(b))){var k=a[b+"_"],l=null;k||(a[b+"_"]=[],k=a[b+"_"]);if(k)return l={target_:a,eventName_:b,targetQueue_:b+"_",handler_:d,executeLimit:h,capture:g},k.push(l),l}};b.addDomListener=function(a,d,e,g){return b.addListener_(a,d,e,g,Infinity)};b.addDomListenerOnce=function(a,d,e,g){return b.addListener_(a, d,e,g,1)};b.addListener=function(a,d,e,g){return b.addListener_(a,d,e,g,Infinity)};b.addListenerOnce=function(a,d,e,g){return b.addListener_(a,d,e,g,1)};b.clearInstanceListeners=function(a){if(a.events)for(var d=0;d=e.length)return!1;for(var g=0;g=e[g].executeLimit&&b.removeListener(e[g]))};b.trigger=function(a,d){b.trigger_(a,d)};b.releaseEventLock= function(a,b){if(a&&a.events&&a.events.length&&b&&a.lockEvt&&0<=a.lockEvt.indexOf(b)){var d=a.lockEvt.indexOf(b);0>d||a.lockEvt.splice(d,1)}};b.lockEvent=function(a,b){a&&a.events&&a.events.length&&b&&(a.lockEvt||(a.lockEvt=[]),0<=a.lockEvt.indexOf(b)||a.lockEvt.push(b))};return b}();(function(){var d=TGOS.RES_PATH+"marker2.png",b=TGOS.RES_PATH+"shadow2.png";TGOS.TGMarker=function(a,b,d,h,k){var l=this;this.toMapPoint=function(a,b){var d,e=l.map.getMapBase(),f=e.getPackageOffset(),e=e.ToMapPoint(a-f.x,b-f.y);switch(l.map.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:d=TGOS.GooToWGS84(e.x,e.y);d=new TGOS.TGPoint(d.x,d.y);break;case TGOS.TGCoordSys.EPSG3826:d=e;break;case TGOS.TGCoordSys.EPSG3825:d=e}return d};this.endDrag=function(a){if(2l.sclientx-a.clientX||-2>l.sclienty-a.clientY)l.dragMoved=!0;DetachEvent(document.body,"mousemove",l.markMove,!0);DetachEvent(document.body,"mouseup",l.endDrag,!0);!l.dragMoved&&l.editable?null!=l.clickCallback&&l.clickCallback.call(this,l):null!=l.movedCallback&&l.movedCallback.call(this,l)};this.markMove=function(a){a=l.toMapPoint(a.clientX,a.clientY);a.x-=l.soffsetx;a.y-=l.soffsety;l.setPosition(a);l.editable&&null!=l.moveCallback&&l.moveCallback.call(this,l)};this.markDrag=function(a){l.sclientx= a.clientX;l.sclienty=a.clientY;var b=l.toMapPoint(l.sclientx,l.sclienty);l.soffsetx=b.x-l.position.x;l.soffsety=b.y-l.position.y;l.dragMoved=!1;a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();AttachEvent(document.body,"mousemove",l.markMove,!0);AttachEvent(document.body,"mouseup",l.endDrag,!0)};this.setClickCallback=function(a){this.clickCallback=a};this.setMoveCallback=function(a){this.moveCallback=a};this.setMovedCallback=function(a){this.movedCallback=a};b instanceof TGOS.TGPoint&&(this.position= b);void 0!==h&&null!=h&&(this.icon=h);void 0!==d&&null!=d&&(this.title=d);this.getNode=function(){if(this.map&&this.advancedLayer){var a=this.getAdvancedLayer();return null!=a?[a.div.main,a.div.shadow]:this.map.getPanes().graphicLayer}};k&&this.setMarkerOptions(k);a&&this.setMap(a)};TGOS.extend(TGOS.Graphic,TGOS.TGMarker);var a=TGOS.TGMarker.prototype;a.elem=null;a.map=null;a.gPos=null;a.clone=function(){var a=new TGOS.TGMarker(null,this.getPosition(),this.getTitle(),this.getIcon());a.setShadow(this.getShadow()); a.setInfoAnchorPoint(this.getInfoAnchorPoint());a.setFlat(this.getFlat());return a};a.isPointInEnvelope=function(a,b,d){var h=null,k=this.position;if(void 0!==k&&null!=k){var l=this.icon;if(void 0!==l&&null!=l){var h=k.x-l.anchor.x*d,n=k.x+l.anchor.x*d,m=k.y+l.anchor.y*d,p=k.y-l.anchor.y*d;this.icon instanceof TGOS.TGImage?(n=k.x+(l.size.width-l.anchor.x)*d,p=k.y-(l.size.height-l.anchor.y)*d):this.icon instanceof TGOS.TGSymbol&&(n=k.x+(l.xPixel-l.anchor.x)*d,p=k.y-(l.yPixel-l.anchor.y)*d);h=a>=h&& a<=n&&b>=p&&b<=m?!0:!1}}return h};a.getEnvelope=function(){return new TGOS.TGEnvelope(this.position.x,this.position.y,this.position.x,this.position.y)};a.getBounds=function(){return new TGOS.TGEnvelope(this.position.x,this.position.y,this.position.x,this.position.y)};a.setMap=function(a){if(null===a)this.destroy(),this.map=null;else if(this.destroy(),a instanceof TGOS.TGOnlineMap){(this.map=a)&&this.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(this.gPos=TGOS.WGS84ToGoo(this.position.x,this.position.y)); this.map.overlay.add(this);this.getPaper();a=this.getShadowPaper();var d=this.shadow?this.shadow.getUrl():b;this.sImg=a.image(d,0,0,this.shadow.size.width,this.shadow.size.height);!0!=this.flat&&!1!=this.visible||this.sImg.hide();this.redrawMarker();this.update()}};a.getMap=function(){return this.map};a.getMapBase=function(){if(this.map)return this.map.getMapBase()};a.destroy=function(){this.map&&(this.elem&&this.elem.remove(),this.sImg&&this.sImg.remove(),this.map.overlay.remove(this),this.sImg= this.elem=null)};a.getEventElement=function(){return this.elem};a.title="";a.getTitle=function(){return this.title};a.setTitle=function(a){this.title=a;this.elem&&(this.elem.attr({title:this.title}),TGOS.TGEvent.trigger(this,"title_changed"))};a.position=null;a.getPosition=function(){return this.position};a.setPosition=function(a){a instanceof TGOS.TGPoint&&(this.position=a,this.map&&this.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(this.gPos=TGOS.WGS84ToGoo(this.position.x,this.position.y)),this.update(), TGOS.TGEvent.trigger(this,"position_changed"))};this.infoAnchorPosition=null;a.getInfoAnchorPoint=function(){return this.infoAnchorPoint};a.setInfoAnchorPoint=function(a){this.infoAnchorPoint=a};a.icon=new TGOS.TGImage(d,new TGOS.TGSize(31,30),new TGOS.TGPoint(0,0),new TGOS.TGPoint(9,28));a.getIcon=function(){return this.icon};a.setIcon=function(a){if(a instanceof TGOS.TGImage||a instanceof TGOS.TGSymbol)this.icon=a,this.redrawMarker(),this.update(),TGOS.TGEvent.trigger(this,"icon_changed")};a.clickable= !1;a.getClickable=function(){return this.clickable};a.setClickable=function(a){"boolean"===typeof a&&((this.clickable=a)?TGOS.TGEvent.releaseEventLock(this,"click"):TGOS.TGEvent.lockEvent(this,"click"),TGOS.TGEvent.trigger(this,"clickable_changed"))};a.redrawMarker=function(){if((this.icon instanceof TGOS.TGImage||this.icon instanceof TGOS.TGSymbol)&&this.map){this.elem&&this.elem.remove();var b=this.getPaper();if(this.icon instanceof TGOS.TGImage)if(this.fitImageSize){var d=document.createElement("img"), g=this;d.onload=function(){var d=a.icon.size.width,e=a.icon.size.height;try{d=this.width,e=this.height}catch(l){}a.elem=b.image(g.icon.getUrl(),0,0,d,e);!1===a.visible?a.elem.hide():a.elem.show();null!=a.cursor&&a.elem.attr({cursor:a.cursor});null!=a.title&&a.elem.attr({title:a.title});g.map.overlay.updateElementOrder(g);g.bindEvents();g.update()};d.src=this.icon.getUrl()}else this.icon.scale?(d=document.createElement("img"),g=this,d.onload=function(d){g.icon.size.width=d.srcElement.width*g.icon.scale; g.icon.size.height=d.srcElement.height*g.icon.scale;a.elem=g.icon.scaledSize?b.image(g.icon.getUrl(),0,0,g.icon.scaledSize.width,g.icon.scaledSize.height):b.image(g.icon.getUrl(),0,0,g.icon.size.width,g.icon.size.height);!1===a.visible?a.elem.hide():a.elem.show();null!=a.cursor&&a.elem.attr({cursor:a.cursor});null!=a.title&&a.elem.attr({title:a.title});g.map.overlay.updateElementOrder(g);g.bindEvents();g.update()},d.src=this.icon.getUrl()):(this.elem=this.icon.scaledSize?b.image(this.icon.getUrl(), 0,0,this.icon.scaledSize.width,this.icon.scaledSize.height):b.image(this.icon.getUrl(),0,0,this.icon.size.width,this.icon.size.height),!1===this.visible?this.elem.hide():this.elem.show(),void 0!==this.cursor&&null!=this.cursor&&this.elem.attr({cursor:this.cursor}),void 0!==this.title&&null!=this.title&&this.elem.attr({title:this.title}),this.map.overlay.updateElementOrder(this),this.bindEvents(),this.update());else if(this.icon instanceof TGOS.TGSymbol){d=this.icon.symbolStyle in TGOS.TGSymbol.SymbolPath? TGOS.TGSymbol.SymbolPath[this.icon.symbolStyle]:this.icon.symbolStyle;if(!d)throw"Invalid SymbolStyle or path";this.elem=b.path(d);this.bbox_=this.elem.getBBox(!0);d=TGOS.TGSymbol.noFill(this.icon.symbolStyle);this.elem.attr({opacity:this.icon.opacity,fill:this.icon.fillColor,"fill-opacity":d?0:this.icon.fillOpacity,stroke:this.icon.strokeColor,"stroke-opacity":this.icon.strokeOpacity,"stroke-width":this.icon.strokeWeight});!1===this.visible?this.elem.hide():this.elem.show();void 0!==this.cursor&& null!=this.cursor&&this.elem.attr({cursor:this.cursor});void 0!==this.title&&null!=this.title&&this.elem.attr({title:this.title});this.map.overlay.updateElementOrder(this);this.bindEvents();this.update()}}};a.icon_changed=function(){this.redrawMarker()};a.visible=!0;a.getVisible=function(){return this.visible};a.setVisible=function(a,b){this.visible=a;this.map&&(!0===this.visible?(this.elem.show(),!1===this.flat&&this.sImg.show()):(this.elem.hide(),this.sImg.hide()),b||this.update(),TGOS.TGEvent.trigger(this, "visible_changed"))};a.cursor=null;a.getCursor=function(){return this.cursor};a.setCursor=function(a){this.cursor=a;this.elem&&(this.elem.attr({cursor:this.cursor}),TGOS.TGEvent.trigger(this,"cursor_changed"))};a.zIndex=0;a.getZIndex=function(){return this.zIndex};a.setZIndex=function(a){this.zIndex=parseInt(a);this.map&&(this.map.overlay.updateArrayOrder(this),this.map.overlay.updateElementOrder(this),TGOS.TGEvent.trigger(this,"zindex_changed"))};a.editable=!1;a.getEditable=function(){return this.editable}; a.setEditable=function(a){this.editable=a;this.setDraggable(a)};a.draggable=!1;a.getDraggable=function(){return this.draggable};a.setDraggable=function(a){this.draggable=a;TGOS.TGEvent.trigger(this,"draggable_changed");this.elem&&(this.elem&&!0==a?this.elem.mousedown(this.markDrag):this.elem&&!1==a&&this.elem.unmousedown(this.markDrag))};a.flat=!1;a.getFlat=function(){return this.flat};a.setFlat=function(a){this.flat=a;this.sImg&&(!0===this.flat?this.sImg.hide():this.sImg.show(),TGOS.TGEvent.trigger(this, "flat_changed"))};a.shadow=new TGOS.TGImage(b,new TGOS.TGSize(31,30),new TGOS.TGPoint(0,0),new TGOS.TGPoint(9,25));a.getShadow=function(){return this.shadow};a.setShadow=function(a){this.shadow=a;TGOS.TGEvent.trigger(this,"shadow_changed")};a.advancedLayer=null;a.getAdvancedLayer=function(){return this.advancedLayer};a.setAdvancedLayer=function(a){this.advancedLayer=a};a.getPaper=function(){return null!=this.advancedLayer?this.advancedLayer.paper.main:this.map.getPaper()};a.getShadowPaper=function(){return null!= this.advancedLayer?this.advancedLayer.paper.shadow:this.map.getShadowPaper()};a.fitImageSize=!1;a.setFitImageSize=function(a){this.fitImageSize=a};a.setMarkerOptions=function(a){a&&(void 0!==a.advancedLayer&&this.setAdvancedLayer(a.advancedLayer),void 0!==a.visible&&this.setVisible(a.visible),void 0!=a.icon&&this.setIcon(a.icon),void 0!==a.shadow&&this.setShadow(a.shadow),void 0!=a.title&&this.setTitle(a.title),void 0!==a.position&&this.setPosition(a.position),void 0!==a.infoAnchor&&this.setInfoAnchorPoint(a.infoAnchor), void 0!==a.clickable&&this.setClickable(a.clickable),void 0!==a.cursor&&this.setCursor(a.cursor),void 0!=a.zIndex&&this.setZIndex(a.zIndex),void 0!==a.draggable&&this.setDraggable(a.draggable),void 0!==a.flat&&this.setFlat(a.flat),void 0!==a.shape&&this.setShape(a.shape),void 0!==a.fitImageSize&&this.setFitImageSize(a.fitImageSize))};a.update=function(){if(this.position&&this.visible&&this.elem&&this.map){var a;switch(this.map.getCoordSys()){case TGOS.TGCoordSys.EPSG3857:a=this.gPos;break;default:a= this.position}var b=this.map.getMapBase();if(this.map.getRawBound().contains(a)){this.visible&&(this.elem.show(),!0!==this.flat&&this.sImg.show());a=b.FromMapPoint(a.x,a.y);if(this.icon instanceof TGOS.TGImage){var b=a.x-this.icon.anchor.x,d=a.y-this.icon.anchor.y;this.icon.hotSpot&&(b=a.x-this.icon.hotSpot.x,d=a.y-this.icon.hotSpot.y);this.elem.attr({x:b,y:d});this.elem.attr({"clip-rect":b+","+d+","+this.icon.size.width+","+this.icon.size.height})}else if(this.icon instanceof TGOS.TGSymbol){if(!this.bbox_){this.bbox_= this.elem.getBBox(!0);return}this.elem.transform("t"+(a.x-this.icon.anchor.x)+","+(a.y-this.icon.anchor.y)+"r"+this.icon.rotation+","+this.icon.anchor.x+","+this.icon.anchor.y+"s"+this.icon.xPixel/this.bbox_.width+","+this.icon.yPixel/this.bbox_.height+",0,0")}else return;!1===this.flat&&this.sImg.attr({x:a.x-this.shadow.anchor.x,y:a.y-this.shadow.anchor.y})}else this.elem.hide(),this.sImg.hide()}};TGOS.RegisterEvent(TGOS.TGMarker,"clickable_changed icon_changed position_changed title_changed visible_changed zindex_changed click mousedown mouseup mouseover mouseout mousemove cursor_changed draggable_changed flat_changed shadow_changed shape_changed dblclick rightclick".split(" "))})();TGOS.TGDrawing=function(){TGOS.TGOverlayType={NONE:"NONE",CIRCLE:"CIRCLE",MARKER:"MARKER",POLYGON:"POLYGON",LINESTRING:"LINESTRING",ENVELOPE:"ENVELOPE",LABEL:"LABEL",EDIT:"EDIT",MODIFY:"MODIFY"};TGOS.TGModifyType={STARTED:"STARTED",ATTRIBUTE:"ATTRIBUTE",SAVE:"SAVE",DELETE:"DELETE",CANCEL:"CANCEL"};var d=function(a,b,d,e){var f=this;this.manager=a;this.mode=b;this.active=!1;this.activeImage=d;this.inactiveImage=e;this.div=document.createElement("div");this.img=document.createElement("img");this.div.appendChild(this.img); this.setActive=function(a){this.active=a;this.img.src=this.active?f.activeImage:f.inactiveImage};this.destructor=function(){div.parentNode&&div.parentNode.removeChild(this.div);this.img=this.div=null};this.setActive(!1);this.div.onclick=function(){var a=f.manager.getDrawingMode()==f.mode?TGOS.TGOverlayType.NONE:f.mode;f.manager.setDrawingMode(a)}},b=function(a,b,d,e){var f=this;this.manager=a;this.mode=b;this.active=!0;this.enabledImage=d;this.disabledImage=e;this.div=document.createElement("div"); this.img=document.createElement("img");this.div.appendChild(this.img);this.setActive=function(a){this.active=a;this.img.src=this.active?f.enabledImage:f.disabledImage};this.destructor=function(){div.parentNode&&div.parentNode.removeChild(this.div);this.img=this.div=null};this.setActive(!0);this.div.onclick=function(){f.active&&f.manager.setModifyMode(f.mode)}},a=function(a){a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()},f=function(a,b){this.buttons=[];a&&(this.manager=a);this.position= TGOS.TGControlPosition.BOTTOM_RIGHT;this.div=document.createElement("div");util.disableSelect(this.div);this.table=document.createElement("table");this.div.appendChild(this.table);this.row=this.table.insertRow(-1);a.map&&this.setMap(a.map);b&&this.setOptions(b)},e=f.prototype;e.setMap=function(a){this.map!=a&&(this.map=a,this.position&&a.controls[this.position].push(this.div))};e.setImages=function(a){this.images=a};e.setVisible=function(a){this.div.style.display=a?"":"none"};e.setPosition=function(a){if(this.manager.map){var b= this.manager.map.controls[this.position].indexOf(this.div);0<=b&&(this.manager.map.controls[this.position].removeAt(b),this.manager.map.controls[a].push(this.div),this.position=a)}};e.setOptions=function(a){a.images&&this.setImages(a.images);a.controlPosition&&this.setPosition(a.controlPosition);a.modifyModes&&this.setModes(a.modifyModes)};e.setButtonState=function(a,b){for(var d=!1,e=0;e=s.length&&(b=!1);!d.moveGraphicByKey||E!=TGOS.TGOverlayType.MARKER&&E!=TGOS.TGOverlayType.LABEL||1>=s.length&&(b=!0);var e,a=[],f=d.options.modifyIndicateOptions.pseudo;switch(E){case TGOS.TGOverlayType.POLYGON:3>s.length&&(b=!1);for(i=0;is.length&&(b=!1);for(i=0;ib.x?b.x:a.x,a.yb.y?b.y:a.y)};this.getAllGraphics=function(){return B};this.takeAllGraphics=function(){this.setDrawingMode(TGOS.TGOverlayType.NONE,!0);var a=[];for(i=0;i=m){var l=f;f=m;m=l}h=w;w+=12){var n=l+Math.sin(w*Math.PI/180)*k,u=m+Math.cos(w*Math.PI/180)*k;d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857?(n=TGOS.TWD97toWGS84(n,u),n=new TGOS.TGPoint(n.x,n.y)):n=new TGOS.TGPoint(n,u);s.push(n)}l=new TGOS.TGLineString(s);l=new TGOS.TGLinearRing(l);e.push(l);l=(new TGOS.TGPolygon(e)).toGeoJson()}else if(b==TGOS.TGOverlayType.POLYGON||b==TGOS.TGOverlayType.LINESTRING)l=e.getPath().toGeoJson();a.geoJson= l;g.geoJsonProperties=f?f:"{}"!=P?P:"{}";B.push(g);b=new TGOS.OverlayCompleteEvent(g,b,"ADD");TGOS.TGEvent.trigger_(d,h,b);TGOS.TGEvent.trigger_(d,"overlay_complete",b)}};this.load=function(a){var b=function(a){var b;a.geoJsonProperties?b=a.geoJsonProperties:a.properties&&(b=a.properties);if(a instanceof TGOS.TGMarker)d.addGraphic(a.position,TGOS.TGOverlayType.MARKER,null,b);else if(a instanceof TGOS.TGLabel)d.addGraphic(a.position,TGOS.TGOverlayType.LABEL,null,b);else if(a instanceof TGOS.TGLine)d.addGraphic(a.getPath(), TGOS.TGOverlayType.LINESTRING,null,b);else if(a instanceof TGOS.TGFill)a=a.getPath(),a instanceof TGOS.TGEnvelope?d.addGraphic(a,TGOS.TGOverlayType.ENVELOPE,null,b):a instanceof TGOS.TGCircle?d.addGraphic(a,TGOS.TGOverlayType.CIRCLE,null,b):a instanceof TGOS.TGPolygon&&d.addGraphic(a,TGOS.TGOverlayType.POLYGON,null,b);else if(a.geometry instanceof TGOS.TGMultiPoint)for(var e=0;e=H.length&&(AttachEvent(D,"dblclick",Q),b==TGOS.TGOverlayType.POLYGON? S=new TGOS.TGFill(d.map,null,d.options.polygonOptions):b==TGOS.TGOverlayType.LINESTRING&&(S=new TGOS.TGLine(d.map,null,d.options.polylineOptions)));var f=d.map.getMapBase(),g=l(D),b=a.clientX-g.x;a=a.clientY-g.y;f=f.ToMapPoint(b,a);f=d.snapToGraphics(f);H.push(f);G||(G=d.map.getPaper().path("M"+b+","+a));b=N(H);null!=S&&S.setPath(b)}},U=function(a){var b=a.clientX;a=a.clientY;if(u!=b||v!=a){u=b;v=a;DEBUG_MODE&&console.log("drawMove.");e||(e=!sa(b,a,z,A))&&DEBUG_MODE&&console.log("drawMoved.");var f= d.map.getMapBase(),g=l(D),b=f.ToMapPoint(b-g.x,a-g.y),b=d.snapToGraphics(b);!H||0>=H.length||!S||(b=N(H.concat(b)),S.setPath(b))}},X=function(a){"tgoverlay"==a.currentTarget.className&&(DEBUG_MODE&&console.log("drawStart."),util.disableDefault(a),u=z=a.clientX,v=A=a.clientY,e=!1,AttachEvent(D,"mouseup",V),AttachEvent(D,"mousemove",U))},ca=function(b){if("tgoverlay"==b.currentTarget.className){util.disableDefault(b);a(b);DEBUG_MODE&&console.log("drawEnd.");DetachEvent(D,"mousemove",ja);DetachEvent(D, "dblclick",ca);var e=b.clientX;b=b.clientY;var f=d.map.getMapBase(),g=l(D),e=f.ToMapPoint(e-g.x,b-g.y),e=d.snapToGraphics(e);d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(e=TGOS.Geometry.Transform(e,TGOS.GooToWGS84),e=new TGOS.TGPoint(e.x,e.y));b=d.getDrawingMode();var h,f=H[0];b==TGOS.TGOverlayType.CIRCLE?h=d.createCircle(f,e):b==TGOS.TGOverlayType.ENVELOPE&&(h=d.createEnvelope(f,e));H=null;h&&d.addGraphic(h,b);null!=S&&(S.setMap(null),S=null)}},R=function(a){DEBUG_MODE&&console.log("simpleUp."); DetachEvent(D,"mouseup",R);if(!e){var b=d.getDrawingMode();H||(H=[]);0>=H.length&&(AttachEvent(D,"dblclick",ca),b==TGOS.TGOverlayType.CIRCLE?S=new TGOS.TGFill(d.map,null,d.options.circleOptions):b==TGOS.TGOverlayType.ENVELOPE&&(S=new TGOS.TGFill(d.map,null,d.options.envelopeOptions)));var b=d.map.getMapBase(),f=l(D);a=b.ToMapPoint(a.clientX-f.x,a.clientY-f.y);a=d.snapToGraphics(a);d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(a=TGOS.Geometry.Transform(a,TGOS.GooToWGS84),a=new TGOS.TGPoint(a.x,a.y)); H.push(a)}},ja=function(a){var b=a.clientX;a=a.clientY;if(u!=b||v!=a)if(u=b,v=a,DEBUG_MODE&&console.log("simpleMove."),e||(e=!sa(b,a,z,A))&&DEBUG_MODE&&console.log("simpleMoved."),H&&!(0>=H.length)&&S){var f=d.map.getMapBase(),g=l(D),b=f.ToMapPoint(b-g.x,a-g.y),b=d.snapToGraphics(b);d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(b=TGOS.Geometry.Transform(b,TGOS.GooToWGS84),b=new TGOS.TGPoint(b.x,b.y));a=d.getDrawingMode();var h,f=H[0];a==TGOS.TGOverlayType.CIRCLE?h=d.createCircle(f,b):a==TGOS.TGOverlayType.ENVELOPE&& (h=d.createEnvelope(f,b));S&&S.setPath(h)}},qa=function(a){if("tgoverlay"==a.currentTarget.className){DEBUG_MODE&&console.log("simpleStart.");util.disableDefault(a);u=z=a.clientX;v=A=a.clientY;e=!1;a=d.map.getMapBase();var b=l(D);a=a.ToMapPoint(z-b.x,A-b.y);n=d.snapToGraphics(a);d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(a=TGOS.Geometry.Transform(n,TGOS.GooToWGS84),n=new TGOS.TGPoint(a.x,a.y));AttachEvent(D,"mousemove",ja);AttachEvent(D,"mouseup",R)}},ha=function(b){if("tgoverlay"==b.currentTarget.className){util.disableDefault(b); a(b);DetachEvent(D,"mousemove",la,!1);DetachEvent(D,"mouseup",ha,!1);var e=b.clientX,f=b.clientY;DEBUG_MODE&&console.log("dragEnd X = "+e+", Y = "+f);b=null;var g=d.getDrawingMode();if(g==TGOS.TGOverlayType.CIRCLE||g==TGOS.TGOverlayType.ENVELOPE){var h=l(D),e=e-h.x,f=f-h.y,e=d.map.getMapBase().ToMapPoint(e,f),e=d.snapToGraphics(e);d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(e=TGOS.Geometry.Transform(e,TGOS.GooToWGS84),e=new TGOS.TGPoint(e.x,e.y));g==TGOS.TGOverlayType.CIRCLE?b=d.createCircle(n, e):g==TGOS.TGOverlayType.ENVELOPE&&(b=d.createEnvelope(n,e))}b&&d.addGraphic(b,g);null!=M&&(M.setMap(null),M=null)}},la=function(a){var b=a.clientX;a=a.clientY;if(u!=b||v!=a){u=b;v=a;DEBUG_MODE&&console.log("dragMove.");var e=l(D),b=b-e.x;a-=e.y;b=d.map.getMapBase().ToMapPoint(b,a);b=d.snapToGraphics(b);d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(b=TGOS.Geometry.Transform(b,TGOS.GooToWGS84),b=new TGOS.TGPoint(b.x,b.y));var f;a=d.getDrawingMode();DEBUG_MODE&&console.log("Move ("+b.x+","+b.y+")-("+ n.x+","+n.y+")");a==TGOS.TGOverlayType.CIRCLE?f=d.createCircle(n,b):a==TGOS.TGOverlayType.ENVELOPE&&(f=d.createEnvelope(n,b));M&&M.setPath(f)}},Y=function(b){if("tgoverlay"==b.currentTarget.className){util.disableDefault(b);a(b);u=I=b.clientX;v=F=b.clientY;DEBUG_MODE&&console.log("dragStart X = "+I+", Y = "+F);var e=l(D);b=I-e.x;e=F-e.y;b=d.map.getMapBase().ToMapPoint(b,e);n=d.snapToGraphics(b);d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(b=TGOS.Geometry.Transform(n,TGOS.GooToWGS84),n=new TGOS.TGPoint(b.x, b.y));DEBUG_MODE&&console.log("clickPoint X= "+n.x+", Y = "+n.y);switch(d.getDrawingMode()){case TGOS.TGOverlayType.ENVELOPE:M=new TGOS.TGFill(d.map,null,d.options.envelopeOptions);break;case TGOS.TGOverlayType.CIRCLE:M=new TGOS.TGFill(d.map,null,d.options.circleOptions)}AttachEvent(D,"mousemove",la);AttachEvent(D,"mouseup",ha)}},aa=function(b){if("tgoverlay"==b.currentTarget.className&&(util.disableDefault(b),a(b),DetachEvent(D,"mousemove",W),DetachEvent(D,"mouseup",aa),!e)){var f=b.clientX;b=b.clientY; DEBUG_MODE&&console.log("clickEnd X = "+f+", Y = "+b);var g=null,h=d.getDrawingMode();if(h==TGOS.TGOverlayType.MARKER||h==TGOS.TGOverlayType.LABEL)g=l(D),f-=g.x,b-=g.y,f=d.map.getMapBase().ToMapPoint(f,b),g=d.snapToGraphics(f),d.map.getCoordSys()==TGOS.TGCoordSys.EPSG3857&&(f=TGOS.Geometry.Transform(g,TGOS.GooToWGS84),g=new TGOS.TGPoint(f.x,f.y));null!==g&&(DEBUG_MODE&&console.log("Add Point X= "+g.x+", Y = "+g.y),d.addGraphic(g,d.drawingMode))}},W=function(b){util.disableDefault(b);a(b);e||(e=!sa(b.clientX, b.clientY,z,A))&&DEBUG_MODE&&console.log("clickMoved.")},da=function(a){"tgoverlay"==a.currentTarget.className&&(util.disableDefault(a),z=a.clientX,A=a.clientY,e=!1,DEBUG_MODE&&console.log("clickStart : X = "+z+", Y = "+A),AttachEvent(D,"mouseup",aa),AttachEvent(D,"mousemove",W))},sa=function(a,b,d,e){var f=!1;a-1!==d&&a!==d&&a+1!==d||b-1!==e&&b!==e&&b+1!==e||(f=!0);return f};this.setDrawingMode=function(a,b){var e=this.drawingMode;if(e!=a){e!=TGOS.TGOverlayType.NONE&&(e==TGOS.TGOverlayType.POLYGON|| e==TGOS.TGOverlayType.LINESTRING?d.cancelSegDrawing():e==TGOS.TGOverlayType.EDIT?d.cancelEditingMode():e==TGOS.TGOverlayType.MODIFY&&(b?d.setModifyMode(TGOS.TGModifyType.CANCEL,!0):d.setModifyMode(TGOS.TGModifyType.CANCEL,!1)));D=this.map.getPanes().graphicLayer;DetachEvent(D,"mousedown",da);DetachEvent(D,"mousedown",Y);DetachEvent(D,"mousedown",X);DetachEvent(D,"mousemove",U);DetachEvent(D,"mousedown",qa);DetachEvent(D,"mousemove",ja);d.useDefaultControl&&(D.style.cursor="crosshair");this.map.setOverlayForwardEvent(!1); switch(a){case TGOS.TGOverlayType.ENVELOPE:this.envelopeDblClick?AttachEvent(D,"mousedown",qa):AttachEvent(D,"mousedown",Y);this.drawingMode=TGOS.TGOverlayType.ENVELOPE;break;case TGOS.TGOverlayType.CIRCLE:this.circleDblClick?AttachEvent(D,"mousedown",qa):AttachEvent(D,"mousedown",Y);this.drawingMode=TGOS.TGOverlayType.CIRCLE;break;case TGOS.TGOverlayType.POLYGON:AttachEvent(D,"mousedown",X);this.drawingMode=TGOS.TGOverlayType.POLYGON;break;case TGOS.TGOverlayType.LINESTRING:AttachEvent(D,"mousedown", X);this.drawingMode=TGOS.TGOverlayType.LINESTRING;break;case TGOS.TGOverlayType.MARKER:AttachEvent(D,"mousedown",da);this.drawingMode=TGOS.TGOverlayType.MARKER;break;case TGOS.TGOverlayType.LABEL:AttachEvent(D,"mousedown",da);this.drawingMode=TGOS.TGOverlayType.LABEL;break;case TGOS.TGOverlayType.EDIT:d.useDefaultControl&&(this.modifyControl.setVisible(!1),this.drawingControl.setVisible(!0),D.style.cursor="pointer");for(i=0;i=h?l.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.parentNode.removeChild(l),l=void 0)}:l.onload=function(){this.parentNode.removeChild(l);l=void 0};l.onerror=function(){e&&e.call(this);this.parentNode.removeChild(l);l=void 0};TGOS.ajaxCount__++;l.src=b;f[0].appendChild(l)}}})(); TGOS.loadJsonData=function(d,b,a,f,e){var g=document.createElement("script");g.type="text/javascript";document.body.appendChild(g);b=0<=b.indexOf("?")?b+"&keystr="+encodeURIComponent(TGOS.tgHash):b+"?keystr="+encodeURIComponent(TGOS.tgHash);b+="&rn="+Math.floor(1E5*Math.random()+1);g.onreadystatechange=function(){"loaded"==this.readyState&&a.call(this,dataObj)};g.onload=function(){a.call(this,dataObj);g.parentNode.removeChild(g);for(var b in g)delete g[b]};g.onerror=function(){f&&f.call(this)};""== d?g.src=b:(e&&(g.src=d+"?serv="+encodeURIComponent(b)+"&skip=true&hash="+TGOS.tgHash),g.src=d+"?serv="+encodeURIComponent(b))};TGOS.DistrictID={U01COS01_201212A:"S01",U01COS02_201212A:"S02",U01COS03_201212A:"S03",U01COS04_201212A:"S04",U01COS05_201212A:"S05",U01TOS01_201212A:"S06",U01TOS02_201212A:"S07",U01TOS03_201212A:"S08",U01TOS04_201212A:"S09",U01TOS05_201212A:"S10",U01VIS01_201212A:"S11",U01VIS02_201212A:"S12",U01VIS03_201212A:"S13",U01VIS04_201212A:"S14",U01VIS05_201212A:"S15"}; TGOS.TGDistrictStat=function(){this.stat=function(d,b,a,f){var e={getImageUrl:"",district:[]},g="";switch(d){case TGOS.TGStatMapId.COUNTYMAP:g="county";break;case TGOS.TGStatMapId.TOWNMAP:g="town";break;case TGOS.TGStatMapId.VILLAGEMAP:g="village"}var h="string"==typeof a.layer?a.layer:"",k="string"==typeof a.code?a.code:"",l="ei";switch("string"==typeof a.classifyMethod?a.classifyMethod:""){case "EqualInterval":l="ei";break;case "Quantile":l="qt";break;case "StanDevi":l="sd"}var n="number"==typeof a.classes? a.classes.toString():"",m="green";switch(a.graduatedColor.toLowerCase()){case "red":m="red";break;case "yellow":m="yellow";break;case "green":m="green";break;case "blue":m="blue"}var p="number"==typeof a.height?a.height.toString():"",q="number"==typeof a.width?a.width.toString():"";TGOS.getJSON(TGOS.STATISTICS_SERVICE2+"?width="+q+"&height="+p+"&district="+g+"&color="+m+"&layer="+h+"&code="+k+"&method="+l+"&classnum="+n,function(a){if(a&&a.error)f.call(this,null,"REQUEST_DENIED");else{e.district= a.district;e.legend=a.legend;var b=parseFloat(a.envelope.left),d=parseFloat(a.envelope.top),z=parseFloat(a.envelope.right);a=parseFloat(a.envelope.bottom);e.envelope=new TGOS.TGEnvelope(b,d,z,a);b=TGOS.STATISTICS_SERVICE+"?width="+q+"&height="+p+"&district="+g+"&color="+m+"&layer="+h+"&code="+k+"&method="+l+"&classnum="+n;b=0<=b.indexOf("?")?b+"&keystr="+encodeURIComponent(TGOS.tgHash):b+"?keystr="+encodeURIComponent(TGOS.tgHash);e.imageUrl=b;f.call(this,e,"OK");h in TGOS.DistrictID&&TGOS.Log("web", "A05",TGOS.DistrictID[h])}})}}; TGOS.TGLocateService=function(){function d(a,b,d){var f=[];new TGOS.TGTransformation;var l="",n="";switch(d){case "84":n="EPSG:4326";break;case "97_119":n="EPSG:3825";break;default:n="EPSG:3826"}TGOS.getJSON(TGOS.ADDRESSLOCATE_SERVICE+"?oAddress="+a.address+"&oSRS="+n+"&oResultDataType=jsonp&pnum="+parseInt(a.pageNumber),function(a){if(a&&a.Info&&a.Info.length)if(0>=parseInt(a.Info[0].OutTotal))l=TGOS.TGLocatorStatus.ZERO_RESULTS,b.call(this,null,l);else{l=TGOS.TGLocatorStatus.OK;30=a.Table.length)b.call(this,f,TGOS.TGLocatorStatus.ZERO_RESULTS,0,0);else{for(var e=0;ea.pageNumber?1:parseInt(a.pageNumber); k=TGOS.QUERY_SERVICE+"?op=att&res="+TGOS.MapIdInfo[d].resource;k+="&layer="+TGOS.MapIdInfo[d].layers[b].name;k+="&EXPR="+encodeURIComponent(g);h.fieldAttr=[];h.position=[];TGOS.getJSON(k+("&page="+a),function(a){var g="";if(a&&a.error)e.call(this,null,"REQUEST_DENIED",0,0);else if(a){var l=a.Feature,k=null,n=[],v=null,z=a.items;a=a.pages;for(var A in TGOS.MapIdInfo[d].layers[b].query)g=g+A+",";h.fieldName=g;for(var g=l.length,I=0;I>1):n>>1;n=l=0;do k=d.charCodeAt(f++)-63,n|=(k&31)<>1):n>>1;h.push(e*b);h.push(g*b)}return h};TGOS.TGAddressStatus={ERROR:"ERROR",INVALID_REQUEST:"INVALID_REQUEST",OK:"OK",ZERO_RESULTS:"ZERO_RESULTS"}; TGOS.TGAddress=function(){return function(){this.nearestAddress=function(d,b,a){if(!(d instanceof TGOS.TGPoint))throw"Must be a Point @nearestAddress";var f="EPSG:3826";switch(b){case TGOS.TGCoordSys.EPSG3857:f="EPSG:4326";break;case TGOS.TGCoordSys.EPSG3826:f="EPSG:3826";break;case TGOS.TGCoordSys.EPSG3825:f="EPSG:3825"}TGOS.getJSON(TGOS.ADDRESSLOCATE_SERVICE+"?op=PointQueryNearAddr&oAPPId="+TGOS.APPID+"&oAPIKey="+TGOS.APIKey+"&oSRS="+f+"&oResultDataType=jsonp&oPX="+d.x+"&oPY="+d.y,function(b){b= b.AddressList;0>=b.length?a.call(this,null,TGOS.TGAddressStatus.ZERO_RESULTS):(b=b[0],b={formattedAddress:b.FULL_ADDR,addressComponents:{county:b.COUNTY,town:b.TOWN,village:b.VILLAGE,neighborhood:b.NEIGHBORHOOD,road:b.ROAD,section:b.SECTION,lane:b.LANE,alley:b.ALLEY,sub_alley:b.SUB_ALLEY,tong:b.TONG,number:b.NUMBER},geometry:{bounds:new TGOS.TGEnvelope(b.X,b.Y,b.X,b.Y),location:new TGOS.TGPoint(b.X,b.Y)}},a.call(this,b,TGOS.TGAddressStatus.OK))},null,null)}}}();TGOS.TGMileageType={HIGHWAY:"HIGHWAY",EXPRESSWAY:"EXPRESSWAY",PROVINCEWAY:"PROVINCEWAY",TRA:"TRA",HSR:"HSR"};TGOS.TGDirectionType={N:"N",E:"E",S:"S",W:"W"};TGOS.TGLocatorType={STREET_ADDRESS:"address",INTERPOLATED:"address",ROUTE:"road",COORD:"coord",POI:"poi",INTERSECTION:"roadcross"}; TGOS.COUNTYCODES={"09007":"\u9023\u6c5f\u7e23","09020":"\u91d1\u9580\u7e23",10002:"\u5b9c\u862d\u7e23",10004:"\u65b0\u7af9\u7e23",10005:"\u82d7\u6817\u7e23",10007:"\u5f70\u5316\u7e23",10008:"\u5357\u6295\u7e23",10009:"\u96f2\u6797\u7e23",10010:"\u5609\u7fa9\u7e23",10013:"\u5c4f\u6771\u7e23",10014:"\u81fa\u6771\u7e23",10015:"\u82b1\u84ee\u7e23",10016:"\u6f8e\u6e56\u7e23",10017:"\u57fa\u9686\u5e02",10018:"\u65b0\u7af9\u5e02",10020:"\u5609\u7fa9\u5e02",63E3:"\u81fa\u5317\u5e02",64E3:"\u9ad8\u96c4\u5e02", 65E3:"\u65b0\u5317\u5e02",66E3:"\u81fa\u4e2d\u5e02",67E3:"\u81fa\u5357\u5e02",68E3:"\u6843\u5712\u5e02"}; TGOS.TGLocate=function(){var d=function(a){if(!a)return"";for(var b in TGOS.COUNTYCODES)if(a.replace("\u53f0","\u81fa")==TGOS.COUNTYCODES[b])return b},b=TGOS.LOCATOR_SERVICE,a=getWebProtocal()+getServicePath()+"TGLocator/TGLocator.ashx",f=function(){};f.prototype.buildDescription=function(a,b,d,f){var l="",n="",m="";switch(a){case TGOS.TGMileageType.HIGHWAY:l="\u570b\u9053";break;case TGOS.TGMileageType.EXPRESSWAY:l="\u5feb\u901f\u9053\u8def";break;case TGOS.TGMileageType.PROVINCEWAY:l="\u7701\u9053"; break;case TGOS.TGMileageType.TRA:l="\u53f0\u9435";break;case TGOS.TGMileageType.HSR:l="\u9ad8\u9435"}m=a==TGOS.TGMileageType.HSR?m+l:m+(l+f);if(a==TGOS.TGMileageType.HIGHWAY){switch(b){case TGOS.TGDirectionType.E:n="\u6771\u5411";break;case TGOS.TGDirectionType.W:n="\u897f\u5411";break;case TGOS.TGDirectionType.S:n="\u5357\u5411";break;case TGOS.TGDirectionType.N:n="\u5317\u5411"}m+=","+n}return m+(","+d+"\u516c\u91cc")};f.prototype.calcViewport=function(a,b,d){switch(d){case TGOS.TGCoordSys.EPSG3857:b= TGOS.WGS84ToGoo(a,b);a=TGOS.GooToWGS84(b.x-500,b.y+500);b=TGOS.GooToWGS84(b.x+500,b.y-500);a=new TGOS.TGEnvelope(a.x,a.y,b.x,b.y);break;default:a=new TGOS.TGEnvelope(a-500,b+500,a+500,b-500)}return a};f.prototype.buildGeometry=function(a,b){var d=new TGOS.TGPoint,f;switch(b){case TGOS.TGCoordSys.EPSG3826:d.x=a.TWD97X||a["97X"];d.y=a.TWD97Y||a["97Y"];break;case TGOS.TGCoordSys.EPSG3857:d.x=a.Lng;d.y=a.Lat;break;case TGOS.TGCoordSys.EPSG3825:x97=a.TWD97X||a["97X"],y97=a.TWD97Y||a["97Y"],f=TGOS.TWD97toTWD97_119(x97, y97),d.x=f.x,d.y=f.y}f=this.calcViewport(d.x,d.y,b);return{location:d,bounds:new TGOS.TGEnvelope(d.x,d.y,d.x,d.y),viewport:f}};f.prototype.complexLocate=function(b,d,f){var k=this,l=b.requestText,n=b.town,m=b.county,p=b.geometryInfo,q=b.pageNumber;b=b.center;var t;switch(d){case TGOS.TGCoordSys.EPSG3826:t="EPSG:3826";break;case TGOS.TGCoordSys.EPSG3857:t="EPSG:4326"}l=a+"?format=jsonp&input="+l+"&srs="+t;m&&(l+="&county="+m);n&&(l+="&town="+n);l+=p?"&ignoreGeometry=false":"&ignoreGeometry=true";"number"== typeof q&&(l+="&pnum="+q);b instanceof TGOS.TGPoint&&!isNaN(b.x)&&!isNaN(b.y)&&(l+="¢er="+b.x+","+b.y);TGOS.getJSON(l,function(a){var b=a.status,e=a.results,l=a.featureCount,m=a.pages,n=[];if("OK"==b||"TOO_MANY_RESULTS"==b)for(var p=0;p=a.Table.length?(b=TGOS.TGLocatorStatus.ZERO_RESULTS, f.call(k,null,null,b)):(b=k.buildDescription(l,m,p,a.Table[0].Number),a=k.buildGeometry(a.Table[0],d),f&&f.call(k,b,a,"OK")):(b=TGOS.TGLocatorStatus.ERROR,f.call(k,null,null,b))})};return f}();(function(){var d=["Document","Folder","Placemark"];TGOS.TGKmlLayerOption=function(){this.suppressInfoWindows=this.preserveViewport=this.map=null;this.markerFitImageSize=!1};TGOS.TGKmlLayerMetaData=function(){this.snippet=this.name=this.description=this.author=null};TGOS.KmlMouseEvent=function(){this.pixelOffset=this.point=this.feature=null};TGOS.KmlFeatureData=function(){this.snippet=this.name=this.description=this.author=null};TGOS.KmlAuthor=function(){this.uri=this.name=this.email=null};TGOS.TGKmlLayerStatus= {DOCUMENT_NOT_FOUND:"DOCUMENT_NOT_FOUND",DOCUMENT_TOO_LARGE:"DOCUMENT_TOO_LARGE",FETCH_ERROR:"FETCH_ERROR",INVALID_DOCUMENT:"INVALID_DOCUMENT",INVALID_REQUEST:"INVALID_REQUEST",LIMITS_EXCEEDED:"LIMITS_EXCEEDED",OK:"OK",TIMED_OUT:"TIMED_OUT",UNKNOWN:"UNKNOWN"};TGOS.TGKmlLayer=function(b,a,f){var e=this,g=a.map,h=!1,k,l="auto",n=!0;a&&(void 0!==a.zIndex&&"number"==typeof a.zIndex&&(l=a.zIndex),void 0!==a.visible&&"boolean"==typeof a.visible&&(n=a.visible),void 0!==a.independentContainer&&"boolean"== typeof a.independentContainer&&(h=a.independentContainer,!0==h&&(k=g.addIndependentContainer("KML",this))));var m=g.getCoordSys(),p={author:{email:"",name:"",uri:""},description:"",name:"",snippet:""},q,t=new TGOS.TGInfoWindow("",null,{pixelOffset:new TGOS.TGSize(0,0)}),u=null,v=a.markerFitImageSize;this.overlays=[];this.points=[];this.polygons=[];this.polylines=[];this.groundoverlays=[];this.icons=[];this.getDefaultViewport=function(){if(!u){for(var a=Infinity,b=-Infinity,d=-Infinity,e=Infinity, f=0;fb.length))return b[0]};this.parseRing=function(a,b){switch(b){case "EPSG3826":var d=this.parseCoordinates(a.coordinates,"EPSG3826");break;case "EPSG3825":d=this.parseCoordinates(a.coordinates,"EPSG3825");break;case "EPSG3857":d=this.parseCoordinates(a.coordinates,"EPSG3857")}d=new TGOS.TGLineString(d);return new TGOS.TGLinearRing(d)};this.createPolygon=function(a){var b=[], d=this.parseRing(a.outerBoundaryIs.LinearRing,m);b.push(d);var e=a.innerBoundaryIs;if(e)if(e.length)for(var f=0;fa.r&&(b="0"+ b);var d=a.g.toString(16);16>a.g&&(d="0"+d);var e=a.b.toString(16);16>a.b&&(e="0"+e);return"#"+b+d+e}};this.handlePlacemark=function(b,d){var e=[];if(b.length)for(var f=0;f");0";for(b=0;b",f=f+"",f=f+"",f=f+"";f+="
",f=f+(m||d),f=f+"	",f=f+k,f=f+"
"}if(h.SchemaData)for(h=h.SchemaData.length?h.SchemaData:[h.SchemaData],l=0;l";for(b=0;b",f+="",f+="",f+="";f+="
",f+=n+":"+d,f+="	",f+=void 0===k?"":k,f+="
"}}}0l&&(l=0),1a?d=h.firstChild:a>=b||(d=h.childNodes[a]));h.removeChild(B); d?h.insertBefore(B,d):h.appendChild(B)}};this.getNode=function(){return B};this.getLayerId=function(){return n};this.getMatrixSetId=function(){return D["ows:Identifier"]};this.getTileOpacity=function(){return l};this.setTileOpacity=function(a){"number"==typeof a&&(l=a,B&&(B.style.opacity=l,B.style.filter="alpha(opacity="+100*l+")"))};this.getSource=function(){return b};this.setZIndex=function(a){G=a;B&&(B.style.zIndex=G)};this.getZIndex=function(){return G};this.RemoveSelf=function(){h.removeChild(B)}; var E=function(){var a=this,b=0;a.style.opacity=b;var d=l/7,e=setInterval(function(){b>=l?(a.style.filter="alpha(opacity="+100*l+")",a.style.opacity=l,clearInterval(e)):(a.style.opacity=b,a.style.filter="alpha(opacity="+100*b+")",b+=d)},33);a.style.filter="alpha(opacity=0)";a.style.display="block"},s=function(a,b,e,f){if(!a)return null;var g;if(a.TileMatrix.length||a.TileMatrix["ows:Identifier"]!=b)for(var h=0;h=l?0:Math.floor((l-m)/w),s=k+Math.ceil(Math.abs(s-m)/w)+1,u,m=1;f&&(m=parseFloat(g.ScaleDenominator)*F/(0.0254*f/96));var n=n-p,t=s-k;f=[]; var C=Infinity,q=-Infinity;u=Infinity;for(var v=-Infinity,D=0,z=0,B=[0,-1],s=Math.pow(Math.max(n,t),2);0q&&(q=D),zv&&(v=z));if(D===z||0>D&&D===-z||0q&&(a.top=q);null!==t&&a.right>t&&(a.right=t);null!==u&&a.bottomf.maxZoom||a==d)for(f.clearClusters(),a=0;athis.maxZoom||a==d)for(this.clearClusters(),a=0;athis.maxZoom||a==d)this.clearClusters(); else{for(var a=this.getExtendedBounds(),b=0;b=this.clusters[a].symbols.length&&this.addClusterMarker(this.clusters[a])}}};l.addClusterMarker=function(a){var b;b=a.centerLonLat?a.centerLonLat:a.center;var d=new TGOS.TGPoint(b.x, b.y);b=a.markers.length;var e=new TGOS.TGMarker(null,d);e.setFlat(!0);e.setClickable(!0);e.setVisible(this.visible);e.setZIndex(this.zIndex);e.setMap(this.map);a.symbols.push(e);if(1g.length-1?g[g.length-1]:g[h];a.symbols[0].setIcon(d.icon);a.symbols[0].setTitle(a.markers.length);a.symbols[1].setFontColor(d.labelColor?d.labelColor:"#f0f0f0");a.symbols[1].setFontSize(d.labelSize?d.labelSize:12);d.labelAnchor&&a.symbols[1].setOffset(d.labelAnchor);break a}d=g[g.length-1];a.symbols[0].setIcon(d.icon);a.symbols[0].setTitle(a.markers.length);a.symbols[1].setFontColor(d.labelColor?d.labelColor:"#f0f0f0");a.symbols[1].setFontSize(d.labelSize? d.labelSize:12);d.labelAnchor&&a.symbols[1].setOffset(d.labelAnchor)}}1==b&&(TGOS.TGEvent.copyEvent(a.markers[0],e),e.setTitle(a.markers[0].getTitle()),e.annotation=a.markers[0].annotation);f&&(f.cluster=a,TGOS.TGEvent.addListener(f,"click",this.clickHandler));e&&(e.cluster=a,TGOS.TGEvent.addListener(e,"click",this.clickHandler))};l.getScaleClass=function(){return this.scaleClass};l.setScaleClass=function(a){this.scaleClass=a};l.setClusterStyle=function(a){this.styles=a};l.getClusterStyle=function(){return this.styles}; l.removeMarker=function(a,b){for(var d=0;dt?2*t*t:-1+(4-2*t)*t;pl?0:l>=h?h:l,m=0>d?0:d>k?k:d,k=0>n?0:n>=k?k:n,n=-Infinity,p=Infinity,h=0>b?0:b>h?h:b;hthis.maxIntensity&&(a[h][q]=maxIntensity),n=Math.max(n,a[h][q]),p=Math.min(p,a[h][q]);return{max:n,min:p}};TGOS.TGHeatmapLayer=function(a){this.data=[];this.div=document.createElement("div");this.div.style.width="100%";this.div.style.height= "100%";this.div.style.position="absolute";this.cv=document.createElement("canvas");this.cv.style.position="absolute";this.div.appendChild(this.cv);this.ctx=this.cv.getContext("2d");this.cacheImage=new Image;a&&this.setOptions(a)};TGOS.TGHeatmapLayer.prototype=new TGOS.TGOverlayView;b=TGOS.TGHeatmapLayer.prototype;b.getData=function(){return this.data};b.createKernels=function(){this.kernels=[];for(var b=0;bd.height-3&&(e=d.height-3);b.top=e}else e=a.clientX-d.left,e>d.width-3&&(e=d.width-3),b.left=e;b.updateClip_();a.preventDefault&&a.preventDefault();return!1}};AttachEvent(d,"mousedown",a)}else if("circle"==this.type||"square"==this.type||"round"==this.type)this.node.style.width=this.swipeSize+"px",this.node.style.height=this.swipeSize+"px",this.node.style.position="absolute",this.top=this.top/2-this.swipeSize/ 2,this.left-=this.swipeSize/2,this.node.style.left=this.left+"px",this.node.style.top=this.top+"px","square"==this.type?(this.node.style.borderStyle=this.borderStyle,this.node.style.borderWidth=this.borderWidth+"px",this.node.style.borderColor=this.borderColor):"circle"==this.type?(this.node.style.borderStyle=this.borderStyle,this.node.style.borderWidth=this.borderWidth+"px",this.node.style.borderRadius="50%",this.node.style.borderColor=this.borderColor,this.bounds_changed_=TGOS.TGEvent.addListener(this.map, "bounds_changed",function(){b.mapChanged(b)}),this.zoom_changed_=TGOS.TGEvent.addListener(this.map,"zoom_changed",function(){b.mapChanged(b)}),this.tilesloaded_=TGOS.TGEvent.addListener(this.map,"tilesloaded",function(){b.mapChanged(b)}),this.drag_=TGOS.TGEvent.addListener(this.map,"drag",function(){b.mapChanged(b)})):"round"==this.type&&(this.node.style.borderStyle=this.borderStyle,this.node.style.borderWidth=this.borderWidth,this.node.style.borderRadius=this.borderRadius,this.node.style.borderColor= this.borderColor,this.bounds_changed_=TGOS.TGEvent.addListener(this.map,"bounds_changed",function(){b.mapChanged(b)}),this.zoom_changed_=TGOS.TGEvent.addListener(this.map,"zoom_changed",function(){b.mapChanged(b)}),this.tilesloaded_=TGOS.TGEvent.addListener(this.map,"tilesloaded",function(){b.mapChanged(b)}),this.drag_=TGOS.TGEvent.addListener(this.map,"drag",function(){b.mapChanged(b)})),a=function(a){AttachEvent(document.body,"mousemove",k);AttachEvent(document.body,"mouseup",h);b.clientX=a.clientX; b.clientY=a.clientY;a.preventDefault&&a.preventDefault();return!1},h=function(a){DetachEvent(document.body,"mousemove",k);DetachEvent(document.body,"mouseup",h);a.preventDefault&&a.preventDefault();return!1},k=function(a){if(b.node&&b.node.parentNode){var d=b.left+(a.clientX-b.clientX),e=b.top+(a.clientY-b.clientY),f=b.node.parentNode.getBoundingClientRect();e>f.height-10&&(e=f.height-10);e<-b.swipeSize+10&&(e=-b.swipeSize+10);d>f.width-10&&(d=f.width-10);d<-b.swipeSize+10&&(d=-b.swipeSize+10);b.node.style.top= e+"px";b.top=e;b.clientY=a.clientY;b.node.style.left=d+"px";b.left=d;b.clientX=a.clientX;b.updateClip_();a.preventDefault&&a.preventDefault();return!1}},AttachEvent(this.node,"mousedown",a)};d.wmtsRefreshed=function(b){b.mapChanged(b)};d.wmsRefreshed=function(b){b.mapChanged(b)};d.mapChanged=function(b){function a(){clearTimeout(d);e=b.updateClip_(e);0b?b:aa.attributes[this.attributeField]&&this.infos[b].minValue<= a.attributes[this.attributeField])return this.infos[b].symbol;return this.defaultSymbol};this.infos=[];if(!b)throw"Default Symbol must be provided";this.defaultSymbol=b;if("string"!=typeof a)throw"Attribute field must be provided";this.attributeField=a}};TGOS.extend(d.Renderer,d.ClassBreaksRenderer);d.ClassBreaksRenderer.prototype.addBreak=function(b){this.infos.push(b)};d.ClassBreaksRenderer.prototype.removeBreak=function(b){b=this.infos.indexOf(b);0<=b&&this.infos.splice(b,1)};return d}();TGOS.request=function(){var d={},b=0,a=function(a){var b=document.createElement("form");b.setAttribute("method",a.method?a.method:"POST");b.setAttribute("enctype","multipart/form-data");b.setAttribute("encoding","multipart/form-data");for(var d in a.data){var e=document.createElement("input");e.type="hidden";e.name=d;e.value=a.data[d];b.appendChild(e)}a=document.createElement("input");a.type="submit";b.appendChild(a);document.body.appendChild(b);return b};d.iframe=function(d,e){var f="sgIFrame"+b, l=document.createElement("iframe");l.setAttribute("id",f);l.setAttribute("name",f);l.setAttribute("width","0");l.setAttribute("height","0");l.setAttribute("border","0");l.setAttribute("style","width: 0; height: 0; border: none;");var n=e.form?e.form:a(e);document.body.appendChild(l);var m=document.getElementById(f),p=function(){m.detachEvent?m.detachEvent("onload",p):m.removeEventListener("load",p,!1);m.contentDocument?content=m.contentDocument.body.innerHTML:m.contentWindow?content=m.contentWindow.document.body.innerHTML: m.document&&(content=m.document.body.innerHTML);e.callback&&e.callback.call(this,JSON.parse(content));m.parentNode.removeChild(m)};m.addEventListener&&m.addEventListener("load",p,!0);m.attachEvent&&m.attachEvent("onload",p);n.setAttribute("target",f);n.setAttribute("action",d);n.submit();b++};var f=function(a,b,d){return 0<=a.indexOf("?")?a+"&"+b+"="+d:a+"?"+b+"="+d};d.getJSON=function(a,b,e,l){var n=DeviceTest();"number"!=typeof d.ajaxCount__&&(d.ajaxCount__=0);var m="sn"+d.ajaxCount__;TGOS.request.getJSON[m]= function(){b.apply(this,arguments);delete TGOS.request.getJSON[m]};e&&(a=f(e,"serv",encodeURIComponent(a)));a=f(a,"jsonp",encodeURIComponent("TGOS.request.getJSON['"+m+"']"));e=document.getElementsByTagName("head");if(0!=e.length){var p=document.createElement("script");p.type="text/javascript";"MSIE"==n?p.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.parentNode.removeChild(p),p=void 0)}:p.onload=function(){this.parentNode.removeChild(p); p=void 0};p.onerror=function(){l&&l.call(this);this.parentNode.removeChild(p);p=void 0};d.ajaxCount__++;p.src=a;e[0].appendChild(p)}};var e=function(a,b,d){4==a.readyState&&(200!=a.status&&304!=a.status?d&&d.call(this,a.status):b&&b.call(this,a))};d.ajax=function(a,b){var d;d=window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void 0;var f="get",n=!1,m=null,p=null,q=null,t=null,u=null;b&&("post"===b.method&&(f="post"),!1===b.async&&(n=!1),!1===b.async&& (m=null),b.user&&(p=b.user),b.password&&(q=b.password),b.error&&(t=b.error),b.complete&&(u=b.complete));d.open(f,a,n,p,q);m&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded");!0===n&&(d.onreadystatechange=function(a){e(d,u,t)});4!=d.readyState&&(d.send(m),!1===n&&e(d,u,t))};d.get=function(a,b){b.method="get";d.ajax.call(this,a,b)};d.post=function(a,b){b.method="post";d.ajax.call(this,a,b)};return d}();(function(){var d=/\${[\w:]*}/g,b;TGOS.GraphicsLayer=function(){this.graphics=this.surface=this.lastScale=this.svgContainer=this.surface_=this.map_=null;this.mouseEventEnabled=!0;this.infoTemplate=this.renderer=null;this.visible=!0;this.graphics=[];this.title=this.name="Graphics Layer";this.maxScale=this.minScale=0;this.getNode=function(){return this.node};this.templateReplace=function(a,b){var e=b.match(d);if(e)for(var g=0;g=h.length?k=a.attributes[h[0]]?a.attributes[h[0]]:"":window[h[1]]&&(k=window[h[1]].call(this,a.attributes[h[0]],h[0],a.attributes));b=b.replace(e[g],k)}return b};this.add=function(a){a&&(a.layer=this,a.draw(this.map_,new TGOS.TGPoint(a.attributes.longitude,a.attributes.latitude)),this.graphics.push(a),TGOS.TGEvent.trigger(a,"graphic-add"))};this.clear=function(){for(var a=0;athis.minScale)&&b};this.setMaxScale=function(a){"number"==typeof a&&(this.maxScale=a,this.map_&&(a=this.map_.getMapBase().getScale(), this.isVisibleAtScale(a)||(this.node.style.visibility="hidden")))};this.setMinScale=function(a){"number"==typeof a&&(this.minScale=a,this.map_&&(a=this.map_.getMapBase().getScale(),this.isVisibleAtScale(a)||(this.node.style.visibility="hidden")))};this.setVisibility=function(a){"boolean"==typeof a&&(this.node&&(this.node.style.visibility=a?"visible":"hidden"),this.visible=a)};this.setRenderer=function(a){this.renderer=a;this.map_&&this.redraw()};this.redraw=function(){for(var a=0;athis.opacity&&(this.opacity=0),1=a.length)return!1;f=d;if(1==l)for(;dd&&(d=0);d>this.maxDataValue&&(d=this.maxDataValue);if(this.ColorArry){var e=this.CompareValue(a);this.color=e?e:"#88ff33"}else 0.33>=a/this.maxDataValue? this.color=this.lowColor:0.66>=a/this.maxDataValue?this.color=this.midColor:1>=a/this.maxDataValue&&(this.color=this.highColor);var g=this.angle,h=180*(1-d/this.maxDataValue),k=h-g;this.animation&&this.animation.stop();this.valueSpan.style.left=this.cx-this.valueSpan.clientWidth/2+"px";this.valueSpan.style.top=this.cy+"px";this.valueSpan.innerHTML=a+" "+this.unitLabel;isNaN(d)?(a=b.createPathStr(180,b.outRadius,b.inRadius,b.cx,b.cy),b.path.attr({path:a}),this.angle=180):(this.animation=TGOS.fx.createAnimation({easing:TGOS.fx.easing.quadInOut, type:window.requestAnimationFrame?"":"setTimeout",duration:150,onAnimation:function(a){b.angle=g+k*a;a=b.createPathStr(b.angle,b.outRadius,b.inRadius,b.cx,b.cy);b.path.attr({fill:b.color});b.path.attr({path:a})},onEnd:function(){var a=b.createPathStr(h,b.outRadius,b.inRadius,b.cx,b.cy);b.path.attr({path:a})}}),this.animation.play())}};d.setCaption=function(b){"string"==typeof b&&(this.caption=b,this.captionSpan&&(this.captionSpan.innerHTML=b))};d.setTitle=function(b){"string"==typeof b&&(this.title= b,this.titleSpan&&(this.titleSpan.innerHTML=b))};d.setLabel=function(b){"string"==typeof b&&(this.label=b,this.labelSpan&&(this.labelSpan.innerHTML=b))};d.setValue=function(b){"number"==typeof b&&(this.value=b,this.valueSpan&&(this.valueSpan.innerHTML=b,this.valueSpan.style.left=this.cx-this.valueSpan.clientWidth/2+"px",this.valueSpan.style.top=this.cy))};d.setFeature=function(b){b instanceof TGOS.Graphic&&(this.feature=b,this.update())};d.startup=function(){for(var b=this,a=0;a=d.MinValue&&bb.length))return b[0]};this.parseRing=function(a,b){switch(b){case "EPSG3826":var d=this.parseCoordinates(a.coordinates,"EPSG3826");break;case "EPSG3825":d=this.parseCoordinates(a.coordinates,"EPSG3825");break;case "EPSG3857":d=this.parseCoordinates(a.coordinates,"EPSG3857")}d=new TGOS.TGLineString(d);return new TGOS.TGLinearRing(d)};this.createPolygon= function(a){var b=[],d=this.parseRing(a.outerBoundaryIs.LinearRing,t);b.push(d);var e=a.innerBoundaryIs;if(e)if(e.length)for(var f=0;fa.r&&(b="0"+b);var d=a.g.toString(16);16>a.g&&(d="0"+d);var e=a.b.toString(16);16>a.b&&(e="0"+e);return"#"+b+d+e}};this.handlePlacemark=function(a,b){var d=[];if(a.length)for(var e=0;e");0";for(b=0;b",f=f+"",f=f+"", f=f+"";f+="
",f=f+(s||d),f=f+"	",f=f+m,f=f+"
"}if(g.SchemaData)for(g=g.SchemaData.length?g.SchemaData:[g.SchemaData],h=0;h";for(b=0;b",f+="",f+="",f+="";f+="
", f+=n+":"+d,f+="	",f+=void 0===m?"":m,f+="
"}}}0 H.indexOf("3826")&&(0<=H.indexOf("3825")?(d=TGOS.TWD97toTWD97_119(d.x,d.y),e=TGOS.TWD97toTWD97_119(e.x,e.y)):0<=H.indexOf("4326")&&(d=TGOS.TWD97toWGS84(d.x,d.y),e=TGOS.TWD97toWGS84(e.x,e.y)));break;case TGOS.TGCoordSys.EPSG3825:0>H.indexOf("3825")&&(0<=H.indexOf("3826")?(d=TGOS.TWD97_119toTWD97(d.x,d.y),e=TGOS.TWD97_119toTWD97(e.x,e.y)):0<=H.indexOf("4326")&&(d=TGOS.TWD97_119toWGS84(d.x,d.y),e=TGOS.TWD97_119toWGS84(e.x,e.y)))}var g=d.x,h=e.y,k=e.x,s=d.y;"1.3.0"==F&&0>H.indexOf("CRS:84")&&0<=H.indexOf("EPSG:4326")&& (g=e.y,h=d.x,k=d.y,s=e.x);a=n+"?BBOX="+(g+","+h+","+k+","+s)+"&WIDTH="+a+"&HEIGHT="+b;a+="&"+E.join("&");a+="&"+f;t&&(a=t+"?"+a);return a}}function l(){if(p){var a=m.getClientWidth(),b=m.getClientHeight(),d=m.ToMapPoint(0,0),e=m.ToMapPoint(a,b);return{left:d.x,top:d.y,right:e.x,bottom:e.y,width:a,height:b}}}var n,m,p=f,q=!0,t,u="auto",v,z=1,A=null,I=f.getPanes().overlayviewLayer;g&&(void 0!==g.opacity&&"number"==typeof g.opacity&&(z=g.opacity),void 0!==g.visible&&"boolean"==typeof g.visible&&(q=g.visible), void 0!==g.container&&(I=g.container),void 0!==g.proxy&&(t=0=a?d=I.firstChild:a>=b||(d=I.childNodes[a]);I.removeChild(layerContainer);d?I.insertBefore(layerContainer,d):I.appendChild(layerContainer)}}};this.RemoveSelf=function(){I&&s&&I.removeChild(s)};this.getLayerId=function(){return b}; this.getNode=function(){return s};this.getDefaultViewport=function(){};this.getUrl=function(){return n};this.removeLayer=function(){p.removeLayer(this)};this.getZIndex=function(){return u};this.setZIndex=function(a){u=a;s&&(s.style.zIndex=u)};this.getVisible=function(){return q};this.setVisible=function(a){q=a;s&&(s.style.display=q?"block":"none")};this.putVisible=function(a){this.setVisible(a)};this.setProxy=function(a){a&&(t=0n&&(n=0),1=a?d=k.firstChild: a>=b||(d=k.childNodes[a]);k.removeChild(B);d?k.insertBefore(B,d):k.appendChild(B)}}};this.getNode=function(){return B};this.getLayerId=function(){return b};this.getMatrixSetId=function(){return D["ows:Identifier"]};this.getOpacity=function(){return n};this.setOpacity=function(a){"number"==typeof a&&(n=a,B&&(B.style.opacity=n,B.style.filter="alpha(opacity="+100*n+")"))};this.getSource=function(){return a};this.RemoveSelf=function(){k.removeChild(B)};var E=function(){var a=this,b=0;a.style.opacity= b;var d=n/7,e=setInterval(function(){b>=n?(a.style.filter="alpha(opacity="+100*n+")",a.style.opacity=n,clearInterval(e)):(a.style.opacity=b,a.style.filter="alpha(opacity="+100*b+")",b+=d)},33);a.style.filter="alpha(opacity=0)";a.style.display="block"},s=function(a,b,e,f){if(!a)return null;var g;if(a.TileMatrix.length||a.TileMatrix["ows:Identifier"]!=b)for(var h=0;h=k?0:Math.floor((k-m)/p),n=l+Math.ceil(Math.abs(n-m)/p)+1,q,m=1;f&&(m=parseFloat(g.ScaleDenominator)*H/(0.0254*f/96));var s=s-w,C=n-l;f=[];var t=Infinity,u=-Infinity;q=Infinity; for(var D=-Infinity,B=0,v=0,z=[0,-1],n=Math.pow(Math.max(s,C),2);0u&&(u=B),vD&&(D=v));if(B===v||0>B&&B===-v||0q&&(a.top=q);null!==t&&a.right>t&&(a.right=t);null!==u&&a.bottom=a?d=q.firstChild:a>=b||(d=q.childNodes[a]);q.removeChild(J);d?q.insertBefore(J,d):q.appendChild(J)}}};this.getLayerId=function(){return h};this.getOpacity=function(){return A};this.setOpacity=function(a){"number"==typeof a&&(A=a,J&&(J.style.opacity=A,J.style.filter="alpha(opacity="+100*A+")"))};this.getZIndex=function(){return I};this.setZIndex=function(a){I=a;J&&(J.style.zIndex=I)};this.getSourceUrl=function(){return k};this.getNode=function(){return J}; this.RemoveSelf=function(){q&&J&&q.removeChild(J)};var O=function(g,h,m){if(!g)return null;for(var s,n=0;n=g?0:Math.floor((g-n)/s),n=p+Math.ceil(Math.abs(q-n)/s)+1,w=w-C,B=n-p,n=[],v=Infinity,G=-Infinity;D=Infinity;for(var z=-Infinity,H=0,A=0,F=[0,-1],q=Math.pow(Math.max(w,B),2);0G&&(G=H),Az&&(z=A));if(H===A||0>H&&H===-A||0G&&(a.top=G);null!==D&&a.right>D&&(a.right=D);null!==B&&a.bottomh&&(f.x-=h=-h);0>g&&(f.y-=g=-g);d[e].ReloadStatus(f.x,f.y,h,g)}};this.UpdateElement=function(){this.RebuildElement()};this.RebuildElement=function(){if(C&&F&&v){var a=T(w,v);if(null!=a){var b=w.ToMapPoint(0,0),d=w.ToMapPoint(w.getClientWidth(),w.getClientHeight()),b=new TGOS.TGEnvelope(b.x,b.y,d.x,d.y),b=Z(b);O(v,a,b);DEBUG_MODE&& console.log("getBoundTiles = "+E.length);var d=[],e=E.length;for(i=0;ib.right||m>b.top||l=this.maxFeaturesAllow&&(v=!1,m=!0,this.setWarningText(this.textTooManyGraphics));if(v){var v=!1,z=u.geom.Envelope;null!=z&&(z.left>n.right||z.rightn.top||z.top=n.count&&(void 0!==n.symbol&&null!=n.symbol&&(n.symbol.setMap(null),n.symbol=null),delete a[l]))}}};this.setVisible=function(a,b,d,f){b=a+"_"+b;a=null;if(void 0!==this.mFeatures[b]){a=this.mFeatures[b];b=d.length;for(var l=0;l"),k=k+t+": "+q,l.push({field:t,value:q})))}else for(p in h.attr)q=h.attr[p],void 0!==q&&(0"),k=k+p+": "+q,l.push({field:p,value:q}));d.graphicSelectedCallback?d.graphicSelectedCallback.call(b,{graphic:b,point:a.point,info:k,attr:l}):(null==d.messageBox&& (d.messageBox=new TGOS.TGInfoWindow(null,null,d.infoWindowOptions)),d.messageBox.setPosition(a.point),d.messageBox.setMessageText(k),d.messageBox.open(d.map))}}};this.hideInfo=function(){null!=d.messageBox&&(d.messageBox.setMessageText(""),d.messageBox.close())};this.setQueryable=function(a){this.queryable=a;for(var b in this.mFeatures){var h=this.mFeatures[b];if(void 0!==h)for(var k in h){var l=h[k];void 0!==l&&(l=l.symbol,void 0!==l&&(a?(TGOS.TGEvent.addListener(l,"click",d.showInfo),l.setCursor("pointer")): (void 0!==l.click_&&TGOS.TGEvent.removeListener(l.click_[0]),l.setCursor("default"))))}}};this.getQueryable=function(){return this.queryable}};TGOS.TGVectorTile=function(b,a){this.req=this.url=this.map=null;this.loaded=this.loading=!1;this.matrixSet=b.matrixSet;this.matrixId=b.matrixId;this.bound=b.bound;this.row=b.row;this.col=b.col;this.format=b.format;this.visible=!0;this.fid=[];this.equals=function(a){return this.matrixSet==a.matrixSet&&this.matrixId==a.matrixId&&this.row==a.row&&this.col==a.col}; this.setVisible=function(b){this.visible=b;if(0B&&(B=0);1=p?0:Math.floor((p-m)/q),m=l+Math.ceil(Math.abs(n-m)/q)+1,s=s-e,C=m-l,m=[],t=Infinity,u=-Infinity,v=Infinity,B=-Infinity,z=0,A=0,G=[0,-1],n=Math.pow(Math.max(s,C),2);0u&&(u=z),AB&&(B=A));if(z===A||0>z&&z===-A||0f&&(e.intCoord=!0);var g=a.format.indexOf("gml"),h=a.format.indexOf("json");0<=g||0<=f?(b=TGOS.parseXML(b),a.getGmlFeature(b,e)):0<=h&&(b=JSON.parse(b),a.getJsonFeature(b,e))}}};a.xhr=d;d.open("GET", a.url,!0);d.send()}},J;this.finished=!1;this.UpdateElement=function(){if(I&&K&&E&&(this.getAllFeatures().showWarning(!1),this.finished)){var a=C(A,E);if(null!=a){var b=E["ows:Identifier"],g=a["ows:Identifier"],h=A.ToMapPoint(0,0),l=A.ToMapPoint(A.getClientWidth(),A.getClientHeight()),h=l=new TGOS.TGEnvelope(h.x,h.y,l.x,l.y);null!==p&&h.leftq&&(h.top=q);null!==t&&h.right>t&&(h.right=t);null!==u&&h.bottoml.right||n.rightl.top||n.top=l.count&&(void 0!==l.symbol&&null!=l.symbol&&(l.symbol.setMap(null),l.symbol=null),delete a[k]))}}};this.setVisible= function(a,b,d,h){b=a+"_"+b;a=null;if(void 0!==this.mFeatures[b]){a=this.mFeatures[b];b=d.length;for(var k=0;k"),h=h+q+": "+p,k.push({field:q,value:p})))}else for(m in g.attr)p=g.attr[m],void 0!==p&&(0"),h=h+m+": "+p,k.push({field:m,value:p}));a.graphicSelectedCallback?a.graphicSelectedCallback.call(d,{graphic:d,point:b.point,info:h,attr:k}):(null==a.messageBox&&(a.messageBox=new TGOS.TGInfoWindow(null,null,a.infoWindowOptions)),h=''+ h+"",a.messageBox.setPosition(b.point),a.messageBox.setMessageText(h),a.messageBox.open(a.map))}}};this.hideInfo=function(){null!=a.messageBox&&(a.messageBox.setMessageText(""),a.messageBox.close())};this.setQueryable=function(b){this.queryable=b;for(var d in this.mFeatures){var g=this.mFeatures[d];if(void 0!==g)for(var h in g){var k=g[h];void 0!==k&&(k=k.symbol,void 0!==k&&(b?(TGOS.TGEvent.addListener(k,"click",a.showInfo),k.setCursor("pointer")):(void 0!==k.click_&&TGOS.TGEvent.removeListener(k.click_[0]), k.setCursor("default"))))}}};this.getQueryable=function(){return this.queryable}};TGOS.TGVectorTilePoi=function(b,a){this.req=this.url=this.map=null;this.loaded=this.loading=!1;this.matrixSet=b.matrixSet;this.matrixId=b.matrixId;this.bound=b.bound;this.row=b.row;this.col=b.col;this.format=b.format;this.visible=!0;this.fid=[];this.equals=function(a){return this.matrixSet==a.matrixSet&&this.matrixId==a.matrixId&&this.row==a.row&&this.col==a.col};this.setVisible=function(b){this.visible=b;if(0=h.length)){for(var d=void 0!==b?b*b:1,k=h[0],l=[k],n,m=1,p=h.length;md&&(l.push(n),k=n)}k!==n&&l.push(n);n=l;var h=n.length,k=new ("undefined"!== typeof Uint8Array?Uint8Array:Array)(h),l=0,m=h-1,p=[],q=[],u,v,z;for(k[l]=k[m]=1;m;){u=0;for(t=l+1;tu&&(z=t,u=v)}u>d&&(k[z]=1,p.push(l,z,z,m));m=p.pop();l=p.pop()}for(t=0;tia&&(ia=0);1=m?0:Math.floor((m-k)/n);for(k=l+Math.ceil(Math.abs(e-k)/n)+1;lq&&(f.top=q);null!==t&&f.right>t&&(f.right=t);null!==u&&f.bottomk.right||l.rightk.top||l.top]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;e.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g};e.defaultPorts={http:"80",https:"443",ftp:"21", gopher:"70",ws:"80",wss:"443"};e.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;e.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};e.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:e.domAttributes[b]}};e.encode=t;e.decode=decodeURIComponent;e.iso8859=function(){e.encode=escape; e.decode=unescape};e.unicode=function(){e.encode=t;e.decode=decodeURIComponent};e.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&", "%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}};e.encodeQuery=function(a,b){var d=e.encode(a+"");void 0===b&&(b=e.escapeQuerySpace);return b?d.replace(/%20/g,"+"):d};e.decodeQuery=function(a,b){a+="";void 0=== b&&(b=e.escapeQuerySpace);try{return e.decode(b?a.replace(/\+/g,"%20"):a)}catch(d){return a}};var F={encode:"encode",decode:"decode"},H,G=function(a,b){return function(d){try{return e[b](d+"").replace(e.characters[a][b].expression,function(d){return e.characters[a][b].map[d]})}catch(f){return d}}};for(H in F)e[H+"PathSegment"]=G("pathname",F[H]),e[H+"UrnPathSegment"]=G("urnpath",F[H]);F=function(a,b,d){return function(f){var g;g=d?function(a){return e[b](e[d](a))}:e[b];f=(f+"").split(a);for(var h= 0,k=f.length;he)return a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"";if("/"!==a.charAt(e)||"/"!==b.charAt(e))e=a.substring(0,e).lastIndexOf("/");return a.substring(0,e+1)};e.withinString=function(a,b,d){d||(d={}); var f=d.start||e.findUri.start,g=d.end||e.findUri.end,h=d.trim||e.findUri.trim,k=d.parens||e.findUri.parens,l=/[a-z0-9-]=["']?$/i;for(f.lastIndex=0;;){var m=f.exec(a);if(!m)break;var n=m.index;if(d.ignoreHtml){var p=a.slice(Math.max(n-3,0),n);if(p&&l.test(p))continue}for(var q=n+a.slice(n).search(g),p=a.slice(n,q),q=-1;;){var t=k.exec(p);if(!t)break;q=Math.max(q,t.index+t[0].length)}p=-1d.length)return this._parts.hostname;d=this._parts.hostname.length-this.tld(b).length-1;d=this._parts.hostname.lastIndexOf(".",d-1)+1;return this._parts.hostname.substring(d)||""}if(!a)throw new TypeError("cannot set domain empty");e.ensureValidHostname(a);!this._parts.hostname|| this.is("IP")?this._parts.hostname=a:(d=RegExp(g(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(d,a));this.build(!b);return this};A.tld=function(b,d){if(this._parts.urn)return void 0===b?"":this;"boolean"===typeof b&&(d=b,b=void 0);if(void 0===b){if(!this._parts.hostname||this.is("IP"))return"";var e=this._parts.hostname.lastIndexOf("."),e=this._parts.hostname.substring(e+1);return!0!==d&&a&&a.list[e.toLowerCase()]?a.get(this._parts.hostname)||e:e}if(b)if(b.match(/[^a-zA-Z0-9-]/))if(a&& a.is(b))e=RegExp(g(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(e,b);else throw new TypeError('TLD "'+b+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");e=RegExp(g(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(e,b)}else throw new TypeError("cannot set TLD empty");this.build(!d);return this};A.directory=function(a,b){if(this._parts.urn)return void 0===a? "":this;if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var d=this._parts.path.length-this.filename().length-1,d=this._parts.path.substring(0,d)||(this._parts.hostname?"/":"");return a?e.decodePath(d):d}d=this._parts.path.length-this.filename().length;d=this._parts.path.substring(0,d);d=RegExp("^"+g(d));this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a));a&&"/"!==a.charAt(a.length-1)&&(a+="/");a=e.recodePath(a);this._parts.path= this._parts.path.replace(d,a);this.build(!b);return this};A.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("string"!==typeof a){if(!this._parts.path||"/"===this._parts.path)return"";var d=this._parts.path.lastIndexOf("/"),d=this._parts.path.substring(d+1);return a?e.decodePathSegment(d):d}d=!1;"/"===a.charAt(0)&&(a=a.substring(1));a.match(/\.?\//)&&(d=!0);var f=RegExp(g(this.filename())+"$");a=e.recodePath(a);this._parts.path=this._parts.path.replace(f,a);d?this.normalizePath(b): this.build(!b);return this};A.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path)return"";var d=this.filename(),f=d.lastIndexOf(".");if(-1===f)return"";d=d.substring(f+1);d=/^[a-z0-9%]+$/i.test(d)?d:"";return a?e.decodePathSegment(d):d}"."===a.charAt(0)&&(a=a.substring(1));if(d=this.suffix())f=a?RegExp(g(d)+"$"):RegExp(g("."+d)+"$");else{if(!a)return this;this._parts.path+="."+e.recodePath(a)}f&&(a=e.recodePath(a), this._parts.path=this._parts.path.replace(f,a));this.build(!b);return this};A.segment=function(a,b,d){var e=this._parts.urn?":":"/",f=this.path(),g="/"===f.substring(0,1),f=f.split(e);void 0!==a&&"number"!==typeof a&&(d=b,b=a,a=void 0);if(void 0!==a&&"number"!==typeof a)throw Error('Bad segment "'+a+'", must be 0-based integer');g&&f.shift();0>a&&(a=Math.max(f.length+a,0));if(void 0===b)return void 0===a?f:f[a];if(null===a||void 0===f[a])if(k(b)){f=[];a=0;for(var h=b.length;a\x3c/script>");document.write("